<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | 西阁</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://ftp.bmp.ovh/imgs/2021/05/2656ae6284a05476.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.dbbe5620.css" as="style"><link rel="preload" href="/assets/js/app.65a6c00f.js" as="script"><link rel="preload" href="/assets/js/2.a5843350.js" as="script"><link rel="preload" href="/assets/js/18.170c7bd6.js" as="script"><link rel="prefetch" href="/assets/js/10.59a1d96d.js"><link rel="prefetch" href="/assets/js/11.8e8d02b2.js"><link rel="prefetch" href="/assets/js/12.a3650e89.js"><link rel="prefetch" href="/assets/js/13.49742ed7.js"><link rel="prefetch" href="/assets/js/14.6914c3de.js"><link rel="prefetch" href="/assets/js/15.32dadd12.js"><link rel="prefetch" href="/assets/js/16.c9c56be7.js"><link rel="prefetch" href="/assets/js/17.2c0f546f.js"><link rel="prefetch" href="/assets/js/19.35127448.js"><link rel="prefetch" href="/assets/js/3.70d5d251.js"><link rel="prefetch" href="/assets/js/4.bcfa078c.js"><link rel="prefetch" href="/assets/js/5.dc5bf0c1.js"><link rel="prefetch" href="/assets/js/6.81905726.js"><link rel="prefetch" href="/assets/js/7.167e63b8.js"><link rel="prefetch" href="/assets/js/8.f53faa14.js"><link rel="prefetch" href="/assets/js/9.006f9204.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dbbe5620.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://ftp.bmp.ovh/imgs/2021/05/2656ae6284a05476.png" alt="西阁" class="logo"> <span class="site-name can-hide">西阁</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/about/#联系方式" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/note/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/note/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note/webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/note/miniprogram/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/note/hybird/" class="nav-link">
  Hybird
</a></li></ul></div></div><div class="nav-item"><a href="http://www.web-yyb.top:666/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  技术博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/xigeOsp/api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa2+apidoc源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.web-yyb.top:888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa2+apidoc展示
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/resource/" class="nav-link">
  前端资源集锦
</a></div><div class="nav-item"><a href="https://github.com/gabriel-yan-book/books" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/about/#联系方式" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/note/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/note/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/note/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note/webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/note/miniprogram/" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/note/hybird/" class="nav-link">
  Hybird
</a></li></ul></div></div><div class="nav-item"><a href="http://www.web-yyb.top:666/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  技术博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/xigeOsp/api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa2+apidoc源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.web-yyb.top:888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  koa2+apidoc展示
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/resource/" class="nav-link">
  前端资源集锦
</a></div><div class="nav-item"><a href="https://github.com/gabriel-yan-book/books" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/webpack/#一、起步" class="sidebar-link">一、起步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、基本安装" class="sidebar-link">1、基本安装</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、创建一个bundle" class="sidebar-link">2、创建一个bundle</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、模块" class="sidebar-link">3、模块</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、使用一个配置文件" class="sidebar-link">4、使用一个配置文件</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_5、npm-scripts" class="sidebar-link">5、npm scripts</a></li></ul></li><li><a href="/note/webpack/#二、管理资源" class="sidebar-link">二、管理资源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、设置" class="sidebar-link">1、设置</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、加载-css" class="sidebar-link">2、加载 CSS</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、加载-images-图像" class="sidebar-link">3、加载 images 图像</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、加载-fonts-字体" class="sidebar-link">4、加载 fonts 字体</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_5、加载数据" class="sidebar-link">5、加载数据</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_6、全局资源" class="sidebar-link">6、全局资源</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、预先准备" class="sidebar-link">1、预先准备</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、设置-htmlwebpackplugin" class="sidebar-link">2、设置 HtmlWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、清理-dist-文件夹" class="sidebar-link">3、清理 /dist 文件夹</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、manifest" class="sidebar-link">4、manifest</a></li></ul></li><li><a href="/note/webpack/#四、开发环境" class="sidebar-link">四、开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、使用-source-map" class="sidebar-link">1、使用 source-map</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、选择一个开发工具" class="sidebar-link">2、选择一个开发工具</a></li></ul></li><li><a href="/note/webpack/#五、代码分离" class="sidebar-link">五、代码分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、入口起点-entry-point" class="sidebar-link">1、入口起点(entry point)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、防止重复-prevent-duplication" class="sidebar-link">2、防止重复(prevent duplication)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、动态导入-dynamic-import" class="sidebar-link">3、动态导入(dynamic import)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、预获取-预加载模块-prefetch-preload-module" class="sidebar-link">4、预获取/预加载模块(prefetch/preload module)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_5、bundle-分析-bundle-analysis" class="sidebar-link">5、bundle 分析(bundle analysis)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、示例" class="sidebar-link">1、示例</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、框架" class="sidebar-link">2、框架</a></li></ul></li><li><a href="/note/webpack/#七、缓存" class="sidebar-link">七、缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、输出文件的文件名-output-filename" class="sidebar-link">1、输出文件的文件名(output filename)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、提取引导模板-extracting-boilerplate" class="sidebar-link">2、提取引导模板(extracting boilerplate)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、模块标识符-module-identifier" class="sidebar-link">3、模块标识符(module identifier)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、基本配置" class="sidebar-link">1、基本配置</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、外部化-lodash" class="sidebar-link">2、外部化 lodash</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、暴露-library" class="sidebar-link">3、暴露 library</a></li></ul></li><li><a href="/note/webpack/#十、安装" class="sidebar-link">十、安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、前提条件" class="sidebar-link">1、前提条件</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、本地安装" class="sidebar-link">2、本地安装</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、全局安装" class="sidebar-link">3、全局安装</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、最新体验版本" class="sidebar-link">4、最新体验版本</a></li></ul></li><li><a href="/note/webpack/#十一、模块热替换" class="sidebar-link">十一、模块热替换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、启用-hmr" class="sidebar-link">1、启用 HMR</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、通过-node-js-api" class="sidebar-link">2、通过 Node.js API</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、问题" class="sidebar-link">3、问题</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、hmr-加载样式" class="sidebar-link">4、HMR 加载样式</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、添加一个通用模块" class="sidebar-link">1、添加一个通用模块</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、将文件标记为-side-effect-free-无副作用" class="sidebar-link">2、将文件标记为 side-effect-free(无副作用)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、配置" class="sidebar-link">1、配置</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、npm-scripts" class="sidebar-link">2、NPM Scripts</a></li></ul></li><li><a href="/note/webpack/#十四、依赖管理" class="sidebar-link">十四、依赖管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、带表达式的-require-语句" class="sidebar-link">1、带表达式的 require 语句</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、require-context" class="sidebar-link">2、require.context</a></li></ul></li><li><a href="/note/webpack/#十五、公共路径" class="sidebar-link">十五、公共路径</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、示例-2" class="sidebar-link">1、示例</a></li></ul></li><li><a href="/note/webpack/#十六、shimming-预置依赖" class="sidebar-link">十六、Shimming 预置依赖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、shimming-全局变量" class="sidebar-link">1、shimming 全局变量</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、细粒度-shimming" class="sidebar-link">2、细粒度 shimming</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、全局-exports" class="sidebar-link">3、全局 exports</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、加载-polyfills" class="sidebar-link">4、加载 polyfills</a></li></ul></li><li><a href="/note/webpack/#十七、资源模块" class="sidebar-link">十七、资源模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、resource-资源" class="sidebar-link">1、Resource 资源</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、inline-资源-inlining-asset" class="sidebar-link">2、inline 资源(inlining asset)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、source-资源-source-asset" class="sidebar-link">3、source 资源(source asset)</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、url-资源" class="sidebar-link">4、URL 资源</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_5、通用资源类型" class="sidebar-link">5、通用资源类型</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_6、变更内联-loader-的语法" class="sidebar-link">6、变更内联 loader 的语法</a></li></ul></li><li><a href="/note/webpack/#十八、entry-高级用法" class="sidebar-link">十八、entry 高级用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、每个入口使用多种文件类型" class="sidebar-link">1、每个入口使用多种文件类型</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、基础配置" class="sidebar-link">1、基础配置</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、loader" class="sidebar-link">2、Loader</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、source-maps" class="sidebar-link">3、Source Maps</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、使用第三方类库" class="sidebar-link">4、使用第三方类库</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_5、导入其他资源" class="sidebar-link">5、导入其他资源</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_6、构建性能" class="sidebar-link">6、构建性能</a></li></ul></li><li><a href="/note/webpack/#二十、构建性能" class="sidebar-link">二十、构建性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、通用环境" class="sidebar-link">1、通用环境</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、开发环境" class="sidebar-link">2、开发环境</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_3、生产环境" class="sidebar-link">3、生产环境</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_4、工具相关问题" class="sidebar-link">4、工具相关问题</a></li></ul></li><li><a href="/note/webpack/#廿一、内容安全策略" class="sidebar-link">廿一、内容安全策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpack/#_1、示例-3" class="sidebar-link">1、示例</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_2、启用-csp" class="sidebar-link">2、启用 CSP</a></li><li class="sidebar-sub-header"><a href="/note/webpack/#_1、基本配置-2" class="sidebar-link">1、基本配置</a></li></ul></li><li><a href="/note/webpack/#廿五、渐进式网络应用程序" class="sidebar-link">廿五、渐进式网络应用程序</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/webpack/#廿六、ecmascript-modules" class="sidebar-link">廿六、ECMAScript Modules</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/webpack/#廿七、package-exports" class="sidebar-link">廿七、Package exports</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/webpack/#廿八、web-workers" class="sidebar-link">廿八、Web Workers</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/webpack/#廿九、集成" class="sidebar-link">廿九、集成</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/webpack/#三十、开发-vagrant" class="sidebar-link">三十、开发 - Vagrant</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <h2 id="一、起步"><a href="#一、起步" class="header-anchor">#</a> 一、起步</h2> <h3 id="_1、基本安装"><a href="#_1、基本安装" class="header-anchor">#</a> 1、基本安装</h3> <p>首先我们创建一个目录，初始化 npm，然后 <a href="https://webpack.docschina.org/guides/installation#local-installation" target="_blank" rel="noopener noreferrer">在本地安装 webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，接着安装 <a href="https://github.com/webpack/webpack-cli" target="_blank" rel="noopener noreferrer"><code>webpack-cli</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（此工具用于在命令行中运行 webpack）：</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir webpack-demo
cd webpack-demo
npm init -y
npm install webpack webpack-cli --save-dev
</code></pre></div><p>现在，我们将创建以下目录结构、文件和内容：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- index.html
</span><span class="token prefix inserted">+</span><span class="token line"> |- /src
</span><span class="token prefix inserted">+</span><span class="token line">   |- index.js
</span></span></code></pre></div><p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// lodash（目前通过一个 script 引入）对于执行这一行是必需的</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>index.html</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>起步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/lodash@4.17.20<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我们还需要调整 <code>package.json</code> 文件，以便确保我们安装包是 <code>private(私有的)</code>，并且移除 <code>main</code> 入口。这可以防止意外发布你的代码。</p> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  &quot;main&quot;: &quot;index.js&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;private&quot;: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p><strong>启动项目</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npx http-server
</code></pre></div><p>在此示例中，<code>&lt;script&gt;</code> 标签之间存在隐式依赖关系。在 <code>index.js</code> 文件执行之前，还需要在页面中先引入 <code>lodash</code>。这是因为 <code>index.js</code> 并未显式声明它需要 <code>lodash</code>，只是假定推测已经存在一个全局变量 <code>_</code>。</p> <p>使用这种方式去管理 JavaScript 项目会有一些问题：</p> <ul><li>无法直接体现，脚本的执行依赖于外部库。</li> <li>如果依赖不存在，或者引入顺序错误，应用程序将无法正常运行。</li> <li>如果依赖被引入但是并没有使用，浏览器将被迫下载无用代码。</li></ul> <p>让我们使用 webpack 来管理这些脚本。</p> <h3 id="_2、创建一个bundle"><a href="#_2、创建一个bundle" class="header-anchor">#</a> 2、创建一个bundle</h3> <p>首先，我们稍微调整下目录结构，创建分发代码(<code>./dist</code>)文件夹用于存放分发代码，源代码(<code>./src</code>)文件夹仍存放源代码。</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- /dist
</span><span class="token prefix inserted">+</span><span class="token line">   |- index.html
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- index.html
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span></code></pre></div><p>要在 <code>index.js</code> 中打包 <code>lodash</code> 依赖，我们需要在本地安装 library：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save lodash
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import _ from 'lodash';
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // lodash（目前通过一个 script 引入）对于执行这一行是必需的
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  // lodash，现在通过一个 script 引入
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p><strong>dist/index.html</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;title&gt;起步&lt;/title&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;https://unpkg.com/lodash@4.17.20&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;./src/index.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;
</span></span></code></pre></div><p><strong>开始打包</strong></p> <div class="language- extra-class"><pre class="language-text"><code>$ npx webpack
</code></pre></div><h3 id="_3、模块"><a href="#_3、模块" class="header-anchor">#</a> 3、模块</h3> <p><a href="https://babeljs.io/learn-es2015/" target="_blank" rel="noopener noreferrer">ES2015<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener noreferrer"><code>import</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noopener noreferrer"><code>export</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 语句已经被标准化。虽然大多数浏览器还无法支持它们，但是 webpack 却能够提供开箱即用般的支持。</p> <p>事实上，webpack 在幕后会将代码“<strong>转译</strong>”，以便旧版本浏览器可以执行。如果你检查 <code>dist/main.js</code>，你可以看到 webpack 具体如何实现，这是独创精巧的设计！除了 <code>import</code> 和 <code>export</code>，webpack 还能够很好地支持多种其他模块语法，更多信息请查看 <a href="https://webpack.docschina.org/api/module-methods" target="_blank" rel="noopener noreferrer">模块 API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>注意，webpack 不会更改代码中除 <code>import</code> 和 <code>export</code> 语句以外的部分。如果你在使用其它 <a href="http://es6-features.org/" target="_blank" rel="noopener noreferrer">ES2015 特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，请确保你在 webpack <a href="https://webpack.docschina.org/concepts/loaders/" target="_blank" rel="noopener noreferrer">loader 系统<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中使用了 <a href="https://babel.docschina.org/" target="_blank" rel="noopener noreferrer">Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>请查看编译后的代码。</strong></p> <h3 id="_4、使用一个配置文件"><a href="#_4、使用一个配置文件" class="header-anchor">#</a> 4、使用一个配置文件</h3> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- webpack.config.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span></code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，让我们通过新的配置文件再次执行构建：</p> <h3 id="_5、npm-scripts"><a href="#_5、npm-scripts" class="header-anchor">#</a> 5、npm scripts</h3> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix inserted">+</span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>现在运行以下命令：</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run build
</code></pre></div><h2 id="二、管理资源"><a href="#二、管理资源" class="header-anchor">#</a> 二、管理资源</h2> <h3 id="_1、设置"><a href="#_1、设置" class="header-anchor">#</a> 1、设置</h3> <p>在开始之前，让我们对项目做一个小的修改：</p> <p><strong>dist/index.html</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;title&gt;起步&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;title&gt;管理资源&lt;/title&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;
</span></span></code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: 'main.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: 'bundle.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><h3 id="_2、加载-css"><a href="#_2、加载-css" class="header-anchor">#</a> 2、加载 CSS</h3> <p>为了在 JavaScript 模块中 <code>import</code> 一个 CSS 文件，你需要安装 <a href="https://webpack.docschina.org/loaders/style-loader" target="_blank" rel="noopener noreferrer">style-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://webpack.docschina.org/loaders/css-loader" target="_blank" rel="noopener noreferrer">css-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，并在 <a href="https://webpack.docschina.org/configuration/module" target="_blank" rel="noopener noreferrer"><code>module</code> 配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中添加这些 loader：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  module: {
</span><span class="token prefix inserted">+</span><span class="token line">    rules: [
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: ['style-loader', 'css-loader'],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">    ],
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>我们尝试一下，通过在项目中添加一个新的 <code>style.css</code> 文件，并将其 import 到我们的 <code>index.js</code> 中：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- style.css
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>src/style.css</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.hello</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from 'lodash';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import './style.css';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Lodash, now imported by this script
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  element.classList.add('hello');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p>现在运行 build 命令：</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run build
</code></pre></div><h3 id="_3、加载-images-图像"><a href="#_3、加载-images-图像" class="header-anchor">#</a> 3、加载 images 图像</h3> <p>假如，现在我们正在下载 CSS，但是像 background 和 icon 这样的图像，要如何处理呢？在 webpack 5 中，可以使用内置的 <a href="https://webpack.docschina.org/guides/asset-modules/" target="_blank" rel="noopener noreferrer">Asset Modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，我们可以轻松地将这些内容混入我们的系统中：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['style-loader', 'css-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>我们向项目添加一个图像，然后看它是如何工作的，你可以使用任何你喜欢的图像：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- icon.png
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line">import './style.css';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import Icon from './icon.png';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Lodash, now imported by this script
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add('hello');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  // 将图像添加到我们已经存在的 div 中。
</span><span class="token prefix inserted">+</span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix inserted">+</span><span class="token line">  myIcon.src = Icon;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">  element.appendChild(myIcon);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p><strong>src/style.css</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">.hello {
</span><span class="token prefix unchanged"> </span><span class="token line">  color: red;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  background: url('./icon.png');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>重新构建并再次打开 <code>index.html</code> 文件：</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run build
</code></pre></div><h3 id="_4、加载-fonts-字体"><a href="#_4、加载-fonts-字体" class="header-anchor">#</a> 4、加载 fonts 字体</h3> <p>那么，像字体这样的其他资源如何处理呢？使用 Asset Modules 可以接收并加载任何文件，然后将其输出到构建目录。这就是说，我们可以将它们用于任何类型的文件，也包括字体。让我们更新 <code>webpack.config.js</code> 来处理字体文件：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['style-loader', 'css-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>在项目中添加一些字体文件：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- my-font.woff
</span><span class="token prefix inserted">+</span><span class="token line">   |- my-font.woff2
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- icon.png
</span><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p>配置好 loader 并将字体文件放在合适的位置后，你可以通过一个 <code>@font-face</code> 声明将其混合。本地的 <code>url(...)</code> 指令会被 webpack 获取处理，就像它处理图片一样：</p> <p><strong>src/style.css</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">@font-face {
</span><span class="token prefix inserted">+</span><span class="token line">  font-family: 'MyFont';
</span><span class="token prefix inserted">+</span><span class="token line">  src: url('./my-font.woff2') format('woff2'),
</span><span class="token prefix inserted">+</span><span class="token line">    url('./my-font.woff') format('woff');
</span><span class="token prefix inserted">+</span><span class="token line">  font-weight: 600;
</span><span class="token prefix inserted">+</span><span class="token line">  font-style: normal;
</span><span class="token prefix inserted">+</span><span class="token line">}
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">.hello {
</span><span class="token prefix unchanged"> </span><span class="token line">  color: red;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  font-family: 'MyFont';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  background: url('./icon.png');
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>现在，让我们重新构建，然后看下 webpack 是否处理了我们的字体：</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run build
</code></pre></div><h3 id="_5、加载数据"><a href="#_5、加载数据" class="header-anchor">#</a> 5、加载数据</h3> <p>此外，可以加载的有用资源还有数据，如 JSON 文件，CSV、TSV 和 XML。类似于 NodeJS，JSON 支持实际上是内置的，也就是说 <code>import Data from './data.json'</code> 默认将正常运行。要导入 CSV、TSV 和 XML，你可以使用 <a href="https://github.com/theplatapi/csv-loader" target="_blank" rel="noopener noreferrer">csv-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/gisikw/xml-loader" target="_blank" rel="noopener noreferrer">xml-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。让我们处理加载这三类文件：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev csv-loader xml-loader
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['style-loader', 'css-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.(csv|tsv)$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: ['csv-loader'],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.xml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        use: ['xml-loader'],
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>在项目中添加一些数据文件：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- data.xml
</span><span class="token prefix inserted">+</span><span class="token line">   |- data.csv
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   |- my-font.woff
</span><span class="token prefix unchanged"> </span><span class="token line">   |- my-font.woff2
</span><span class="token prefix unchanged"> </span><span class="token line">   |- icon.png
</span><span class="token prefix unchanged"> </span><span class="token line">   |- style.css
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>src/data.xml</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">&gt;</span></span>Mary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">&gt;</span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">&gt;</span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>Call Cindy on Tuesday<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>src/data.csv</strong></p> <div class="language-csv extra-class"><pre class="language-text"><code>to,from,heading,body
Mary,John,Reminder,Call Cindy on Tuesday
Zoe,Bill,Reminder,Buy orange juice
Autumn,Lindsey,Letter,I miss you
</code></pre></div><p>现在，你可以 <code>import</code> 这四种类型的数据(JSON, CSV, TSV, XML)中的任何一种，所导入的 <code>Data</code> 变量，将包含可直接使用的已解析 JSON：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line">import './style.css';
</span><span class="token prefix unchanged"> </span><span class="token line">import Icon from './icon.png';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import Data from './data.xml';
</span><span class="token prefix inserted">+</span><span class="token line">import Notes from './data.csv';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Lodash, now imported by this script
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add('hello');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Add the image to our existing div.
</span><span class="token prefix unchanged"> </span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix unchanged"> </span><span class="token line">  myIcon.src = Icon;
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  element.appendChild(myIcon);
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log(Data);
</span><span class="token prefix inserted">+</span><span class="token line">  console.log(Notes);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p>重新执行 <code>npm run build</code> 命令，然后打开 <code>dist/index.html</code>。查看开发者工具中的控制台，你应该能够看到导入的数据会被打印出来！</p> <h4 id="_1-自定义-json-模块-parser"><a href="#_1-自定义-json-模块-parser" class="header-anchor">#</a> (1) 自定义 JSON 模块 parser</h4> <p>通过使用 <a href="https://webpack.docschina.org/configuration/module/#ruleparserparse" target="_blank" rel="noopener noreferrer">自定义 parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 替代特定的 webpack loader，可以将任何 <code>toml</code>、<code>yaml</code> 或 <code>json5</code> 文件作为 JSON 模块导入。</p> <p>假设你在 <code>src</code> 文件夹下有一个 <code>data.toml</code>、一个 <code>data.yaml</code> 以及一个 <code>data.json5</code> 文件：</p> <p><strong>src/data.toml</strong></p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token key property">title</span> <span class="token punctuation">=</span> <span class="token string">&quot;TOML Example&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">owner</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;Tom Preston-Werner&quot;</span>
<span class="token key property">organization</span> <span class="token punctuation">=</span> <span class="token string">&quot;GitHub&quot;</span>
<span class="token key property">bio</span> <span class="token punctuation">=</span> <span class="token string">&quot;GitHub Cofounder &amp; CEO\nLikes tater tots and beer.&quot;</span>
<span class="token key property">dob</span> <span class="token punctuation">=</span> <span class="token date number">1979-05-27T07:32:00Z</span>
</code></pre></div><p><strong>src/data.yaml</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">title</span><span class="token punctuation">:</span> YAML Example
<span class="token key atrule">owner</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> Tom Preston<span class="token punctuation">-</span>Werner
  <span class="token key atrule">organization</span><span class="token punctuation">:</span> GitHub
  <span class="token key atrule">bio</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    GitHub Cofounder &amp; CEO
    Likes tater tots and beer.
  <span class="token key atrule">dob</span><span class="token punctuation">:</span> <span class="token datetime number">1979-05-27T07:32:00.000Z</span>
</code></pre></div><p><strong>src/data.json5</strong></p> <div class="language-json5 extra-class"><pre class="language-json5"><code><span class="token punctuation">{</span>
  <span class="token comment">// comment</span>
  <span class="token property unquoted">title</span><span class="token operator">:</span> <span class="token string">&quot;JSON5 Example&quot;</span><span class="token punctuation">,</span>
  <span class="token property unquoted">owner</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property unquoted">name</span><span class="token operator">:</span> <span class="token string">&quot;Tom Preston-Werner&quot;</span><span class="token punctuation">,</span>
    <span class="token property unquoted">organization</span><span class="token operator">:</span> <span class="token string">&quot;GitHub&quot;</span><span class="token punctuation">,</span>
    <span class="token property unquoted">bio</span><span class="token operator">:</span> <span class="token string">&quot;GitHub Cofounder &amp; CEO\n\
Likes tater tots and beer.&quot;</span><span class="token punctuation">,</span>
    <span class="token property unquoted">dob</span><span class="token operator">:</span> <span class="token string">&quot;1979-05-27T07:32:00.000Z&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先安装 <code>toml</code>，<code>yamljs</code> 和 <code>json5</code> 的 packages：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> toml yamljs json5 --save-dev
</code></pre></div><p>并在你的 webpack 中配置它们：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const toml = require('toml');
</span><span class="token prefix inserted">+</span><span class="token line">const yaml = require('yamljs');
</span><span class="token prefix inserted">+</span><span class="token line">const json5 = require('json5');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  module: {
</span><span class="token prefix unchanged"> </span><span class="token line">    rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.css$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['style-loader', 'css-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(png|svg|jpg|jpeg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(woff|woff2|eot|ttf|otf)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        type: 'asset/resource',
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.(csv|tsv)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['csv-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span><span class="token prefix unchanged"> </span><span class="token line">      {
</span><span class="token prefix unchanged"> </span><span class="token line">        test: /\.xml$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">        use: ['xml-loader'],
</span><span class="token prefix unchanged"> </span><span class="token line">      },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.toml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: 'json',
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: toml.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.yaml$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: 'json',
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: yaml.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span><span class="token prefix inserted">+</span><span class="token line">      {
</span><span class="token prefix inserted">+</span><span class="token line">        test: /\.json5$/i,
</span><span class="token prefix inserted">+</span><span class="token line">        type: 'json',
</span><span class="token prefix inserted">+</span><span class="token line">        parser: {
</span><span class="token prefix inserted">+</span><span class="token line">          parse: json5.parse,
</span><span class="token prefix inserted">+</span><span class="token line">        },
</span><span class="token prefix inserted">+</span><span class="token line">      },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    ],
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line">import './style.css';
</span><span class="token prefix unchanged"> </span><span class="token line">import Icon from './icon.png';
</span><span class="token prefix unchanged"> </span><span class="token line">import Data from './data.xml';
</span><span class="token prefix unchanged"> </span><span class="token line">import Notes from './data.csv';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import toml from './data.toml';
</span><span class="token prefix inserted">+</span><span class="token line">import yaml from './data.yaml';
</span><span class="token prefix inserted">+</span><span class="token line">import json from './data.json5';
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(toml.title); // output `TOML Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(toml.owner.name); // output `Tom Preston-Werner`
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(yaml.title); // output `YAML Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(yaml.owner.name); // output `Tom Preston-Werner`
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">console.log(json.title); // output `JSON5 Example`
</span><span class="token prefix inserted">+</span><span class="token line">console.log(json.owner.name); // output `Tom Preston-Werner`
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Lodash, now imported by this script
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix unchanged"> </span><span class="token line">  element.classList.add('hello');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  // Add the image to our existing div.
</span><span class="token prefix unchanged"> </span><span class="token line">  const myIcon = new Image();
</span><span class="token prefix unchanged"> </span><span class="token line">  myIcon.src = Icon;
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  element.appendChild(myIcon);
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  console.log(Data);
</span><span class="token prefix unchanged"> </span><span class="token line">  console.log(Notes);
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p>再次运行 <code>npm run build</code> 命令并在浏览器中打开 <code>dist/index.html</code>，可以在控制台上看到打印结果。</p> <h3 id="_6、全局资源"><a href="#_6、全局资源" class="header-anchor">#</a> 6、全局资源</h3> <p>上述所有内容中最出色之处在于，以这种方式加载资源，你可以以更直观的方式将模块和资源组合在一起。无需依赖于含有全部资源的 <code>/assets</code> 目录，而是将资源与代码组合在一起使用。例如，类似这样的结构会非常有用：</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- /assets
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |– /components
</span><span class="token prefix inserted">+</span><span class="token line"> |  |– /my-component
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– index.jsx
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– index.css
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– icon.svg
</span><span class="token prefix inserted">+</span><span class="token line"> |  |  |– img.png
</span></span></code></pre></div><p>这种配置方式会使你的代码更具备可移植性，因为现有的集中放置的方式会让所有资源紧密耦合起来。假如你想在另一个项目中使用 <code>/my-component</code>，只需将其复制或移动到 <code>/components</code> 目录下。只要你已经安装过全部_外部依赖_，并且_已经在配置中定义过相同的 loader_，那么项目应该能够良好运行。</p> <p>但是，假如你只能被局限在旧有开发方式，或者你有一些在多个组件（视图、模板、模块等）之间共享的资源。你仍然可以将这些资源存储在一个基本目录(base directory)中，甚至配合使用 <a href="https://webpack.docschina.org/configuration/resolve/#resolvealias" target="_blank" rel="noopener noreferrer">alias<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来使它们更方便 <code>import 导入</code>。</p> <p>#三、管理输出</p> <p>到目前为止，我们都是在 <code>index.html</code> 文件中手动引入所有资源，然而随着应用程序增长，并且一旦开始 <a href="https://webpack.docschina.org/guides/caching" target="_blank" rel="noopener noreferrer">在文件名中使用 hash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并输出 <a href="https://webpack.docschina.org/guides/code-splitting" target="_blank" rel="noopener noreferrer">多个 bundle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，如果继续手动管理 <code>index.html</code> 文件，就会变得困难起来。然而，通过一些插件可以使这个过程更容易管控。</p> <h3 id="_1、预先准备"><a href="#_1、预先准备" class="header-anchor">#</a> 1、预先准备</h3> <p>首先，调整一下我们的项目：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- print.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p>我们在 <code>src/print.js</code> 文件中添加一些逻辑：</p> <p><strong>src/print.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">printMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I get called from print.js!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>并且在 <code>src/index.js</code> 文件中使用这个函数：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">import _ from 'lodash';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import printMe from './print.js';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  const btn = document.createElement('button');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  btn.innerHTML = 'Click me and check the console!';
</span><span class="token prefix inserted">+</span><span class="token line">  btn.onclick = printMe;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">  element.appendChild(btn);
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  return element;
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">document.body.appendChild(component());
</span></span></code></pre></div><p>还要更新 <code>dist/index.html</code> 文件，来为 webpack 分离入口做好准备：</p> <p><strong>dist/index.html</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">&lt;!DOCTYPE html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">    &lt;meta charset=&quot;utf-8&quot; /&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;title&gt;管理资源&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;title&gt;管理输出&lt;/title&gt;
</span><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;./print.bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">  &lt;body&gt;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &lt;script src=&quot;./index.bundle.js&quot;&gt;&lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">&lt;/html&gt;
</span></span></code></pre></div><p>现在调整配置。我们将在 entry 添加 <code>src/print.js</code> 作为新的入口起点（<code>print</code>），然后修改 output，以便根据入口起点定义的名称，动态地产生 bundle 名称：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  entry: './src/index.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  entry: {
</span><span class="token prefix inserted">+</span><span class="token line">    index: './src/index.js',
</span><span class="token prefix inserted">+</span><span class="token line">    print: './src/print.js',
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: 'bundle.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: '[name].bundle.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p><strong>执行 <code>npm run build</code></strong></p> <p>我们可以看到，webpack 生成 <code>print.bundle.js</code> 和 <code>index.bundle.js</code> 文件，这也和我们在 <code>index.html</code> 文件中指定的文件名称相对应。如果你在浏览器中打开 <code>index.html</code>，就可以看到在点击按钮时会发生什么。</p> <p>但是，如果我们更改了我们的一个入口起点的名称，甚至添加了一个新的入口，会发生什么？会在构建时重新命名生成的 bundle，但是我们的 <code>index.html</code> 文件仍然引用旧的名称。让我们用 <a href="https://webpack.docschina.org/plugins/html-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>HtmlWebpackPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来解决这个问题。</p> <h3 id="_2、设置-htmlwebpackplugin"><a href="#_2、设置-htmlwebpackplugin" class="header-anchor">#</a> 2、设置 HtmlWebpackPlugin</h3> <p>首先安装插件，并且调整 <code>webpack.config.js</code> 文件：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev html-webpack-plugin
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix inserted">+</span><span class="token line">      title: '管理输出',
</span><span class="token prefix inserted">+</span><span class="token line">    }),
</span><span class="token prefix inserted">+</span><span class="token line">  ],
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>在我们构建之前，你应该了解，虽然在 <code>dist/</code> 文件夹我们已经有了 <code>index.html</code> 这个文件，然而 <code>HtmlWebpackPlugin</code> 还是会默认生成它自己的 <code>index.html</code> 文件。也就是说，它会用新生成的 <code>index.html</code> 文件，替换我们的原有文件。</p> <p>如果在代码编辑器中打开 <code>index.html</code>，你会看到 <code>HtmlWebpackPlugin</code> 创建了一个全新的文件，所有的 bundle 会自动添加到 html 中。</p> <h3 id="_3、清理-dist-文件夹"><a href="#_3、清理-dist-文件夹" class="header-anchor">#</a> 3、清理 <code>/dist</code> 文件夹</h3> <p>你可能已经注意到，由于遗留了之前的指南和代码示例，我们的 <code>/dist</code> 文件夹显得相当杂乱。webpack 将生成文件并放置在 <code>/dist</code> 文件夹中，但是它不会追踪哪些文件是实际在项目中用到的。</p> <p>通常比较推荐的做法是，在每次构建前清理 <code>/dist</code> 文件夹，这样只会生成用到的文件。让我们实现这个需求。</p> <p><a href="https://www.npmjs.com/package/clean-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>clean-webpack-plugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个流行的清理插件，安装和配置它。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev clean-webpack-plugin
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    new CleanWebpackPlugin(),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: 'Output Management',
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>现在，执行 <code>npm run build</code>，检查 <code>/dist</code> 文件夹。如果一切顺利，现在只会看到构建后生成的文件，而没有旧文件！</p> <h3 id="_4、manifest"><a href="#_4、manifest" class="header-anchor">#</a> 4、manifest</h3> <p>你可能会很感兴趣，webpack 和 webpack 插件似乎“知道”应该生成哪些文件。答案是，webpack 通过 manifest，可以追踪所有模块到输出 bundle 之间的映射。如果你想要知道如何以其他方式来控制 webpack <a href="https://webpack.docschina.org/configuration/output" target="_blank" rel="noopener noreferrer"><code>输出</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，了解 manifest 是个好的开始。</p> <p>通过 <a href="https://github.com/shellscape/webpack-manifest-plugin" target="_blank" rel="noopener noreferrer"><code>WebpackManifestPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件，可以将 manifest 数据提取为一个容易使用的 json 文件。</p> <p>首先安装 webpack-manifest-plugin：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install webpack-manifest-plugin --save-dev
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const { WebpackManifestPlugin } = require('webpack-manifest-plugin')
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line"> entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">   index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">   new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">   new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">     title: '管理输出',
</span><span class="token prefix unchanged"> </span><span class="token line">   }),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   new WebpackManifestPlugin()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ],
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>};
</code></pre></div><p>现在，执行 <code>npm run build</code>，会发现 <code>dist/manifest.json</code>文件，文件内容如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;index.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;autoindex.bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;print.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;autoprint.bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;index.html&quot;</span><span class="token operator">:</span> <span class="token string">&quot;autoindex.html&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="四、开发环境"><a href="#四、开发环境" class="header-anchor">#</a> 四、开发环境</h2> <p>如果你一直跟随之前的指南，应该对一些 webpack 基础知识有着很扎实的理解。在我们继续之前，先来看看如何设置一个开发环境，使我们的开发体验变得更轻松一些。</p> <p>在开始前，我们先将 <a href="https://webpack.docschina.org/configuration/mode/#mode-development" target="_blank" rel="noopener noreferrer"><code>mode</code> 设置为 <code>'development'</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，并将 <code>title</code> 设置为 <code>'Development'</code>。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  mode: 'development',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      title: 'Output Management',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      title: 'Development',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><h3 id="_1、使用-source-map"><a href="#_1、使用-source-map" class="header-anchor">#</a> 1、使用 source-map</h3> <p>当 webpack 打包源代码时，可能会很难追踪到 error(错误) 和 warning(警告) 在源代码中的原始位置。例如，如果将三个源文件（<code>a.js</code>, <code>b.js</code> 和 <code>c.js</code>）打包到一个 bundle（<code>bundle.js</code>）中，而其中一个源文件包含一个错误，那么堆栈跟踪就会直接指向到 <code>bundle.js</code>。你可能需要准确地知道错误来自于哪个源文件，所以这种提示这通常不会提供太多帮助。</p> <p>为了更容易地追踪 error 和 warning，JavaScript 提供了 <a href="http://blog.teamtreehouse.com/introduction-source-maps" target="_blank" rel="noopener noreferrer">source maps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 功能，可以将编译后的代码映射回原始源代码。如果一个错误来自于 <code>b.js</code>，source map 就会明确的告诉你。</p> <h4 id="_1-devtool-配置说明表"><a href="#_1-devtool-配置说明表" class="header-anchor">#</a> (1) devtool 配置说明表</h4> <table><thead><tr><th style="text-align:left;">devtool</th> <th style="text-align:left;">performance</th> <th style="text-align:left;">production</th> <th style="text-align:left;">quality</th> <th style="text-align:left;">comment</th></tr></thead> <tbody><tr><td style="text-align:left;">(none)</td> <td style="text-align:left;"><strong>build</strong>: fastest  <strong>rebuild</strong>: fastest</td> <td style="text-align:left;">yes</td> <td style="text-align:left;">bundle</td> <td style="text-align:left;">Recommended choice for production builds with maximum performance.</td></tr> <tr><td style="text-align:left;"><strong><code>eval</code></strong></td> <td style="text-align:left;"><strong>build</strong>: fast  <strong>rebuild</strong>: fastest</td> <td style="text-align:left;">no</td> <td style="text-align:left;">generated</td> <td style="text-align:left;">Recommended choice for development builds with maximum performance.</td></tr> <tr><td style="text-align:left;"><code>eval-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: fast</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">Tradeoff choice for development builds.</td></tr> <tr><td style="text-align:left;"><code>eval-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: fast</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">Tradeoff choice for development builds.</td></tr> <tr><td style="text-align:left;"><strong><code>eval-source-map</code></strong></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: ok</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original</td> <td style="text-align:left;">Recommended choice for development builds with high quality SourceMaps.</td></tr> <tr><td style="text-align:left;"><code>cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><strong><code>source-map</code></strong></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">yes</td> <td style="text-align:left;">original</td> <td style="text-align:left;">Recommended choice for production builds with high quality SourceMaps.</td></tr> <tr><td style="text-align:left;"><code>inline-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>inline-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>inline-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original</td> <td style="text-align:left;">Possible choice when publishing a single file</td></tr> <tr><td style="text-align:left;"><code>eval-nosources-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: fast</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>eval-nosources-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: fast</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>eval-nosources-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: ok</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>inline-nosources-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>inline-nosources-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>inline-nosources-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>nosources-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>nosources-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>nosources-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">yes</td> <td style="text-align:left;">original</td> <td style="text-align:left;">source code not included</td></tr> <tr><td style="text-align:left;"><code>hidden-nosources-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">no reference, source code not included</td></tr> <tr><td style="text-align:left;"><code>hidden-nosources-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">no reference, source code not included</td></tr> <tr><td style="text-align:left;"><code>hidden-nosources-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">yes</td> <td style="text-align:left;">original</td> <td style="text-align:left;">no reference, source code not included</td></tr> <tr><td style="text-align:left;"><code>hidden-cheap-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: ok  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">transformed</td> <td style="text-align:left;">no reference</td></tr> <tr><td style="text-align:left;"><code>hidden-cheap-module-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slow  <strong>rebuild</strong>: slow</td> <td style="text-align:left;">no</td> <td style="text-align:left;">original lines</td> <td style="text-align:left;">no reference</td></tr> <tr><td style="text-align:left;"><code>hidden-source-map</code></td> <td style="text-align:left;"><strong>build</strong>: slowest  <strong>rebuild</strong>: slowest</td> <td style="text-align:left;">yes</td> <td style="text-align:left;">original</td> <td style="text-align:left;">no reference. Possible choice when using SourceMap only for error reporting purposes.</td></tr></tbody></table> <ul><li><p><strong>开发环境推荐配置</strong></p> <p>以下选项非常适合开发环境：</p> <p><code>eval</code> - 每个模块都使用 <code>eval()</code> 执行，并且都有 <code>//@ sourceURL</code>。此选项会非常快地构建。主要缺点是，由于会映射到转换后的代码，而不是映射到原始代码（没有从 loader 中获取 source map），所以不能正确的显示行数。</p> <p><code>eval-source-map</code> - 每个模块使用 <code>eval()</code> 执行，并且 source map 转换为 DataUrl 后添加到 <code>eval()</code> 中。初始化 source map 时比较慢，但是会在重新构建时提供比较快的速度，并且生成实际的文件。行数能够正确映射，因为会映射到原始代码中。它会生成用于开发环境的最佳品质的 source map。</p> <p><code>eval-cheap-source-map</code> - 类似 <code>eval-source-map</code>，每个模块使用 <code>eval()</code> 执行。这是 &quot;cheap(低开销)&quot; 的 source map，因为它没有生成列映射(column mapping)，只是映射行数。它会忽略源自 loader 的 source map，并且仅显示转译后的代码，就像 <code>eval</code> devtool。</p> <p><code>eval-cheap-module-source-map</code> - 类似 <code>eval-cheap-source-map</code>，并且，在这种情况下，源自 loader 的 source map 会得到更好的处理结果。然而，loader source map 会被简化为每行一个映射(mapping)。</p></li> <li><p><strong>生产环境推荐配置</strong></p> <p>这些选项通常用于生产环境中：</p> <p><code>(none)</code>（省略 <code>devtool</code> 选项） - 不生成 source map。这是一个不错的选择。</p> <p><code>source-map</code> - 整个 source map 作为一个单独的文件生成。它为 bundle 添加了一个引用注释，以便开发工具知道在哪里可以找到它。</p> <p><code>hidden-source-map</code> - 与 <code>source-map</code> 相同，但不会为 bundle 添加引用注释。如果你只想 source map 映射那些源自错误报告的错误堆栈跟踪信息，但不想为浏览器开发工具暴露你的 source map，这个选项会很有用。</p> <p><code>nosources-source-map</code> - 创建的 source map 不包含 <code>sourcesContent(源代码内容)</code>。它可以用来映射客户端上的堆栈跟踪，而无须暴露所有的源代码。你可以将 source map 文件部署到 web 服务器。</p></li></ul> <p>###(2) 配置示例</p> <p>webpack 仓库中包含一个 <a href="https://github.com/webpack/webpack/tree/master/examples/source-map" target="_blank" rel="noopener noreferrer">显示所有 <code>devtool</code> 变体效果的示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这些例子或许会有助于你理解这些差异之处。</p> <p><strong>example.coffee</strong></p> <div class="language- extra-class"><pre class="language-text"><code>## Taken from http://coffeescript.org/

## Objects:
math =
  root:   Math.sqrt
  square: square
  cube:   (x) -&gt; x * square x

## Splats:
race = (winner, runners...) -&gt;
  print winner, runners
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language- extra-class"><pre class="language-text"><code>var path = require(&quot;path&quot;);

module.exports = [
	&quot;eval&quot;,
	&quot;eval-cheap-source-map&quot;,
	&quot;eval-cheap-module-source-map&quot;,
	&quot;eval-source-map&quot;,
	&quot;cheap-source-map&quot;,
	&quot;cheap-module-source-map&quot;,
	&quot;inline-cheap-source-map&quot;,
	&quot;inline-cheap-module-source-map&quot;,
	&quot;source-map&quot;,
	&quot;inline-source-map&quot;,
	&quot;hidden-source-map&quot;,
	&quot;nosources-source-map&quot;
].map(devtool =&gt; ({
	mode: &quot;development&quot;,
	entry: {
		bundle: &quot;coffee-loader!./example.coffee&quot;
	},
	output: {
		path: path.join(__dirname, &quot;dist&quot;),
		filename: `./[name]-${devtool}.js`
	},
	devtool,
	optimization: {
		runtimeChunk: true
	}
}));
</code></pre></div><p><strong>Generated source-maps</strong></p> <ul><li>source-map.js and source-map.js.map</li></ul> <div class="language- extra-class"><pre class="language-text"><code>(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

// Taken from http://coffeescript.org/

// Objects:
var math, race;

math = {
  root: Math.sqrt,
  square: square,
  cube: function(x) {
    return x * square(x);
  }
};

// Splats:
race = function(winner, ...runners) {
  return print(winner, runners);
};


/***/ })
],
0,[[0,1]]]);
//## sourceMappingURL=bundle-source-map.js.map
{&quot;version&quot;:3,&quot;sources&quot;:[&quot;webpack:///./example.coffee&quot;],&quot;names&quot;:[],&quot;mappings&quot;:&quot;;;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK&quot;,&quot;file&quot;:&quot;./bundle-source-map.js&quot;,&quot;sourcesContent&quot;:[&quot;## Taken from http://coffeescript.org/\n\n## Objects:\nmath =\n  root:   Math.sqrt\n  square: square\n  cube:   (x) -&gt; x * square x\n\n## Splats:\nrace = (winner, runners...) -&gt;\n  print winner, runners\n&quot;],&quot;sourceRoot&quot;:&quot;&quot;}
</code></pre></div><ul><li>hidden-source-map.js and hidden-source-map.js.map</li></ul> <div class="language- extra-class"><pre class="language-text"><code>(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

// Taken from http://coffeescript.org/

// Objects:
var math, race;

math = {
  root: Math.sqrt,
  square: square,
  cube: function(x) {
    return x * square(x);
  }
};

// Splats:
race = function(winner, ...runners) {
  return print(winner, runners);
};


/***/ })
],
0,[[0,1]]]);
{&quot;version&quot;:3,&quot;sources&quot;:[&quot;webpack:///./example.coffee&quot;],&quot;names&quot;:[],&quot;mappings&quot;:&quot;;;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK&quot;,&quot;file&quot;:&quot;./bundle-hidden-source-map.js&quot;,&quot;sourcesContent&quot;:[&quot;## Taken from http://coffeescript.org/\n\n## Objects:\nmath =\n  root:   Math.sqrt\n  square: square\n  cube:   (x) -&gt; x * square x\n\n## Splats:\nrace = (winner, runners...) -&gt;\n  print winner, runners\n&quot;],&quot;sourceRoot&quot;:&quot;&quot;}
</code></pre></div><ul><li>inline-source-map.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

// Taken from http://coffeescript.org/

// Objects:
var math, race;

math = {
  root: Math.sqrt,
  square: square,
  cube: function(x) {
    return x * square(x);
  }
};

// Splats:
race = function(winner, ...runners) {
  return print(winner, runners);
};


/***/ })
],
0,[[0,1]]]);
//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9leGFtcGxlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFVTs7O0FBQUE7O0FBQ1YsT0FDRTtFQUFBLE1BQVEsSUFBSSxDQUFDLElBQWI7RUFDQSxRQUFRLE1BRFI7RUFFQSxNQUFRLFNBQUMsQ0FBRDtXQUFPLElBQUksT0FBTyxDQUFQO0VBQVg7QUFGUixFQUZROzs7QUFPVixPQUFPLFNBQUMsTUFBRCxLQUFTLE9BQVQ7U0FDTCxNQUFNLE1BQU4sRUFBYyxPQUFkO0FBREsiLCJmaWxlIjoiLi9idW5kbGUtaW5saW5lLXNvdXJjZS1tYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIjIFRha2VuIGZyb20gaHR0cDovL2NvZmZlZXNjcmlwdC5vcmcvXG5cbiMgT2JqZWN0czpcbm1hdGggPVxuICByb290OiAgIE1hdGguc3FydFxuICBzcXVhcmU6IHNxdWFyZVxuICBjdWJlOiAgICh4KSAtPiB4ICogc3F1YXJlIHhcblxuIyBTcGxhdHM6XG5yYWNlID0gKHdpbm5lciwgcnVubmVycy4uLikgLT5cbiAgcHJpbnQgd2lubmVyLCBydW5uZXJzXG4iXSwic291cmNlUm9vdCI6IiJ9
</code></pre></div><ul><li>nosources-source-map.js.map</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{&quot;version&quot;:3,&quot;sources&quot;:[&quot;webpack:///./example.coffee&quot;],&quot;names&quot;:[],&quot;mappings&quot;:&quot;;;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK&quot;,&quot;file&quot;:&quot;./bundle-nosources-source-map.js&quot;,&quot;sourceRoot&quot;:&quot;&quot;}
</code></pre></div><ul><li>eval-source-map.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>/*
 * ATTENTION: An &quot;eval-source-map&quot; devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses &quot;eval()&quot; calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with &quot;devtool: false&quot;.
 * If you are looking for production-ready output files, see mode: &quot;production&quot; (https://webpack.js.org/configuration/mode/).
 */
(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

eval(&quot;// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n//## sourceURL=[module]\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vZXhhbXBsZS5jb2ZmZWU/MjQxNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFVTs7O0FBQUEsSUFBQSxJQUFBLEVBQUE7O0FBQ1YsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFRLElBQUksQ0FBQyxJQUFiO0VBQ0EsTUFBQSxFQUFRLE1BRFI7RUFFQSxJQUFBLEVBQVEsUUFBQSxDQUFDLENBQUQsQ0FBQTtXQUFPLENBQUEsR0FBSSxNQUFBLENBQU8sQ0FBUDtFQUFYO0FBRlIsRUFGUTs7O0FBT1YsSUFBQSxHQUFPLFFBQUEsQ0FBQyxNQUFELEVBQUEsR0FBUyxPQUFULENBQUE7U0FDTCxLQUFBLENBQU0sTUFBTixFQUFjLE9BQWQ7QUFESyIsInNvdXJjZXNDb250ZW50IjpbIiMgVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuIyBPYmplY3RzOlxubWF0aCA9XG4gIHJvb3Q6ICAgTWF0aC5zcXJ0XG4gIHNxdWFyZTogc3F1YXJlXG4gIGN1YmU6ICAgKHgpIC0+IHggKiBzcXVhcmUgeFxuXG4jIFNwbGF0czpcbnJhY2UgPSAod2lubmVyLCBydW5uZXJzLi4uKSAtPlxuICBwcmludCB3aW5uZXIsIHJ1bm5lcnNcbiJdLCJmaWxlIjoiMC5qcyJ9\n//## sourceURL=webpack-internal:///0\n&quot;);

/***/ })
],
0,[[0,1]]]);
</code></pre></div><ul><li>eval.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>/*
 * ATTENTION: The &quot;eval&quot; devtool has been used (maybe by default in mode: &quot;development&quot;).
 * This devtool is neither made for production nor for readable output files.
 * It uses &quot;eval()&quot; calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with &quot;devtool: false&quot;.
 * If you are looking for production-ready output files, see mode: &quot;production&quot; (https://webpack.js.org/configuration/mode/).
 */
(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

eval(&quot;// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n\n\n//## sourceURL=webpack:///./example.coffee?../../node_modules/coffee-loader/dist/cjs.js&quot;);

/***/ })
],
0,[[0,1]]]);
</code></pre></div><ul><li>eval-cheap-source-map.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>/*
 * ATTENTION: An &quot;eval-source-map&quot; devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses &quot;eval()&quot; calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with &quot;devtool: false&quot;.
 * If you are looking for production-ready output files, see mode: &quot;production&quot; (https://webpack.js.org/configuration/mode/).
 */
(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

eval(&quot;// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n//## sourceURL=[module]\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2V4YW1wbGUuY29mZmVlP2VlNTgiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuLy8gT2JqZWN0czpcbnZhciBtYXRoLCByYWNlO1xuXG5tYXRoID0ge1xuICByb290OiBNYXRoLnNxcnQsXG4gIHNxdWFyZTogc3F1YXJlLFxuICBjdWJlOiBmdW5jdGlvbih4KSB7XG4gICAgcmV0dXJuIHggKiBzcXVhcmUoeCk7XG4gIH1cbn07XG5cbi8vIFNwbGF0czpcbnJhY2UgPSBmdW5jdGlvbih3aW5uZXIsIC4uLnJ1bm5lcnMpIHtcbiAgcmV0dXJuIHByaW50KHdpbm5lciwgcnVubmVycyk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//## sourceURL=webpack-internal:///0\n&quot;);

/***/ })
],
0,[[0,1]]]);
</code></pre></div><ul><li>eval-cheap-module-source-map.js</li></ul> <div class="language- extra-class"><pre class="language-text"><code>/*
 * ATTENTION: An &quot;eval-source-map&quot; devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses &quot;eval()&quot; calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with &quot;devtool: false&quot;.
 * If you are looking for production-ready output files, see mode: &quot;production&quot; (https://webpack.js.org/configuration/mode/).
 */
(self[&quot;webpackChunk&quot;] = self[&quot;webpackChunk&quot;] || []).push([[0],[
/* 0 */
/*!*********************************************************************!*\
  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!
  \*********************************************************************/
/*! unknown exports (runtime-defined) */
/*! runtime requirements:  */
/***/ (() =&gt; {

eval(&quot;// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n//## sourceURL=[module]\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vZXhhbXBsZS5jb2ZmZWU/MjQxNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFVTs7O0FBQUEsSUFBQSxJQUFBLEVBQUE7O0FBQ1YsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFRLElBQUksQ0FBQyxJQUFiO0VBQ0EsTUFBQSxFQUFRLE1BRFI7RUFFQSxJQUFBLEVBQVEsUUFBQSxDQUFDLENBQUQsQ0FBQTtXQUFPLENBQUEsR0FBSSxNQUFBLENBQU8sQ0FBUDtFQUFYO0FBRlIsRUFGUTs7O0FBT1YsSUFBQSxHQUFPLFFBQUEsQ0FBQyxNQUFELEVBQUEsR0FBUyxPQUFULENBQUE7U0FDTCxLQUFBLENBQU0sTUFBTixFQUFjLE9BQWQ7QUFESyIsInNvdXJjZXNDb250ZW50IjpbIiMgVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuIyBPYmplY3RzOlxubWF0aCA9XG4gIHJvb3Q6ICAgTWF0aC5zcXJ0XG4gIHNxdWFyZTogc3F1YXJlXG4gIGN1YmU6ICAgKHgpIC0+IHggKiBzcXVhcmUgeFxuXG4jIFNwbGF0czpcbnJhY2UgPSAod2lubmVyLCBydW5uZXJzLi4uKSAtPlxuICBwcmludCB3aW5uZXIsIHJ1bm5lcnNcbiJdLCJmaWxlIjoiMC5qcyJ9\n//## sourceURL=webpack-internal:///0\n&quot;);

/***/ })
],
0,[[0,1]]]);
</code></pre></div><ul><li>cheap-module-source-map.js.map</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{&quot;version&quot;:3,&quot;file&quot;:&quot;./bundle-cheap-module-source-map.js&quot;,&quot;sources&quot;:[&quot;webpack:///./example.coffee&quot;],&quot;sourcesContent&quot;:[&quot;## Taken from http://coffeescript.org/\n\n## Objects:\nmath =\n  root:   Math.sqrt\n  square: square\n  cube:   (x) -&gt; x * square x\n\n## Splats:\nrace = (winner, runners...) -&gt;\n  print winner, runners\n&quot;],&quot;mappings&quot;:&quot;;;;;;;;;;AAEA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAFA;AACA;;AAIA;AACA;AADA;AACA;AACA;A;;A&quot;,&quot;sourceRoot&quot;:&quot;&quot;}
</code></pre></div><ul><li>cheap-source-map.js.map</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{&quot;version&quot;:3,&quot;file&quot;:&quot;./bundle-cheap-source-map.js&quot;,&quot;sources&quot;:[&quot;webpack:///./example.coffee&quot;],&quot;sourcesContent&quot;:[&quot;// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n&quot;],&quot;mappings&quot;:&quot;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;A&quot;,&quot;sourceRoot&quot;:&quot;&quot;}
</code></pre></div><h4 id="_3-演练"><a href="#_3-演练" class="header-anchor">#</a> (3) 演练</h4> <p>对于本指南，我们将使用 <code>inline-source-map</code> 选项，这有助于解释说明示例意图（此配置仅用于示例，不要用于生产环境）：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  devtool: 'inline-source-map',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: 'Development',
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>现在，让我们来做一些调试，在 <code>print.js</code> 文件中生成一个错误：</p> <p><strong>src/print.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  console.log('I get called from print.js!');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  cosnole.log('I get called from print.js!');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>**运行 <code>npm run build**</code></p> <p>现在，在浏览器中打开生成的 <code>index.html</code> 文件，点击按钮，并且在控制台查看显示的错误。错误应该如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Uncaught ReferenceError: cosnole is not defined
   at HTMLButtonElement.printMe <span class="token punctuation">(</span>print.js:2<span class="token punctuation">)</span>
</code></pre></div><p>我们可以看到，此错误包含有发生错误的文件（<code>print.js</code>）和行号（2）的引用。这是非常有帮助的，因为现在我们可以确切地知道，所要解决问题的位置。</p> <h3 id="_2、选择一个开发工具"><a href="#_2、选择一个开发工具" class="header-anchor">#</a> 2、选择一个开发工具</h3> <p>在每次编译代码时，手动运行 <code>npm run build</code> 会显得很麻烦。</p> <p>webpack 提供几种可选方式，帮助你在代码发生变化后自动编译代码：</p> <ul><li>webpack's <a href="https://webpack.docschina.org/configuration/watch/#watch" target="_blank" rel="noopener noreferrer">Watch Mode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener noreferrer">webpack-dev-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/webpack/webpack-dev-middleware" target="_blank" rel="noopener noreferrer">webpack-dev-middleware<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>多数场景中，你可能需要使用 <code>webpack-dev-server</code>，但是不妨探讨一下以上的所有选项。</p> <h4 id="_1-使用-watch-mode-观察模式"><a href="#_1-使用-watch-mode-观察模式" class="header-anchor">#</a> (1) 使用 watch mode(<em>观察模式</em>)</h4> <p>你可以指示 webpack &quot;watch&quot; 依赖图中所有文件的更改。如果其中一个文件被更新，代码将被重新编译，所以你不必再去手动运行整个构建。</p> <p>我们添加一个用于启动 webpack watch mode 的 npm scripts：</p> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>如果不想在 watch 触发增量构建后删除 <code>index.html</code> 文件，可以在 <code>CleanWebpackPlugin</code> 中配置 <a href="https://github.com/johnagan/clean-webpack-plugin#options-and-defaults-optional" target="_blank" rel="noopener noreferrer"><code>cleanStaleWebpackAssets</code> 选项<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  devtool: 'inline-source-map',
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    new CleanWebpackPlugin(),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: 'Development',
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>现在，你可以在命令行中运行 <code>npm run watch</code>，然后就会看到 webpack 是如何编译代码。 然而，你会发现并没有退出命令行。这是因为此 script 当前还在 watch 你的文件。</p> <p>现在，webpack 观察文件的同时，先移除我们之前加入的错误：</p> <p><strong>src/print.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  cosnole.log('I get called from print.js!');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log('I get called from print.js!');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>现在，保存文件并检查 terminal(终端) 窗口。应该可以看到 webpack 自动地重新编译修改后的模块！</p> <p>唯一的缺点是，为了看到修改后的实际效果，你需要刷新浏览器。如果能够自动刷新浏览器就更好了，因此接下来我们会尝试通过 <code>webpack-dev-server</code> 实现此功能。</p> <h4 id="_2-使用-webpack-dev-server"><a href="#_2-使用-webpack-dev-server" class="header-anchor">#</a> (2) 使用 webpack-dev-server</h4> <p><code>webpack-dev-server</code> 为你提供了一个简单的 web server，并且具有 live reloading(实时重新加载) 功能。设置如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-dev-server
</code></pre></div><p>修改配置文件，告知 dev server，从什么位置查找文件：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  devtool: 'inline-source-map',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  devServer: {
</span><span class="token prefix inserted">+</span><span class="token line">    contentBase: './dist',
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: 'Development',
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>以上配置告知 <code>webpack-dev-server</code>，将 <code>dist</code> 目录下的文件 serve 到 <code>localhost:8080</code> 下。</p> <p>我们添加一个可以直接运行 dev server 的 script：</p> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-server&quot;: &quot;^3.11.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>现在，在命令行中运行 <code>npm start</code>，我们会看到浏览器自动加载页面。如果你更改任何源文件并保存它们，web server 将在编译代码后自动重新加载。试试看！</p> <h4 id="_3-使用-webpack-dev-middleware"><a href="#_3-使用-webpack-dev-middleware" class="header-anchor">#</a> (3) 使用 webpack-dev-middleware</h4> <p><code>webpack-dev-middleware</code> 是一个封装器(wrapper)，它可以把 webpack 处理过的文件发送到一个 server。 <code>webpack-dev-server</code> 在内部使用了它，然而它也可以作为一个单独的 package 来使用，以便根据需求进行更多自定义设置。下面是一个 webpack-dev-middleware 配合 express server 的示例。</p> <p>首先，安装 <code>express</code> 和 <code>webpack-dev-middleware</code>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev express webpack-dev-middleware
</code></pre></div><p>现在，我们需要调整 webpack 配置文件，以确保 middleware(中间件) 功能能够正确启用：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    print: './src/print.js',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  devtool: 'inline-source-map',
</span><span class="token prefix unchanged"> </span><span class="token line">  devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">    contentBase: './dist',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),
</span><span class="token prefix unchanged"> </span><span class="token line">    new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">      title: 'Development',
</span><span class="token prefix unchanged"> </span><span class="token line">    }),
</span><span class="token prefix unchanged"> </span><span class="token line">  ],
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    publicPath: '/',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>我们将会在 server 脚本使用 <code>publicPath</code>，以确保文件资源能够正确地 serve 在 <code>http://localhost:3000</code> 下，稍后我们会指定 port number(端口号)。接下来是设置自定义 <code>express</code> server：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- server.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- print.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>server.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 告知 express 使用 webpack-dev-middleware，</span>
<span class="token comment">// 以及将 webpack.config.js 配置文件作为基础配置。</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将文件 serve 到 port 3000。</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Example app listening on port 3000!\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，添加一个 npm script，以使我们更方便地运行 server：</p> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">{
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;watch&quot;: &quot;webpack --watch&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;server&quot;: &quot;node server.js&quot;,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;express&quot;: &quot;^4.17.1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;html-webpack-plugin&quot;: &quot;^4.5.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack&quot;: &quot;^5.4.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-cli&quot;: &quot;^4.2.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-middleware&quot;: &quot;^4.0.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;webpack-dev-server&quot;: &quot;^3.11.0&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  &quot;dependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">    &quot;lodash&quot;: &quot;^4.17.20&quot;
</span><span class="token prefix unchanged"> </span><span class="token line">  }
</span><span class="token prefix unchanged"> </span><span class="token line">}
</span></span></code></pre></div><p>现在，在 terminal(终端) 中执行 <code>npm run server</code>，将会有类似如下信息输出：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Example app listening on port <span class="token number">3000</span><span class="token operator">!</span>
<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> asset index.bundle.js <span class="token number">1.38</span> MiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> asset print.bundle.js <span class="token number">6.25</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: print<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> asset index.html <span class="token number">274</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> runtime modules <span class="token number">1.9</span> KiB <span class="token number">9</span> modules
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> cacheable modules <span class="token number">530</span> KiB
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./src/index.js <span class="token number">406</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./src/print.js <span class="token number">83</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>   ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">709</span> ms
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiled successfully.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiling<span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> assets by status <span class="token number">1.38</span> MiB <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">2</span> assets
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> cached modules <span class="token number">530</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">1.9</span> KiB <span class="token punctuation">(</span>runtime<span class="token punctuation">)</span> <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">12</span> modules
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">19</span> ms
<span class="token operator">&lt;</span>i<span class="token operator">&gt;</span> <span class="token punctuation">[</span>webpack-dev-middleware<span class="token punctuation">]</span> Compiled successfully.
</code></pre></div><p>现在，打开浏览器，访问 <code>http://localhost:3000</code>。应该看到 webpack 应用程序已经运行！</p> <h2 id="五、代码分离"><a href="#五、代码分离" class="header-anchor">#</a> 五、代码分离</h2> <p>代码分离是 webpack 中最引人注目的特性之一。此特性能够把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。</p> <p>常用的代码分离方法有三种：</p> <ul><li><strong>入口起点</strong>：使用 <a href="https://webpack.docschina.org/configuration/entry-context" target="_blank" rel="noopener noreferrer"><code>entry</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置手动地分离代码。</li> <li><strong>防止重复</strong>：使用 <a href="https://webpack.docschina.org/configuration/entry-context/#dependencies" target="_blank" rel="noopener noreferrer">Entry dependencies<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin" target="_blank" rel="noopener noreferrer"><code>SplitChunksPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 去重和分离 chunk。</li> <li><strong>动态导入</strong>：通过模块的内联函数调用来分离代码。</li></ul> <h3 id="_1、入口起点-entry-point"><a href="#_1、入口起点-entry-point" class="header-anchor">#</a> 1、入口起点(entry point)</h3> <p>这是迄今为止最简单直观的分离代码的方式。不过，这种方式手动配置较多，并有一些隐患，我们将会解决这些问题。先来看看如何从 main bundle 中分离 another module(另一个模块)：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- another-module.js
</span></span>|- /node_modules
</code></pre></div><p><strong>another-module.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Another'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'loaded!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  entry: './src/index.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  mode: 'development',
</span><span class="token prefix inserted">+</span><span class="token line">  entry: {
</span><span class="token prefix inserted">+</span><span class="token line">    index: './src/index.js',
</span><span class="token prefix inserted">+</span><span class="token line">    another: './src/another-module.js',
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    filename: 'main.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    filename: '[name].bundle.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>正如前面提到的，这种方式存在一些隐患：</p> <ul><li>如果入口 chunk 之间包含一些重复的模块，那些重复模块都会被引入到各个 bundle 中。</li> <li>这种方法不够灵活，并且不能动态地将核心应用程序逻辑中的代码拆分出来。</li></ul> <p>以上两点中，第一点对我们的示例来说无疑是个问题，因为之前我们在 <code>./src/index.js</code> 中也引入过 <code>lodash</code>，这样就在两个 bundle 中造成重复引用。在下一章节会移除重复的模块。</p> <h3 id="_2、防止重复-prevent-duplication"><a href="#_2、防止重复-prevent-duplication" class="header-anchor">#</a> 2、防止重复(prevent duplication)</h3> <h4 id="_1-入口依赖"><a href="#_1-入口依赖" class="header-anchor">#</a> (1) 入口依赖</h4> <p>配置 <a href="https://webpack.docschina.org/configuration/entry-context/#dependencies" target="_blank" rel="noopener noreferrer"><code>dependOn</code> option<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项，这样可以在多个 chunk 之间共享模块：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    index: './src/index.js',
</span><span class="token prefix deleted">-</span><span class="token line">    another: './src/another-module.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    index: {
</span><span class="token prefix inserted">+</span><span class="token line">      import: './src/index.js',
</span><span class="token prefix inserted">+</span><span class="token line">      dependOn: 'shared',
</span><span class="token prefix inserted">+</span><span class="token line">    },
</span><span class="token prefix inserted">+</span><span class="token line">    another: {
</span><span class="token prefix inserted">+</span><span class="token line">      import: './src/another-module.js',
</span><span class="token prefix inserted">+</span><span class="token line">      dependOn: 'shared',
</span><span class="token prefix inserted">+</span><span class="token line">    },
</span><span class="token prefix inserted">+</span><span class="token line">    shared: 'lodash',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>如果我们要在一个 HTML 页面上使用多个入口时，还需设置 <code>optimization.runtimeChunk: 'single'</code>，否则还会遇到<a href="https://bundlers.tooling.report/code-splitting/multi-entry/" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>所述的麻烦。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: {
</span><span class="token prefix unchanged"> </span><span class="token line">      import: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">      dependOn: 'shared',
</span><span class="token prefix unchanged"> </span><span class="token line">    },
</span><span class="token prefix unchanged"> </span><span class="token line">    another: {
</span><span class="token prefix unchanged"> </span><span class="token line">      import: './src/another-module.js',
</span><span class="token prefix unchanged"> </span><span class="token line">      dependOn: 'shared',
</span><span class="token prefix unchanged"> </span><span class="token line">    },
</span><span class="token prefix unchanged"> </span><span class="token line">    shared: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">    runtimeChunk: 'single',
</span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>构建结果如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset shared.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: shared<span class="token punctuation">)</span>
asset runtime.bundle.js <span class="token number">7.79</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: runtime<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">1.77</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset another.bundle.js <span class="token number">1.65</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: another<span class="token punctuation">)</span>
Entrypoint index <span class="token number">1.77</span> KiB <span class="token operator">=</span> index.bundle.js
Entrypoint another <span class="token number">1.65</span> KiB <span class="token operator">=</span> another.bundle.js
Entrypoint shared <span class="token number">557</span> KiB <span class="token operator">=</span> runtime.bundle.js <span class="token number">7.79</span> KiB shared.bundle.js <span class="token number">549</span> KiB
runtime modules <span class="token number">3.76</span> KiB <span class="token number">7</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/another-module.js <span class="token number">84</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">249</span> ms
</code></pre></div><p>由上可知，除了生成 <code>shared.bundle.js</code>，<code>index.bundle.js</code> 和 <code>another.bundle.js</code> 之外，还生成了一个 <code>runtime.bundle.js</code> 文件。</p> <p>尽管可以在 webpack 中允许每个页面使用多入口，应尽可能避免使用多入口：<code>entry: { page: ['./analytics', './app'] }</code>。如此，在使用 <code>async</code> 脚本标签时，会有更好的优化以及一致的执行顺序。</p> <h4 id="_2-splitchunksplugin"><a href="#_2-splitchunksplugin" class="header-anchor">#</a> (2) SplitChunksPlugin</h4> <p><a href="https://webpack.docschina.org/plugins/split-chunks-plugin" target="_blank" rel="noopener noreferrer"><code>SplitChunksPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。让我们使用这个插件，将之前的示例中重复的 <code>lodash</code> 模块去除：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">     index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     another: './src/another-module.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">     splitChunks: {
</span><span class="token prefix inserted">+</span><span class="token line">       chunks: 'all',
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>使用 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks" target="_blank" rel="noopener noreferrer"><code>optimization.splitChunks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置选项之后，现在应该可以看出，<code>index.bundle.js</code> 和 <code>another.bundle.js</code> 中已经移除了重复的依赖模块。需要注意的是，插件将 <code>lodash</code> 分离到单独的 chunk，并且将其从 main bundle 中移除，减轻了大小。执行 <code>npm run build</code> 查看效果：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">8.92</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
asset another.bundle.js <span class="token number">8.8</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: another<span class="token punctuation">)</span>
Entrypoint index <span class="token number">558</span> KiB <span class="token operator">=</span> vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB index.bundle.js <span class="token number">8.92</span> KiB
Entrypoint another <span class="token number">558</span> KiB <span class="token operator">=</span> vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB another.bundle.js <span class="token number">8.8</span> KiB
runtime modules <span class="token number">7.64</span> KiB <span class="token number">14</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">257</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./src/another-module.js <span class="token number">84</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">241</span> ms
</code></pre></div><h4 id="_3-其他分割工具"><a href="#_3-其他分割工具" class="header-anchor">#</a> (3) 其他分割工具</h4> <p>以下是由社区提供，一些对于代码分离很有帮助的 plugin 和 loader：</p> <ul><li><a href="https://www.npmjs.com/package/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer"><code>mini-css-extract-plugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: 用于将 CSS 从主应用程序中分离。</li></ul> <p>首先，需要安装 <code>mini-css-extract-plugin</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev mini-css-extract-plugin css-loader
</code></pre></div><p>推荐将 <code>mini-css-extract-plugin</code> 与 <a href="https://github.com/webpack-contrib/css-loader" target="_blank" rel="noopener noreferrer"><code>css-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 结合使用。</p> <p>接下来创建文件配置Webpack：</p> <p><strong>src/style.css</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>import _ from 'lodash'
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import './styles.css'
</span></span>
function component() {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const element = document.createElement('div')
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> element.innerHTML = _.join(['Hello', 'webpack'], ' ')
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return element
</span></span>}

document.body.appendChild(component())
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path')
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const MiniCssExtractPlugin = require('mini-css-extract-plugin')
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line"> entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">   index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   another: './src/another-module.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> 
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> module: {
</span><span class="token prefix inserted">+</span><span class="token line">   rules: [
</span><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.css$/i,
</span><span class="token prefix inserted">+</span><span class="token line">       use: [MiniCssExtractPlugin.loader, 'css-loader'],
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">   ],
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span><span class="token prefix inserted">+</span><span class="token line"> plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">   new MiniCssExtractPlugin()
</span><span class="token prefix inserted">+</span><span class="token line"> ],
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> optimization: {
</span><span class="token prefix unchanged"> </span><span class="token line">   splitChunks: {
</span><span class="token prefix unchanged"> </span><span class="token line">     chunks: 'all',
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>}
</code></pre></div><p>执行<code>npm run build</code>结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>assets by status 555 KiB [compared for emit]
  asset vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB [compared for emit] (id hint: vendors)
  asset another.bundle.js 8.68 KiB [compared for emit] (name: another)
assets by status 9.26 KiB [emitted]
  asset index.bundle.js 9.23 KiB [emitted] (name: index)
  asset index.css 30 bytes [emitted] (name: index)
Entrypoint index 556 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB index.css 30 bytes index.bundle.js 9.23 KiB
Entrypoint another 555 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB another.bundle.js 8.68 KiB
runtime modules 7.64 KiB 14 modules
code generated modules 528 KiB (javascript) 29 bytes (css/mini-extract) [code generated]
  modules by path ./src/*.js 316 bytes
    ./src/index.js 232 bytes [built] [code generated]
    ./src/another-module.js 84 bytes [built] [code generated]
  modules by path ./src/*.css 50 bytes (javascript) 29 bytes (css/mini-extract)
    ./src/style.css 50 bytes [built] [code generated]
    css ./node_modules/css-loader/dist/cjs.js!./src/style.css 29 bytes [code generated]
  ../../../node_modules/lodash/lodash.js 528 KiB [built] [code generated]
webpack 5.21.0 compiled successfully in 594 ms
✨  Done in 1.44s.
</code></pre></div><p>如上所见，<code>./src/style.css</code>被单独的打包出来。</p> <h3 id="_3、动态导入-dynamic-import"><a href="#_3、动态导入-dynamic-import" class="header-anchor">#</a> 3、动态导入(dynamic import)</h3> <p>当涉及到动态代码拆分时，webpack 提供了两个类似的技术。第一种，也是推荐选择的方式是，使用符合 <a href="https://github.com/tc39/proposal-dynamic-import" target="_blank" rel="noopener noreferrer">ECMAScript 提案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://webpack.docschina.org/api/module-methods/#import-1" target="_blank" rel="noopener noreferrer"><code>import()</code> 语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现动态导入。第二种，则是 webpack 的遗留功能，使用 webpack 特定的 <a href="https://webpack.docschina.org/api/module-methods/#requireensure" target="_blank" rel="noopener noreferrer"><code>require.ensure</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。让我们先尝试使用第一种……</p> <p>在我们开始之前，先从上述示例的配置中移除掉多余的 <a href="https://webpack.docschina.org/concepts/entry-points/" target="_blank" rel="noopener noreferrer"><code>entry</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks" target="_blank" rel="noopener noreferrer"><code>optimization.splitChunks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，因为接下来的演示中并不需要它们：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">  mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line">  entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">    index: './src/index.js',
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    another: './src/another-module.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  },
</span><span class="token prefix unchanged"> </span><span class="token line">  output: {
</span><span class="token prefix unchanged"> </span><span class="token line">    filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">    path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">  },
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  optimization: {
</span><span class="token prefix deleted">-</span><span class="token line">    splitChunks: {
</span><span class="token prefix deleted">-</span><span class="token line">      chunks: 'all',
</span><span class="token prefix deleted">-</span><span class="token line">    },
</span><span class="token prefix deleted">-</span><span class="token line">  },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">};
</span></span></code></pre></div><p>我们将更新我们的项目，移除现在未使用的文件：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- another-module.js
</span></span>|- /node_modules
</code></pre></div><p>现在，我们不再使用 statically import(静态导入) <code>lodash</code>，而是通过 dynamic import(动态导入) 来分离出一个 chunk：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import _ from 'lodash';
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">function component() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">function getComponent() {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // Lodash, now imported by this script
</span><span class="token prefix deleted">-</span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  return import('lodash')
</span><span class="token prefix inserted">+</span><span class="token line">    .then(({ default: _ }) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">      const element = document.createElement('div');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">      element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  return element;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      return element;
</span><span class="token prefix inserted">+</span><span class="token line">    })
</span><span class="token prefix inserted">+</span><span class="token line">    .catch((error) =&gt; 'An error occurred while loading the component');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">getComponent().then((component) =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">  document.body.appendChild(component);
</span><span class="token prefix inserted">+</span><span class="token line">});
</span></span></code></pre></div><p>我们之所以需要 <code>default</code>，是因为 webpack 4 在导入 CommonJS 模块时，将不再解析为 <code>module.exports</code> 的值，而是为 CommonJS 模块创建一个 artificial namespace 对象，更多有关背后原因的信息，请阅读 <a href="https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655" target="_blank" rel="noopener noreferrer">webpack 4: import() and CommonJs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>让我们执行 webpack，查看 <code>lodash</code> 是否会分离到一个单独的 bundle：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>webpack-cli<span class="token punctuation">]</span> Compilation finished
asset vendors-node_modules_lodash_lodash_js.bundle.js <span class="token number">549</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset index.bundle.js <span class="token number">13.5</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: index<span class="token punctuation">)</span>
runtime modules <span class="token number">7.37</span> KiB <span class="token number">11</span> modules
cacheable modules <span class="token number">530</span> KiB
  ./src/index.js <span class="token number">434</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/lodash/lodash.js <span class="token number">530</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.4</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">268</span> ms
</code></pre></div><p>由于 <code>import()</code> 会返回一个 promise，因此它可以和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener noreferrer"><code>async</code> 函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一起使用。下面是如何通过 async 函数简化代码：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">function getComponent() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">async function getComponent() {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  const element = document.createElement('div');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  const { default: _ } = await import('lodash');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  return import('lodash')
</span><span class="token prefix deleted">-</span><span class="token line">    .then(({ default: _ }) =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">      const element = document.createElement('div');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span><span class="token prefix deleted">-</span><span class="token line">
</span><span class="token prefix deleted">-</span><span class="token line">      return element;
</span><span class="token prefix deleted">-</span><span class="token line">    })
</span><span class="token prefix deleted">-</span><span class="token line">    .catch((error) =&gt; 'An error occurred while loading the component');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  return element;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">}
</span><span class="token prefix unchanged"> </span><span class="token line">
</span><span class="token prefix unchanged"> </span><span class="token line">getComponent().then((component) =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">  document.body.appendChild(component);
</span><span class="token prefix unchanged"> </span><span class="token line">});
</span></span></code></pre></div><h3 id="_4、预获取-预加载模块-prefetch-preload-module"><a href="#_4、预获取-预加载模块-prefetch-preload-module" class="header-anchor">#</a> 4、预获取/预加载模块(prefetch/preload module)</h3> <p>webpack v4.6.0+ 增加了对预获取和预加载的支持。</p> <p>在声明 import 时，使用下面这些内置指令，可以让 webpack 输出 &quot;resource hint(资源提示)&quot;，来告知浏览器：</p> <ul><li><strong>prefetch</strong>(预获取)：将来某些导航下可能需要的资源</li> <li><strong>preload</strong>(预加载)：当前导航下可能需要资源</li></ul> <p>下面这个 prefetch 的简单示例中，有一个 <code>HomePage</code> 组件，其内部渲染一个 <code>LoginButton</code> 组件，然后在点击后按需加载 <code>LoginModal</code> 组件。</p> <p><strong>LoginButton.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//...</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'./path/to/LoginModal.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这会生成 <code>&lt;link rel=&quot;prefetch&quot; href=&quot;login-modal-chunk.js&quot;&gt;</code> 并追加到页面头部，指示着浏览器在闲置时间预取 <code>login-modal-chunk.js</code> 文件。</p> <p>与 prefetch 指令相比，preload 指令有许多不同之处：</p> <ul><li>preload chunk 会在父 chunk 加载时，以并行方式开始加载。prefetch chunk 会在父 chunk 加载结束后开始加载。</li> <li>preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载。</li> <li>preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻。</li> <li>浏览器支持程度不同。</li></ul> <p>下面这个简单的 preload 示例中，有一个 <code>Component</code>，依赖于一个较大的 library，所以应该将其分离到一个独立的 chunk 中。</p> <p>我们假想这里的图表组件 <code>ChartComponent</code> 组件需要依赖体积巨大的 <code>ChartingLibrary</code> 库。它会在渲染时显示一个 <code>LoadingIndicator(加载进度条)</code> 组件，然后立即按需导入 <code>ChartingLibrary</code>：</p> <p><strong>ChartComponent.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//...</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'ChartingLibrary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在页面中使用 <code>ChartComponent</code> 时，在请求 ChartComponent.js 的同时，还会通过 <code>&lt;link rel=&quot;preload&quot;&gt;</code> 请求 charting-library-chunk。假定 page-chunk 体积很小，很快就被加载好，页面此时就会显示 <code>LoadingIndicator(加载进度条)</code> ，等到 <code>charting-library-chunk</code> 请求完成，LoadingIndicator 组件才消失。启动仅需要很少的加载时间，因为只进行单次往返，而不是两次往返。尤其是在高延迟环境下。</p> <h3 id="_5、bundle-分析-bundle-analysis"><a href="#_5、bundle-分析-bundle-analysis" class="header-anchor">#</a> 5、bundle 分析(bundle analysis)</h3> <p>一旦开始分离代码，一件很有帮助的事情是，分析输出结果来检查模块在何处结束。 <a href="https://github.com/webpack/analyse" target="_blank" rel="noopener noreferrer">官方分析工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个不错的开始。还有一些其他社区支持的可选项：</p> <ul><li><a href="https://alexkuz.github.io/webpack-chart/" target="_blank" rel="noopener noreferrer">webpack-chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: webpack stats 可交互饼图。</li> <li><a href="https://chrisbateman.github.io/webpack-visualizer/" target="_blank" rel="noopener noreferrer">webpack-visualizer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: 可视化并分析你的 bundle，检查哪些模块占用空间，哪些可能是重复使用的。</li> <li><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。</li> <li><a href="https://webpack.jakoblind.no/optimize" target="_blank" rel="noopener noreferrer">webpack bundle optimize helper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：这个工具会分析你的 bundle，并提供可操作的改进措施，以减少 bundle 的大小。</li> <li><a href="https://github.com/bundle-stats/bundle-stats" target="_blank" rel="noopener noreferrer">bundle-stats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</li></ul> <p>#六、懒加载</p> <p>懒加载或者按需加载，是一种很好的优化网页或应用的方式。这种方式实际上是先把你的代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。这样加快了应用的初始加载速度，减轻了它的总体体积，因为某些代码块可能永远不会被加载。</p> <h3 id="_1、示例"><a href="#_1、示例" class="header-anchor">#</a> 1、示例</h3> <p>我们在<a href="https://webpack.docschina.org/guides/code-splitting#dynamic-imports" target="_blank" rel="noopener noreferrer">代码分离<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的例子基础上，进一步做些调整来说明这个概念。那里的代码确实会在脚本运行的时候产生一个分离的代码块 <code>lodash.bundle.js</code> ，在技术概念上“懒加载”它。问题是加载这个包并不需要用户的交互 - 意思是每次加载页面的时候都会请求它。这样做并没有对我们有很多帮助，还会对性能产生负面影响。</p> <p>我们试试不同的做法。我们增加一个交互，当用户点击按钮的时候用 console 打印一些文字。但是会等到第一次交互的时候再加载那个代码块（<code>print.js</code>）。为此，我们返回到代码分离的例子中，把 <code>lodash</code> 放到主代码块中，重新运行_代码分离_中的代码。</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- print.js
</span></span>|- /node_modules
</code></pre></div><p><strong>src/print.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">'The print.js module has loaded! See the network tab in dev tools...'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Button Clicked: Here\'s &quot;some text&quot;!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import _ from 'lodash';
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> async function getComponent() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> function component() {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   const _ = await import(/* webpackChunkName: &quot;lodash&quot; */ 'lodash');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const button = document.createElement('button');
</span><span class="token prefix inserted">+</span><span class="token line">   const br = document.createElement('br');
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   button.innerHTML = 'Click me and look at the console!';
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.appendChild(br);
</span><span class="token prefix inserted">+</span><span class="token line">   element.appendChild(button);
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">   // Note that because a network request is involved, some indication
</span><span class="token prefix inserted">+</span><span class="token line">   // of loading would need to be shown in a production-level site/app.
</span><span class="token prefix inserted">+</span><span class="token line">   button.onclick = e =&gt; import(/* webpackChunkName: &quot;print&quot; */ './print').then(module =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">     const print = module.default;
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">     print();
</span><span class="token prefix inserted">+</span><span class="token line">   });
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> getComponent().then(component =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">   document.body.appendChild(component);
</span><span class="token prefix deleted">-</span><span class="token line"> });
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><blockquote><p>Warning
注意当调用 ES6 模块的 <code>import()</code> 方法（引入模块）时，必须指向模块的 <code>.default</code> 值，因为它才是 promise 被处理后返回的实际的 <code>module</code> 对象。</p></blockquote> <p>现在运行 webpack 来验证一下我们的懒加载功能：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
          Asset       Size  Chunks                    Chunk Names
print.bundle.js  <span class="token number">417</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         print
index.bundle.js     <span class="token number">548</span> kB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  index
     index.html  <span class="token number">189</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
</code></pre></div><h3 id="_2、框架"><a href="#_2、框架" class="header-anchor">#</a> 2、框架</h3> <p>许多框架和类库对于如何用它们自己的方式来实现（懒加载）都有自己的建议。这里有一些例子：</p> <ul><li>React: <a href="https://reacttraining.com/react-router/web/guides/code-splitting" target="_blank" rel="noopener noreferrer">Code Splitting and Lazy Loading<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Vue: <a href="https://vuedose.tips/tips/dynamic-imports-in-vue-js-for-better-performance/" target="_blank" rel="noopener noreferrer">Dynamic Imports in Vue.js for better performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Angular: <a href="https://angular.io/guide/router#milestone-6-asynchronous-routing" target="_blank" rel="noopener noreferrer">Lazy Loading route configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://medium.com/@var_bin/angularjs-webpack-lazyload-bb7977f390dd" target="_blank" rel="noopener noreferrer">AngularJS + webpack = lazyLoad<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="七、缓存"><a href="#七、缓存" class="header-anchor">#</a> 七、缓存</h2> <p>以上，我们使用 webpack 来打包我们的模块化后的应用程序，webpack 会生成一个可部署的 <code>/dist</code> 目录，然后把打包后的内容放置在此目录中。只要 <code>/dist</code> 目录中的内容部署到 server 上，client（通常是浏览器）就能够访问此 server 的网站及其资源。而最后一步获取资源是比较耗费时间的，这就是为什么浏览器使用一种名为 <a href="https://searchstorage.techtarget.com/definition/cache" target="_blank" rel="noopener noreferrer">缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的技术。可以通过命中缓存，以降低网络流量，使网站加载速度更快，然而，如果我们在部署新版本时不更改资源的文件名，浏览器可能会认为它没有被更新，就会使用它的缓存版本。由于缓存的存在，当你需要获取新的代码时，就会显得很棘手。</p> <p>此指南的重点在于通过必要的配置，以确保 webpack 编译生成的文件能够被客户端缓存，而在文件内容变化后，能够请求到新的文件。</p> <h3 id="_1、输出文件的文件名-output-filename"><a href="#_1、输出文件的文件名-output-filename" class="header-anchor">#</a> 1、输出文件的文件名(output filename)</h3> <p>我们可以通过替换 <code>output.filename</code> 中的 <a href="https://webpack.docschina.org/configuration/output/#outputfilename" target="_blank" rel="noopener noreferrer">substitutions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 设置，来定义输出文件的名称。webpack 提供了一种使用称为 <strong>substitution(可替换模板字符串)</strong> 的方式，通过带括号字符串来模板化文件名。其中，<code>[contenthash]</code> substitution 将根据资源内容创建出唯一 hash。当资源内容发生变化时，<code>[contenthash]</code> 也会发生变化。</p> <p>这里使用 <a href="https://webpack.docschina.org/guides/getting-started" target="_blank" rel="noopener noreferrer">起步<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的示例和 <a href="https://webpack.docschina.org/guides/output-management" target="_blank" rel="noopener noreferrer">管理输出<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的 <code>plugins</code> 插件来作为项目基础，所以我们依然不必手动地维护 <code>index.html</code> 文件：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span>|- /node_modules
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       title: 'Output Management',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       title: 'Caching',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     filename: 'bundle.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     filename: '[name].[contenthash].js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>使用此配置，然后运行我们的 build script <code>npm run build</code>，产生以下输出：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                       Asset       Size  Chunks                    Chunk Names
main.7e2c49a622975ebd9b7e.js     <span class="token number">544</span> kB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  main
                  index.html  <span class="token number">197</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
</code></pre></div><p>可以看到，bundle 的名称是它内容（通过 hash）的映射。如果我们不做修改，然后再次运行构建，我们以为文件名会保持不变。然而，如果我们真的运行，可能会发现情况并非如此：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                       Asset       Size  Chunks                    Chunk Names
main.205199ab45963f6a62ec.js     <span class="token number">544</span> kB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  main
                  index.html  <span class="token number">197</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
</code></pre></div><p>这也是因为 webpack 在入口 chunk 中，包含了某些 boilerplate(引导模板)，特别是 runtime 和 manifest。（boilerplate 指 webpack 运行时的引导代码）</p> <h3 id="_2、提取引导模板-extracting-boilerplate"><a href="#_2、提取引导模板-extracting-boilerplate" class="header-anchor">#</a> 2、提取引导模板(extracting boilerplate)</h3> <p>正如我们在 <a href="https://webpack.docschina.org/guides/code-splitting" target="_blank" rel="noopener noreferrer">代码分离<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中所学到的，<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer"><code>SplitChunksPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以用于将模块分离到单独的 bundle 中。webpack 还提供了一个优化功能，可使用 <a href="https://webpack.docschina.org/configuration/optimization/#optimizationruntimechunk" target="_blank" rel="noopener noreferrer"><code>optimization.runtimeChunk</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项将 runtime 代码拆分为一个单独的 chunk。将其设置为 <code>single</code> 来为所有 chunk 创建一个 runtime bundle：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: 'Caching',
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].[contenthash].js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">     runtimeChunk: 'single',
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>再次构建，然后查看提取出来的 <code>runtime</code> bundle：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Hash: 82c9c385607b2150fab2
Version: webpack <span class="token number">4.12</span>.0
Time: 3027ms
                          Asset       Size  Chunks             Chunk Names
runtime.cc17ae2a94ec771e9221.js   <span class="token number">1.42</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
   main.e81de2cf758ada72f306.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
                     index.html  <span class="token number">275</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">497</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">489</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">309</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
    + <span class="token number">1</span> hidden module
</code></pre></div><p>将第三方库(library)（例如 <code>lodash</code> 或 <code>react</code>）提取到单独的 <code>vendor</code> chunk 文件中，是比较推荐的做法，这是因为，它们很少像本地的源代码那样频繁修改。因此通过实现以上步骤，利用 client 的长效缓存机制，命中缓存来消除请求，并减少向 server 获取资源，同时还能保证 client 代码和 server 代码版本一致。 这可以通过使用 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#split-chunks-example-2" target="_blank" rel="noopener noreferrer">SplitChunksPlugin 示例 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中演示的 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer"><code>SplitChunksPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件的 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#splitchunkscachegroups" target="_blank" rel="noopener noreferrer"><code>cacheGroups</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项来实现。我们在 <code>optimization.splitChunks</code> 添加如下 <code>cacheGroups</code> 参数并构建：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: 'Caching',
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].[contenthash].js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   optimization: {
</span><span class="token prefix unchanged"> </span><span class="token line">     runtimeChunk: 'single',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     splitChunks: {
</span><span class="token prefix inserted">+</span><span class="token line">       cacheGroups: {
</span><span class="token prefix inserted">+</span><span class="token line">         vendor: {
</span><span class="token prefix inserted">+</span><span class="token line">           test: /[\\/]node_modules[\\/]/,
</span><span class="token prefix inserted">+</span><span class="token line">           name: 'vendors',
</span><span class="token prefix inserted">+</span><span class="token line">           chunks: 'all',
</span><span class="token prefix inserted">+</span><span class="token line">         },
</span><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>再次构建，然后查看新的 <code>vendor</code> bundle：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
runtime.cc17ae2a94ec771e9221.js   <span class="token number">1.42</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
vendors.a42c3ca0d742766d7a28.js   <span class="token number">69.4</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
   main.abf44fedb7d11d4312d7.js  <span class="token number">240</span> bytes       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
</code></pre></div><p>现在，我们可以看到 <code>main</code> 不再含有来自 <code>node_modules</code> 目录的 <code>vendor</code> 代码，并且体积减少到 <code>240 bytes</code>！</p> <h3 id="_3、模块标识符-module-identifier"><a href="#_3、模块标识符-module-identifier" class="header-anchor">#</a> 3、模块标识符(module identifier)</h3> <p>在项目中再添加一个模块 <code>print.js</code>：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- print.js
</span></span>|- /node_modules
</code></pre></div><p><strong>print.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> export default function print(text) {
</span><span class="token prefix inserted">+</span><span class="token line">   console.log(text);
</span><span class="token prefix inserted">+</span><span class="token line"> };
</span></span></code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from 'lodash';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import Print from './print';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // lodash 是由当前 script 脚本 import 进来的
</span><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.onclick = Print.bind(null, 'Hello webpack!');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p>再次运行构建，然后我们期望的是，只有 <code>main</code> bundle 的 hash 发生变化，然而……</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                           Asset       Size  Chunks                    Chunk Names
  runtime.1400d5af64fc1b7b3a45.js    <span class="token number">5.85</span> kB      <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         runtime
  vendor.a7561fb0e9a071baadb9.js     <span class="token number">541</span> kB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  vendor
    main.b746e3eb72875af2caa9.js    <span class="token number">1.22</span> kB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>         main
                      index.html  <span class="token number">352</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
</code></pre></div><p>……我们可以看到这三个文件的 hash 都变化了。这是因为每个 <a href="https://webpack.docschina.org/api/module-variables/#moduleid-commonjs" target="_blank" rel="noopener noreferrer"><code>module.id</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 会默认地基于解析顺序(resolve order)进行增量。也就是说，当解析顺序发生变化，ID 也会随之改变。因此，简要概括：</p> <ul><li><code>main</code> bundle 会随着自身的新增内容的修改，而发生变化。</li> <li><code>vendor</code> bundle 会随着自身的 <code>module.id</code> 的变化，而发生变化。</li> <li><code>manifest</code> runtime 会因为现在包含一个新模块的引用，而发生变化。</li></ul> <p>第一个和最后一个都是符合预期的行为，<code>vendor</code> hash 发生变化是我们要修复的。我们将 <a href="https://webpack.docschina.org/configuration/optimization/#optimizationmoduleids" target="_blank" rel="noopener noreferrer"><code>optimization.moduleIds</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 设置为 <code>'deterministic'</code>：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: 'Caching',
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].[contenthash].js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   optimization: {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     moduleIds: 'deterministic',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     runtimeChunk: 'single',
</span><span class="token prefix unchanged"> </span><span class="token line">     splitChunks: {
</span><span class="token prefix unchanged"> </span><span class="token line">       cacheGroups: {
</span><span class="token prefix unchanged"> </span><span class="token line">         vendor: {
</span><span class="token prefix unchanged"> </span><span class="token line">           test: /[\\/]node_modules[\\/]/,
</span><span class="token prefix unchanged"> </span><span class="token line">           name: 'vendors',
</span><span class="token prefix unchanged"> </span><span class="token line">           chunks: 'all',
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>现在，不论是否添加任何新的本地依赖，对于前后两次构建，<code>vendor</code> hash 都应该保持一致：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
   main.216e852f60c8829c2289.js  <span class="token number">340</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
vendors.55e79e5927a639d21a1b.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
runtime.725a1a51ede5ae0cfde0.js   <span class="token number">1.42</span> KiB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.216e852f60c8829c2289.js
<span class="token punctuation">..</span>.
</code></pre></div><p>然后，修改 <code>src/index.js</code>，临时移除额外的依赖：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from 'lodash';
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import Print from './print';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> // import Print from './print';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // lodash 是由当前 script 脚本 import 进来的
</span><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   element.onclick = Print.bind(null, 'Hello webpack!');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   // element.onclick = Print.bind(null, 'Hello webpack!');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p>最后，再次运行我们的构建：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
                          Asset       Size  Chunks             Chunk Names
   main.ad717f2466ce655fff5c.js  <span class="token number">274</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
vendors.55e79e5927a639d21a1b.js   <span class="token number">69.5</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors
runtime.725a1a51ede5ae0cfde0.js   <span class="token number">1.42</span> KiB       <span class="token number">2</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  runtime
                     index.html  <span class="token number">353</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.ad717f2466ce655fff5c.js
<span class="token punctuation">..</span>.
</code></pre></div><p>我们可以看到，这两次构建中，<code>vendor</code> bundle 文件名称，都是 <code>55e79e5927a639d21a1b</code>。</p> <p>#八、创建 library</p> <p>除了打包应用程序，webpack 还可以用于打包 JavaScript library。</p> <p>假设你正在编写一个名为 <code>webpack-numbers</code> 的小的 library，可以将数字 1 到 5 转换为文本表示，反之亦然，例如将 2 转换为 'two'。</p> <p>基本的项目结构可能如下所示：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  |- webpack.config.js
</span><span class="token prefix inserted">+</span><span class="token line">  |- package.json
</span><span class="token prefix inserted">+</span><span class="token line">  |- /src
</span><span class="token prefix inserted">+</span><span class="token line">    |- index.js
</span><span class="token prefix inserted">+</span><span class="token line">    |- ref.json
</span></span></code></pre></div><p>初始化 npm，安装 webpack 和 lodash：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack lodash
</code></pre></div><p><strong>src/ref.json</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;One&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Two&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Three&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Four&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Five&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;num&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;word&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Zero&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> numRef <span class="token keyword">from</span> <span class="token string">'./ref.json'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">numToWord</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>numRef<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ref<span class="token punctuation">.</span>num <span class="token operator">===</span> num <span class="token operator">?</span> ref<span class="token punctuation">.</span>word <span class="token operator">:</span> accum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>numRef<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ref<span class="token punctuation">.</span>word <span class="token operator">===</span> word <span class="token operator">&amp;&amp;</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ref<span class="token punctuation">.</span>num <span class="token operator">:</span> accum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个 library 的调用规范如下：</p> <ul><li><strong>ES2015 module import:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> webpackNumbers <span class="token keyword">from</span> <span class="token string">'webpack-numbers'</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>CommonJS module require:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpackNumbers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-numbers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>AMD module require:</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'webpackNumbers'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">webpackNumbers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>consumer(使用者) 还可以通过一个 script 标签来加载和使用此 library：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/webpack-numbers<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// ...</span>
    <span class="token comment">// 全局变量</span>
    webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Five'</span><span class="token punctuation">)</span>
    <span class="token comment">// window 对象中的属性</span>
    window<span class="token punctuation">.</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Five'</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意，我们还可以通过以下配置方式，将 library 暴露为：</p> <ul><li>global 对象中的属性，用于 Node.js。</li> <li><code>this</code> 对象中的属性。</li></ul> <p>完整的 library 配置和代码，请查看 <a href="https://github.com/kalcifer/webpack-library-example" target="_blank" rel="noopener noreferrer">webpack-library-example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="_1、基本配置"><a href="#_1、基本配置" class="header-anchor">#</a> 1、基本配置</h3> <p>现在，让我们以某种方式打包这个 library，能够实现以下几个目标：</p> <ul><li>使用 <code>externals</code> 选项，避免将 <code>lodash</code> 打包到应用程序，而使用者会去加载它。</li> <li>将 library 的名称设置为 <code>webpack-numbers</code>。</li> <li>将 library 暴露为一个名为 <code>webpackNumbers</code> 的变量。</li> <li>能够访问其他 Node.js 中的 library。</li></ul> <p>此外，consumer(使用者) 应该能够通过以下方式访问 library：</p> <ul><li>ES2015 模块。例如 <code>import webpackNumbers from 'webpack-numbers'</code>。</li> <li>CommonJS 模块。例如 <code>require('webpack-numbers')</code>.</li> <li>全局变量，在通过 <code>script</code> 标签引入时。</li></ul> <p>我们可以从如下 webpack 基本配置开始：</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'webpack-numbers.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2、外部化-lodash"><a href="#_2、外部化-lodash" class="header-anchor">#</a> 2、外部化 lodash</h3> <p>现在，如果执行 <code>webpack</code>，你会发现创建了一个体积相当大的文件。如果你查看这个文件，会看到 lodash 也被打包到代码中。在这种场景中，我们更倾向于把 <code>lodash</code> 当作 <code>peerDependency</code>。也就是说，consumer(使用者) 应该已经安装过 <code>lodash</code> 。因此，你就可以放弃控制此外部 library ，而是将控制权让给使用 library 的 consumer。</p> <p>这可以使用 <code>externals</code> 配置来完成：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'webpack-numbers.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   externals: {
</span><span class="token prefix inserted">+</span><span class="token line">     lodash: {
</span><span class="token prefix inserted">+</span><span class="token line">       commonjs: 'lodash',
</span><span class="token prefix inserted">+</span><span class="token line">       commonjs2: 'lodash',
</span><span class="token prefix inserted">+</span><span class="token line">       amd: 'lodash',
</span><span class="token prefix inserted">+</span><span class="token line">       root: '_',
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>这意味着你的 library 需要一个名为 <code>lodash</code> 的依赖，这个依赖在 consumer 环境中必须存在且可用。</p> <h3 id="_3、暴露-library"><a href="#_3、暴露-library" class="header-anchor">#</a> 3、暴露 library</h3> <p>对于用法广泛的 library，我们希望它能够兼容不同的环境，例如 CommonJS，AMD，Node.js 或者作为一个全局变量。为了让你的 library 能够在各种使用环境中可用，需要在 <code>output</code> 中添加 <code>library</code> 属性：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'webpack-numbers.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     library: 'webpackNumbers',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   externals: {
</span><span class="token prefix unchanged"> </span><span class="token line">     lodash: {
</span><span class="token prefix unchanged"> </span><span class="token line">       commonjs: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       commonjs2: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       amd: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       root: '_',
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>这会将你的 library bundle 暴露为名为 <code>webpackNumbers</code> 的全局变量，consumer 通过此名称来 import。为了让 library 和其他环境兼容，则需要在配置中添加 <code>libraryTarget</code> 属性。这个选项可以控制以多种形式暴露 library。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'webpack-numbers.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     library: 'webpackNumbers',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     libraryTarget: 'umd',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   externals: {
</span><span class="token prefix unchanged"> </span><span class="token line">     lodash: {
</span><span class="token prefix unchanged"> </span><span class="token line">       commonjs: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       commonjs2: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       amd: 'lodash',
</span><span class="token prefix unchanged"> </span><span class="token line">       root: '_',
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>有以下几种方式暴露 library：</p> <ul><li>变量：作为一个全局变量，通过 <code>script</code> 标签来访问（<code>libraryTarget:'var'</code>）。</li> <li>this：通过 <code>this</code> 对象访问（<code>libraryTarget:'this'</code>）。</li> <li>window：在浏览器中通过 <code>window</code> 对象访问（<code>libraryTarget:'window'</code>）。</li> <li>UMD：在 AMD 或 CommonJS <code>require</code> 之后可访问（<code>libraryTarget:'umd'</code>）。</li></ul> <p>如果设置了 <code>library</code> 但没有设置 <code>libraryTarget</code>，则 <code>libraryTarget</code> 默认指定为 <code>var</code>，详细说明请查看 <a href="https://webpack.docschina.org/configuration/output" target="_blank" rel="noopener noreferrer">output <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>文档。查看 <a href="https://webpack.docschina.org/configuration/output#outputlibrarytarget" target="_blank" rel="noopener noreferrer"><code>output.libraryTarget</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档，以获取所有可用选项的详细列表。</p> <h4 id="_1-发布准备"><a href="#_1-发布准备" class="header-anchor">#</a> (1) 发布准备</h4> <p>遵循 <a href="https://webpack.docschina.org/guides/production" target="_blank" rel="noopener noreferrer">生产环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指南中提到的步骤，来优化生产环境下的输出结果。那么，我们还需要将生成 bundle 的文件路径，添加到 <code>package.json</code> 中的 <code>main</code> 字段中。</p> <p><strong>package.json</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/webpack-numbers.js&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><p>或者，按照这个 <a href="https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md#typical-usage" target="_blank" rel="noopener noreferrer">指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，将其添加为标准模块：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/index.js&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><p>这里的 key(键) <code>main</code> 是参照 <a href="https://docs.npmjs.com/files/package.json#main" target="_blank" rel="noopener noreferrer"><code>package.json</code> 标准<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，而 <code>module</code> 是参照 <a href="https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md" target="_blank" rel="noopener noreferrer">一个<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/rollup/rollup/wiki/pkg.module" target="_blank" rel="noopener noreferrer">提案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，此提案允许 JavaScript 生态系统升级使用 ES2015 模块，而不会破坏向后兼容性。</p> <h4 id="_2-发布-library"><a href="#_2-发布-library" class="header-anchor">#</a> (2) 发布 library</h4> <p>现在，你可以 <a href="https://docs.npmjs.com/getting-started/publishing-npm-packages" target="_blank" rel="noopener noreferrer">将其发布为一个 npm package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，并且在 <a href="https://unpkg.com/#/" target="_blank" rel="noopener noreferrer">unpkg.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 找到它，并分发给你的用户。</p> <ul><li>注册npm仓库账号</li></ul> <div class="language- extra-class"><pre class="language-text"><code>https://www.npmjs.com 上面的账号
$ npm adduser
</code></pre></div><ul><li>上传包</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ npm publish
</code></pre></div><p>坑：403 Forbidden</p> <div class="language- extra-class"><pre class="language-text"><code>查看npm源：npm config get registry
切换npm源方法一：npm config set registry http://registry.npmjs.org
切换npm源方法二：nrm use npm
</code></pre></div><p>#九、环境变量</p> <p>想要消除 <code>webpack.config.js</code> 在 <a href="https://webpack.docschina.org/guides/development" target="_blank" rel="noopener noreferrer">开发环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://webpack.docschina.org/guides/production" target="_blank" rel="noopener noreferrer">生产环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 之间的差异，你可能需要环境变量(environment variable)。</p> <p>webpack 命令行 <a href="https://webpack.docschina.org/api/cli/#environment-options" target="_blank" rel="noopener noreferrer">环境配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <code>--env</code> 参数，可以允许你传入任意数量的环境变量。而在 <code>webpack.config.js</code> 中可以访问到这些环境变量。例如，<code>--env production</code> 或 <code>--env NODE_ENV=local</code>（<code>NODE_ENV</code> 通常约定用于定义环境类型，查看 <a href="https://dzone.com/articles/what-you-should-know-about-node-env" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx webpack --env <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>local --env production --progress
</code></pre></div><blockquote><p>Tip
如果设置 <code>env</code> 变量，却没有赋值，<code>--env production</code> 默认表示将 <code>env.production</code> 设置为 <code>true</code>。还有许多其他可以使用的语法。更多详细信息，请查看 <a href="https://webpack.docschina.org/api/cli/#environment-options" target="_blank" rel="noopener noreferrer">webpack CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档。</p></blockquote> <p>对于我们的 webpack 配置，有一个必须要修改之处。通常，<code>module.exports</code> 指向配置对象。要使用 <code>env</code> 变量，你必须将 <code>module.exports</code> 转换成一个函数：</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">env</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use env.&lt;YOUR VARIABLE&gt; here:</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV: '</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'local'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Production: '</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="十、安装"><a href="#十、安装" class="header-anchor">#</a> 十、安装</h2> <p>本指南介绍了安装 webpack 的各种方法。</p> <h3 id="_1、前提条件"><a href="#_1、前提条件" class="header-anchor">#</a> 1、前提条件</h3> <p>在开始之前，请确保安装了 <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的最新版本。使用 Node.js 最新的长期支持版本(LTS - Long Term Support)，是理想的起步。 使用旧版本，你可能遇到各种问题，因为它们可能缺少 webpack 功能， 或者缺少相关 package。</p> <h3 id="_2、本地安装"><a href="#_2、本地安装" class="header-anchor">#</a> 2、本地安装</h3> <p>最新的 webpack 正式版本是：</p> <p><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/webpack.svg?label=webpack&amp;style=flat-square&amp;maxAge=3600" alt="GitHub release"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>要安装最新版本或特定版本，请运行以下命令之一：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack
<span class="token comment">## 或指定版本</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack@<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>Tip
是否使用 <code>--save-dev</code> 取决于你的应用场景。假设你仅使用 webpack 进行构建操作，那么建议你在安装时使用 <code>--save-dev</code> 选项，因为可能你不需要在生产环境上使用 webpack。如果需要应用于生产环境，请忽略 <code>--save-dev</code> 选项。</p></blockquote> <p>如果你使用 webpack v4+ 版本，你还需要安装 <a href="https://webpack.docschina.org/api/cli/" target="_blank" rel="noopener noreferrer">CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-cli
</code></pre></div><p>对于大多数项目，我们建议本地安装。这可以在引入重大更新(breaking change)版本时，更容易分别升级项目。 通常会通过运行一个或多个 <a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener noreferrer">npm scripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 以在本地 <code>node_modules</code> 目录中查找安装的 webpack， 来运行 webpack：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.config.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Tip
想要运行本地安装的 webpack，你可以通过 <code>node_modules/.bin/webpack</code> 来访问它的二进制版本。另外，如果你使用的是 npm v5.2.0 或更高版本，则可以运行 <code>npx webpack</code> 来执行。</p></blockquote> <h3 id="_3、全局安装"><a href="#_3、全局安装" class="header-anchor">#</a> 3、全局安装</h3> <p>通过以下 NPM 安装方式，可以使 <code>webpack</code> 在全局环境下可用：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --global webpack
</code></pre></div><blockquote><p>Warning
<strong>不推荐</strong> 全局安装 webpack。这会将你项目中的 webpack 锁定到指定版本，并且在使用不同的 webpack 版本的项目中， 可能会导致构建失败。</p></blockquote> <h3 id="_4、最新体验版本"><a href="#_4、最新体验版本" class="header-anchor">#</a> 4、最新体验版本</h3> <p>如果你热衷于使用最新版本的 webpack，你可以使用以下命令安装 beta 版本， 或者直接从 webpack 的仓库中安装：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack@next
<span class="token comment">## 或特定的 tag/分支</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack/webpack<span class="token comment">#&lt;tagname/branchname&gt;</span>
</code></pre></div><blockquote><p>Warning
安装这些最新体验版本时要小心！它们可能仍然包含 bug，因此不应该用于生产环境。</p></blockquote> <h2 id="十一、模块热替换"><a href="#十一、模块热替换" class="header-anchor">#</a> 十一、模块热替换</h2> <p>模块热替换(hot module replacement 或 HMR)是 webpack 提供的最有用的功能之一。它允许在运行时更新所有类型的模块， 而无需完全刷新。本页面重点介绍其 <strong>实现</strong>，而 <a href="https://webpack.docschina.org/concepts/hot-module-replacement" target="_blank" rel="noopener noreferrer">概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 页面提供了更多关于 它的工作原理以及为什么它有用的细节。</p> <blockquote><p>Warning
<strong>HMR</strong> 不适用于生产环境，这意味着它应当用于开发环境。更多详细信息， 请查看 <a href="https://webpack.docschina.org/guides/production" target="_blank" rel="noopener noreferrer">生产环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指南。</p></blockquote> <h3 id="_1、启用-hmr"><a href="#_1、启用-hmr" class="header-anchor">#</a> 1、启用 HMR</h3> <p>此功能可以很大程度提高生产效率。我们要做的就是更新 <a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener noreferrer">webpack-dev-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置， 然后使用 webpack 内置的 HMR 插件。我们还要删除掉 <code>print.js</code> 的入口起点， 因为现在已经在 <code>index.js</code> 模块中引用了它。</p> <blockquote><p>Tip
如果你在技术选型中使用了 <code>webpack-dev-middleware</code> 而没有使用 <code>webpack-dev-server</code>，请使用 <a href="https://github.com/webpack-contrib/webpack-hot-middleware" target="_blank" rel="noopener noreferrer"><code>webpack-hot-middleware</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 依赖包，以在你的自定义服务器或应用程序上启用 HMR。</p></blockquote> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">      app: './src/index.js',
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      print: './src/print.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   devtool: 'inline-source-map',
</span><span class="token prefix unchanged"> </span><span class="token line">   devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">     contentBase: './dist',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     hot: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     // new CleanWebpackPlugin(['dist/*']) for &lt; v2 versions of CleanWebpackPlugin
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: 'Hot Module Replacement',
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>现在，我们来修改 <code>index.js</code> 文件，以便当 <code>print.js</code> 内部发生变更时可以告诉 webpack 接受更新的模块。</p> <p><strong>index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from './print.js';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement('button');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = 'Click me and check the console!';
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> if (module.hot) {
</span><span class="token prefix inserted">+</span><span class="token line">   module.hot.accept('./print.js', function() {
</span><span class="token prefix inserted">+</span><span class="token line">     console.log('Accepting the updated printMe module!');
</span><span class="token prefix inserted">+</span><span class="token line">     printMe();
</span><span class="token prefix inserted">+</span><span class="token line">   })
</span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span></code></pre></div><p>更改 <code>print.js</code> 中 <code>console.log</code> 的输出内容，你将会在浏览器中看到如下的输出 （不要担心现在 <code>button.onclick = printMe()</code> 的输出，我们稍后也会更新该部分）。</p> <p><strong>print.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> export default function printMe() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   console.log('I get called from print.js!');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   console.log('Updating print.js...');
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p><strong>console</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>[HMR] Waiting for update signal from WDS...
main.js:4395 [WDS] Hot Module Replacement enabled.
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> 2main.js:4395 [WDS] App updated. Recompiling...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4395 [WDS] App hot update...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR] Checking for updates on the server...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:10024 Accepting the updated printMe module!
</span><span class="token prefix inserted">+</span><span class="token line"> 0.4b8ee77….hot-update.js:10 Updating print.js...
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR] Updated modules:
</span><span class="token prefix inserted">+</span><span class="token line"> main.js:4330 [HMR]  - 20
</span></span></code></pre></div><h3 id="_2、通过-node-js-api"><a href="#_2、通过-node-js-api" class="header-anchor">#</a> 2、通过 Node.js API</h3> <p>在 Node.js API 中使用 webpack dev server 时，不要将 dev server 选项放在 webpack 配置对象中。而是在创建时， 将其作为第二个参数传递。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>new WebpackDevServer(compiler, options)
</code></pre></div><p>想要启用 HMR，还需要修改 webpack 配置对象，使其包含 HMR 入口起点。<code>webpack-dev-server</code> 依赖包中具有一个叫做 <code>addDevServerEntrypoints</code> 的方法，你可以通过使用这个方法来实现。这是关于如何使用的一个基本示例：</p> <p><strong>dev-server.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
  hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

webpackDevServer<span class="token punctuation">.</span><span class="token function">addDevServerEntrypoints</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webpackDevServer</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dev server listening on port 8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Tip
如果你正在使用 <a href="https://webpack.docschina.org/guides/development#using-webpack-dev-middleware" target="_blank" rel="noopener noreferrer"><code>webpack-dev-middleware</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可以通过 <a href="https://github.com/webpack-contrib/webpack-hot-middleware" target="_blank" rel="noopener noreferrer"><code>webpack-hot-middleware</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 依赖包，在自定义 dev server 中启用 HMR。</p></blockquote> <h3 id="_3、问题"><a href="#_3、问题" class="header-anchor">#</a> 3、问题</h3> <p>模块热替换可能比较难以掌握。为了说明这一点，我们回到刚才的示例中。如果你继续点击示例页面上的按钮， 你会发现控制台仍在打印旧的 <code>printMe</code> 函数。</p> <p>这是因为按钮的 <code>onclick</code> 事件处理函数仍然绑定在旧的 <code>printMe</code> 函数上。</p> <p>为了让 HMR 正常工作，我们需要更新代码，使用 <code>module.hot.accept</code> 将其绑定到新的 <code>printMe</code> 函数上：</p> <p><strong>index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from './print.js';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement('button');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = 'Click me and check the console!';
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;  // onclick event is bind to the original printMe function
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> let element = component(); // 存储 element，以在 print.js 修改时重新渲染
</span><span class="token prefix inserted">+</span><span class="token line"> document.body.appendChild(element);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> if (module.hot) {
</span><span class="token prefix unchanged"> </span><span class="token line">   module.hot.accept('./print.js', function() {
</span><span class="token prefix unchanged"> </span><span class="token line">     console.log('Accepting the updated printMe module!');
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     printMe();
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     document.body.removeChild(element);
</span><span class="token prefix inserted">+</span><span class="token line">     element = component(); // 重新渲染 &quot;component&quot;，以便更新 click 事件处理函数
</span><span class="token prefix inserted">+</span><span class="token line">     document.body.appendChild(element);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><h3 id="_4、hmr-加载样式"><a href="#_4、hmr-加载样式" class="header-anchor">#</a> 4、HMR 加载样式</h3> <p>借助于 <code>style-loader</code>，使用模块热替换来加载 CSS 实际上极其简单。此 loader 在幕后使用了 <code>module.hot.accept</code>，在 CSS 依赖模块更新之后，会将其 patch(修补) 到 <code>&lt;style&gt;</code> 标签中。</p> <p>首先使用以下命令安装两个 loader ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader
</code></pre></div><p>然后更新配置文件，使用这两个 loader。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix unchanged"> </span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">     app: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   devtool: 'inline-source-map',
</span><span class="token prefix unchanged"> </span><span class="token line">   devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">     contentBase: './dist',
</span><span class="token prefix unchanged"> </span><span class="token line">     hot: true,
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   module: {
</span><span class="token prefix inserted">+</span><span class="token line">     rules: [
</span><span class="token prefix inserted">+</span><span class="token line">       {
</span><span class="token prefix inserted">+</span><span class="token line">         test: /\.css$/,
</span><span class="token prefix inserted">+</span><span class="token line">         use: ['style-loader', 'css-loader'],
</span><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">     ],
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">      // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix unchanged"> </span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix unchanged"> </span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       title: 'Hot Module Replacement',
</span><span class="token prefix unchanged"> </span><span class="token line">     }),
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: '[name].bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>如同 import 模块，热加载样式表同样很简单：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> | - package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> | - webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> | - /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   | - bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line"> | - /src
</span><span class="token prefix unchanged"> </span><span class="token line">   | - index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   | - print.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   | - styles.css
</span></span></code></pre></div><p><strong>styles.css</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import _ from 'lodash';
</span><span class="token prefix unchanged"> </span><span class="token line"> import printMe from './print.js';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import './styles.css';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span><span class="token prefix unchanged"> </span><span class="token line">   const btn = document.createElement('button');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   btn.innerHTML = 'Click me and check the console!';
</span><span class="token prefix unchanged"> </span><span class="token line">   btn.onclick = printMe;  // onclick event is bind to the original printMe function
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.appendChild(btn);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> let element = component();
</span><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(element);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> if (module.hot) {
</span><span class="token prefix unchanged"> </span><span class="token line">   module.hot.accept('./print.js', function() {
</span><span class="token prefix unchanged"> </span><span class="token line">     console.log('Accepting the updated printMe module!');
</span><span class="token prefix unchanged"> </span><span class="token line">     document.body.removeChild(element);
</span><span class="token prefix unchanged"> </span><span class="token line">     element = component(); // Re-render the &quot;component&quot; to update the click handler
</span><span class="token prefix unchanged"> </span><span class="token line">     document.body.appendChild(element);
</span><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p>将 <code>body</code> 的 style 改为 <code>background: red;</code>，你应该可以立即看到页面的背景颜色随之更改，而无需完全刷新。</p> <p><strong>styles.css</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> body {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   background: blue;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   background: red;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p>#十二、Tree Shaking</p> <p><em>tree shaking</em> 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 <a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure" target="_blank" rel="noopener noreferrer">静态结构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 特性，例如 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener noreferrer"><code>import</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noopener noreferrer"><code>export</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这个术语和概念实际上是由 ES2015 模块打包工具 <a href="https://github.com/rollup/rollup" target="_blank" rel="noopener noreferrer">rollup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 普及起来的。</p> <p>webpack 2 正式版本内置支持 ES2015 模块（也叫做 <em>harmony modules</em>）和未使用模块检测能力。新的 webpack 4 正式版本扩展了此检测能力，通过 <code>package.json</code> 的 <code>&quot;sideEffects&quot;</code> 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 &quot;pure(纯正 ES2015 模块)&quot;，由此可以安全地删除文件中未使用的部分。</p> <h3 id="_1、添加一个通用模块"><a href="#_1、添加一个通用模块" class="header-anchor">#</a> 1、添加一个通用模块</h3> <p>在我们的项目中添加一个新的通用模块文件 <code>src/math.js</code>，并导出两个函数：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- index.html
</span></span>|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- math.js
</span></span>|- /node_modules
</code></pre></div><p><strong>src/math.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要将 <code>mode</code> 配置设置成<a href="https://webpack.docschina.org/configuration/mode/#mode-development" target="_blank" rel="noopener noreferrer">development<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，以确定 bundle 不会被压缩：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> devtool: 'source-map',
</span><span class="token prefix inserted">+</span><span class="token line"> mode: 'development',
</span><span class="token prefix inserted">+</span><span class="token line"> optimization: {
</span><span class="token prefix inserted">+</span><span class="token line">   usedExports: true,
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span></span>};
</code></pre></div><p>配置完这些后，更新入口脚本，使用其中一个新方法，并且为了简化示例，我们先将 <code>lodash</code> 删除：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import _ from 'lodash';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import { cube } from './math.js';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   const element = document.createElement('div');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const element = document.createElement('pre');
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   // Lodash, now imported by this script
</span><span class="token prefix deleted">-</span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.innerHTML = [
</span><span class="token prefix inserted">+</span><span class="token line">     'Hello webpack!',
</span><span class="token prefix inserted">+</span><span class="token line">     '5 cubed is equal to ' + cube(5)
</span><span class="token prefix inserted">+</span><span class="token line">   ].join('\n\n');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p>注意，我们<strong>没有从 <code>src/math.js</code> 模块中 <code>import</code> 另外一个 <code>square</code> 方法</strong>。这个函数就是所谓的“未引用代码(dead code)”，也就是说，应该删除掉未被引用的 <code>export</code>。现在运行 npm script <code>npm run build</code>，并查看输出的 bundle：</p> <p><strong>dist/bundle.js (around lines 90 - 100)</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 1 */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  <span class="token comment">/* unused harmony export square */</span>
  <span class="token comment">/* harmony export (immutable) */</span> __webpack_exports__<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cube<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，上面的 <code>unused harmony export square</code> 注释。如果你观察它下面的代码，你会注意到虽然我们没有引用 <code>square</code>，但它仍然被包含在 bundle 中。我们将在下一节解决这个问题。</p> <h3 id="_2、将文件标记为-side-effect-free-无副作用"><a href="#_2、将文件标记为-side-effect-free-无副作用" class="header-anchor">#</a> 2、将文件标记为 side-effect-free(无副作用)</h3> <p>在一个纯粹的 ESM 模块世界中，很容易识别出哪些文件有 side effect。然而，我们的项目无法达到这种纯度，所以，此时有必要提示 webpack compiler 哪些代码是“纯粹部分”。</p> <p>通过 package.json 的 <code>&quot;sideEffects&quot;</code> 属性，来实现这种方式。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果所有代码都不包含 side effect，我们就可以简单地将该属性标记为 <code>false</code>，来告知 webpack，它可以安全地删除未用到的 export。</p> <blockquote><p>Tip
&quot;side effect(副作用)&quot; 的定义是，在导入时会执行特殊行为的代码，而不是仅仅暴露一个 export 或多个 export。举例说明，例如 polyfill，它影响全局作用域，并且通常不提供 export。</p></blockquote> <p>如果你的代码确实有一些副作用，可以改为提供一个数组：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/some-side-effectful-file.js&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此数组支持简单的 glob 模式匹配相关文件。其内部使用了 <a href="https://github.com/fitzgen/glob-to-regexp" target="_blank" rel="noopener noreferrer">glob-to-regexp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（支持：<code>*</code>，<code>**</code>，<code>{a,b}</code>，<code>[a-z]</code>）。如果匹配模式为 <code>*.css</code>，且不包含 <code>/</code>，将被视为 <code>**/*.css</code>。</p> <blockquote><p>Tip
注意，所有导入文件都会受到 tree shaking 的影响。这意味着，如果在项目中使用类似 <code>css-loader</code> 并 import 一个 CSS 文件，则需要将其添加到 side effect 列表中，以免在生产模式中无意中将它删除：</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/some-side-effectful-file.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后，还可以在 <a href="https://webpack.docschina.org/configuration/module/#rulesideeffects" target="_blank" rel="noopener noreferrer"><code>module.rules</code> 配置选项<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中设置 <code>&quot;sideEffects&quot;</code>。</p> <p><strong>具体操作入下：</strong></p> <ul><li>安装依赖</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> webpack-cli webpack-dev-server css-loader style-loader -D
// 注意webpack-cli 与 webpack-dev-server的版本匹配
</code></pre></div><ul><li>project</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- index.html
</span></span>|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- math.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- some-side-effectful-file.js
</span><span class="token prefix inserted">+</span><span class="token line"> |- style.css
</span></span>|- /node_modules
</code></pre></div><ul><li>src/some-side-effectful-file.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'side effectful'</span>
</code></pre></div><ul><li>src/style.css</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>src/index.js</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>import { cube } from './math.js'

<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import Greeting from './some-side-effectful-file'
</span><span class="token prefix inserted">+</span><span class="token line">import './style.css'
</span></span>
function component() {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const element = document.createElement('pre')
</span><span class="token prefix unchanged"> </span><span class="token line"> element.innerHTML = [
</span><span class="token prefix unchanged"> </span><span class="token line">   'Hello webpack!',
</span><span class="token prefix unchanged"> </span><span class="token line">   '5 cubed is equal to ' + cube(5)
</span><span class="token prefix unchanged"> </span><span class="token line"> ].join('\n\n')
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return element
</span></span>}

document.body.appendChild(component())
</code></pre></div><ul><li>webpack.config.js</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path')

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> mode: 'development',
</span><span class="token prefix unchanged"> </span><span class="token line"> entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">   index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> optimization: {
</span><span class="token prefix unchanged"> </span><span class="token line">   usedExports: true,
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> module: {
</span><span class="token prefix inserted">+</span><span class="token line">  rules: [
</span><span class="token prefix inserted">+</span><span class="token line">    {
</span><span class="token prefix inserted">+</span><span class="token line">      test: /\.css$/,
</span><span class="token prefix inserted">+</span><span class="token line">      use: ['style-loader', 'css-loader']
</span><span class="token prefix inserted">+</span><span class="token line">    }
</span><span class="token prefix inserted">+</span><span class="token line">  ]
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span><span class="token prefix inserted">+</span><span class="token line"> devServer: {
</span><span class="token prefix inserted">+</span><span class="token line">   contentBase: path.join(__dirname, 'dist')
</span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span>};
</code></pre></div><ul><li>package.json</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>{
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;private&quot;: true,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;sideEffects&quot;: false,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;build&quot;: &quot;webpack&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;start&quot;: &quot;webpack-dev-server&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;css-loader&quot;: &quot;^5.0.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;style-loader&quot;: &quot;^2.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack&quot;: &quot;^5.21.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-cli&quot;: &quot;3.3.12&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}
</code></pre></div><ul><li>开发环境运行项目</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm run build
</code></pre></div><p>结果发现，<code>style.css</code>和<code>some-side-effectful-file.js</code>都被打包了。</p> <ul><li>生产环境运行项目</li></ul> <p>修改<code>webpack.config.js</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path')

module.exports = {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> mode: 'development',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> mode: 'production',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: {
</span><span class="token prefix unchanged"> </span><span class="token line">   index: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> optimization: {
</span><span class="token prefix unchanged"> </span><span class="token line">   usedExports: true,
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.css$/,
</span><span class="token prefix unchanged"> </span><span class="token line">       use: ['style-loader', 'css-loader']
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> devServer: {
</span><span class="token prefix unchanged"> </span><span class="token line">   contentBase: path.join(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>};
</code></pre></div><p>结果发现，<code>style.css</code>和<code>some-side-effectful-file.js</code>不在打包的目标文件了。</p> <ul><li>修改 <code>package.json</code></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>{
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;private&quot;: true,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> &quot;sideEffects&quot;: false,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;sideEffects&quot;: [&quot;./src/some-side-effectful-file.js&quot;, &quot;*.css&quot;],
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;build&quot;: &quot;webpack&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;start&quot;: &quot;webpack-dev-server&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;css-loader&quot;: &quot;^5.0.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;style-loader&quot;: &quot;^2.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack&quot;: &quot;^5.21.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-cli&quot;: &quot;3.3.12&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}
</code></pre></div><p>#十三、生产环境</p> <p>在本指南中，我们将深入一些最佳实践和工具，将站点或应用程序构建到生产环境中。</p> <h3 id="_1、配置"><a href="#_1、配置" class="header-anchor">#</a> 1、配置</h3> <p><strong>development(开发环境)</strong> 和 <strong>production(生产环境)</strong> 这两个环境下的构建目标存在着巨大差异。在<strong>开发环境</strong>中，我们需要：强大的 source map 和一个有着 live reloading(实时重新加载) 或 hot module replacement(热模块替换) 能力的 localhost server。而<strong>生产环境</strong>目标则转移至其他方面，关注点在于压缩 bundle、更轻量的 source map、资源优化等，通过这些优化方式改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写<strong>彼此独立的 webpack 配置</strong>。</p> <p>虽然，以上我们将 <em>生产环境</em> 和 <em>开发环境</em> 做了细微区分，但是，请注意，我们还是会遵循不重复原则(Don't repeat yourself - DRY)，保留一个 &quot;common(通用)&quot; 配置。为了将这些配置合并在一起，我们将使用一个名为 <a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="noopener noreferrer"><code>webpack-merge</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的工具。此工具会引用 &quot;common&quot; 配置，因此我们不必再在环境特定(environment-specific)的配置中编写重复代码。</p> <p>我们先从安装 <code>webpack-merge</code> 开始，并将之前指南中已经成型的那些代码进行分离：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-merge
</code></pre></div><p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> |- webpack.config.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- webpack.common.js
</span><span class="token prefix inserted">+</span><span class="token line"> |- webpack.dev.js
</span><span class="token prefix inserted">+</span><span class="token line"> |- webpack.prod.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- math.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>webpack.common.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const path = require('path');
</span><span class="token prefix inserted">+</span><span class="token line"> const { CleanWebpackPlugin } = require('clean-webpack-plugin');
</span><span class="token prefix inserted">+</span><span class="token line"> const HtmlWebpackPlugin = require('html-webpack-plugin');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = {
</span><span class="token prefix inserted">+</span><span class="token line">   entry: {
</span><span class="token prefix inserted">+</span><span class="token line">     app: './src/index.js',
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line">   plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])
</span><span class="token prefix inserted">+</span><span class="token line">     new CleanWebpackPlugin(),
</span><span class="token prefix inserted">+</span><span class="token line">     new HtmlWebpackPlugin({
</span><span class="token prefix inserted">+</span><span class="token line">       title: 'Production',
</span><span class="token prefix inserted">+</span><span class="token line">     }),
</span><span class="token prefix inserted">+</span><span class="token line">   ],
</span><span class="token prefix inserted">+</span><span class="token line">   output: {
</span><span class="token prefix inserted">+</span><span class="token line">     filename: '[name].bundle.js',
</span><span class="token prefix inserted">+</span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line"> };
</span></span></code></pre></div><p><strong>webpack.dev.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const { merge } = require('webpack-merge');
</span><span class="token prefix inserted">+</span><span class="token line"> const common = require('./webpack.common.js');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix inserted">+</span><span class="token line">   mode: 'development',
</span><span class="token prefix inserted">+</span><span class="token line">   devtool: 'inline-source-map',
</span><span class="token prefix inserted">+</span><span class="token line">   devServer: {
</span><span class="token prefix inserted">+</span><span class="token line">     contentBase: './dist',
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line"> });
</span></span></code></pre></div><p><strong>webpack.prod.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const { merge } = require('webpack-merge');
</span><span class="token prefix inserted">+</span><span class="token line"> const common = require('./webpack.common.js');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> module.exports = merge(common, {
</span><span class="token prefix inserted">+</span><span class="token line">   mode: 'production',
</span><span class="token prefix inserted">+</span><span class="token line"> });
</span></span></code></pre></div><p>现在，在 <code>webpack.common.js</code> 中，我们设置了 <code>entry</code> 和 <code>output</code> 配置，并且在其中引入这两个环境公用的全部插件。在 <code>webpack.dev.js</code> 中，我们将 <code>mode</code> 设置为 <code>development</code>，并且为此环境添加了推荐的 <code>devtool</code>（强大的 source map）和简单的 <code>devServer</code> 配置。最后，在 <code>webpack.prod.js</code> 中，我们将 <code>mode</code> 设置为 <code>production</code>。</p> <h3 id="_2、npm-scripts"><a href="#_2、npm-scripts" class="header-anchor">#</a> 2、NPM Scripts</h3> <p>现在，我们把 <code>scripts</code> 重新指向到新配置。让 <code>npm start</code> script 中 <code>webpack-dev-server</code>, 使用 <code>webpack.dev.js</code>, 而让 <code>npm run build</code> script 使用 <code>webpack.prod.js</code>:</p> <p><strong>package.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>{
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;name&quot;: &quot;webpack-demo&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;version&quot;: &quot;1.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;description&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;private&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;sideEffects&quot;: [
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;./src/some-side-effectful-file.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;*.css&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> ],
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;start&quot;: &quot;webpack serve --open --config webpack.dev.js&quot;,
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    &quot;build&quot;: &quot;webpack&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;build&quot;: &quot;webpack --config webpack.prod.js&quot;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;keywords&quot;: [],
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;author&quot;: &quot;&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;license&quot;: &quot;ISC&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;devDependencies&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;css-loader&quot;: &quot;^5.0.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;html-webpack-plugin&quot;: &quot;^5.1.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;style-loader&quot;: &quot;^2.0.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack&quot;: &quot;^5.21.0&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-cli&quot;: &quot;3.3.12&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;webpack-merge&quot;: &quot;^5.7.3&quot;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}
</code></pre></div><p>随便运行下这些脚本，然后查看输出结果的变化，然后我们会继续添加一些_生产环境_配置。</p> <h2 id="十四、依赖管理"><a href="#十四、依赖管理" class="header-anchor">#</a> 十四、依赖管理</h2> <blockquote><p>es6 modules</p></blockquote> <blockquote><p>commonjs</p></blockquote> <blockquote><p>amd</p></blockquote> <h3 id="_1、带表达式的-require-语句"><a href="#_1、带表达式的-require-语句" class="header-anchor">#</a> 1、带表达式的 require 语句</h3> <p>如果你的 request 含有表达式(expressions)，就会创建一个上下文(context)，因为在编译时(compile time)并不清楚 <strong>具体</strong> 导入哪个模块。</p> <p>示例，考虑到我们有包含 <code>.ejs</code> 文件的如下目录结构：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>example_directory
│
└───template
│   │   table.ejs
│   │   table-row.ejs
│   │
│   └───directory
│       │   another.ejs
</code></pre></div><p>当下面的 <code>require()</code> 调用被解析：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./template/'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack 解析 <code>require()</code> 调用，然后提取出如下一些信息：</p> <div class="language-code extra-class"><pre class="language-text"><code>Directory: ./template
Regular expression: /^.*\.ejs$/
</code></pre></div><p><strong>context module</strong></p> <p>会生成一个 context module(上下文模块)。它包含 <strong>目录下的所有模块</strong> 的引用，如果一个 request 符合正则表达式，就能 require 进来。该context module包含一个map（映射）对象，会把requests翻译成对应的模块id。（request参考<a href="https://webpack.docschina.org/glossary/" target="_blank" rel="noopener noreferrer">概念术语<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ）</p> <p>示例map（映射）:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;./table.ejs&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  <span class="token property">&quot;./table-row.ejs&quot;</span><span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span>
  <span class="token property">&quot;./directory/another.ejs&quot;</span><span class="token operator">:</span> <span class="token number">44</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此 context module 还包含一些访问这个 map 对象的 runtime 逻辑。</p> <p>这意味着 webpack 能够支持动态地 require，但会导致所有可能用到的模块都包含在 bundle 中。</p> <h3 id="_2、require-context"><a href="#_2、require-context" class="header-anchor">#</a> 2、<code>require.context</code></h3> <p>你还可以通过 <code>require.context()</code> 函数来创建自己的 context。</p> <p>可以给这个函数传入三个参数：一个要搜索的目录，一个标记表示是否还搜索其子目录， 以及一个匹配文件的正则表达式。</p> <p>webpack 会在构建中解析代码中的 <code>require.context()</code> 。</p> <p>语法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> useSubdirectories <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> regExp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/.*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> mode <span class="token operator">=</span> <span class="token string">'sync'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./test'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.test\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//（创建出）一个 context，其中文件来自 test 目录，request 以 `.test.js` 结尾。</span>
require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.stories\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// （创建出）一个 context，其中所有文件都来自父文件夹及其所有子级文件夹，request 以 `.stories.js` 结尾。</span>
</code></pre></div><blockquote><p>Warning
传递给 <code>require.context</code> 的参数必须是字面量(literal)！</p></blockquote> <h4 id="_1-context-module-api"><a href="#_1-context-module-api" class="header-anchor">#</a> (1) context module API</h4> <p>一个 context module 会导出一个（require）函数，此函数可以接收一个参数：request。</p> <p>此导出函数有三个属性：<code>resolve</code>, <code>keys</code>, <code>id</code>。</p> <ul><li><code>resolve</code> 是一个函数，它返回 request 被解析后得到的模块 id。</li> <li><code>keys</code> 也是一个函数，它返回一个数组，由所有可能被此 context module 处理的请求（参考下面第二段代码中的 key）组成。</li></ul> <p>如果想引入一个文件夹下面的所有文件，或者引入能匹配一个正则表达式的所有文件，这个功能就会很有帮助，例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">importAll</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">importAll</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'../components/'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">importAll</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">importAll</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'../components/'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在构建时(build-time)，所有被 require 的模块都会被填充到 cache 对象中。</span>
</code></pre></div><ul><li><code>id</code> 是 context module 的模块 id. 它可能在你使用 <code>module.hot.accept</code> 时会用到。</li></ul> <h2 id="十五、公共路径"><a href="#十五、公共路径" class="header-anchor">#</a> 十五、公共路径</h2> <p><code>publicPath</code> 配置选项在各种场景中都非常有用。你可以通过它来指定应用程序中所有资源的基础路径。</p> <h3 id="_1、示例-2"><a href="#_1、示例-2" class="header-anchor">#</a> 1、示例</h3> <p>下面提供一些用于实际应用程序的示例，通过这些示例，此功能显得极其简单。实质上，发送到 <code>output.path</code> 目录的每个文件，都将从 <code>output.publicPath</code> 位置引用。这也包括（通过 <a href="https://webpack.docschina.org/guides/code-splitting/" target="_blank" rel="noopener noreferrer">代码分离<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 创建的）子 chunk 和作为依赖图一部分的所有其他资源（例如 image, font 等）。</p> <h4 id="_1-基于环境设置"><a href="#_1-基于环境设置" class="header-anchor">#</a> (1) 基于环境设置</h4> <p>在开发环境中，我们通常有一个 <code>assets/</code> 文件夹，它与索引页面位于同一级别。这没太大问题，但是，如果我们将所有静态资源托管至 CDN，然后想在生产环境中使用呢？</p> <p>想要解决这个问题，可以直接使用一个有着悠久历史的 environment variable(环境变量)。假设我们有一个变量 <code>ASSET_PATH</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">'webpack'</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试使用环境变量，否则使用根路径</span>
<span class="token keyword">const</span> <span class="token constant">ASSET_PATH</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ASSET_PATH</span> <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> <span class="token constant">ASSET_PATH</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 这可以帮助我们在代码中安全地使用环境变量</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">'process.env.ASSET_PATH'</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token constant">ASSET_PATH</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-在运行时设置"><a href="#_2-在运行时设置" class="header-anchor">#</a> (2) 在运行时设置</h4> <p>另一个可能出现的情况是，需要在运行时设置 <code>publicPath</code>。webpack 暴露了一个名为 <code>__webpack_public_path__</code> 的全局变量。所以在应用程序的 entry point 中，可以直接如下设置：</p> <div class="language-js extra-class"><pre class="language-js"><code>__webpack_public_path__ <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ASSET_PATH</span><span class="token punctuation">;</span>
</code></pre></div><p>这些内容就是你所需要的。由于我们已经在配置中使用了 <code>DefinePlugin</code>， <code>process.env.ASSET_PATH</code> 将始终都被定义， 因此我们可以安全地使用。</p> <blockquote><p>Warning
注意，如果在 entry 文件中使用 ES2015 module import，则会在 import 之后进行 <code>__webpack_public_path__</code> 赋值。在这种情况下，你必须将 public path 赋值移至一个专用模块中，然后将它的 import 语句放置到 entry.js 最上面：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token string">'./public-path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./app'</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Tip
当使用 <code>web</code> 或者 <code>web-worker</code> 时，<code>publicPath</code> 默认为 <code>'auto'</code>，将会自动从 <code>import.meta.url</code>、<code>document.currentScript</code>、<code>&lt;script /&gt;</code> 或者 <code>self.location</code> 中确定公共路径。</p></blockquote> <h2 id="十六、shimming-预置依赖"><a href="#十六、shimming-预置依赖" class="header-anchor">#</a> 十六、Shimming 预置依赖</h2> <p><code>webpack</code> 编译器(compiler)能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些第三方的库(library)可能会引用一些全局依赖（例如 <code>jQuery</code> 中的 <code>$</code>）。这些库也可能创建一些需要被导出的全局变量。这些“不符合规范的模块”就是 <em>shimming</em> 发挥作用的地方。</p> <blockquote><p>**我们不推荐使用全局的东西！**在 webpack 背后的整个概念是让前端开发更加模块化。也就是说，需要编写具有良好的封闭性(well contained)、彼此隔离的模块，以及不要依赖于那些隐含的依赖模块（例如，全局变量）。请只在必要的时候才使用本文所述的这些特性。</p></blockquote> <p><em>shimming</em> 另外一个使用场景就是，当你希望 <a href="https://en.wikipedia.org/wiki/Polyfill" target="_blank" rel="noopener noreferrer">polyfill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 浏览器功能以支持更多用户时。在这种情况下，你可能只想要将这些 polyfills 提供给到需要修补(patch)的浏览器（也就是实现按需加载）。</p> <p>下面的文章将向我们展示这两种用例。</p> <h3 id="_1、shimming-全局变量"><a href="#_1、shimming-全局变量" class="header-anchor">#</a> 1、shimming 全局变量</h3> <p>让我们开始第一个 shimming 全局变量的用例。在此之前，我们先看看我们的项目：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>webpack-demo
|- package.json
|- webpack.config.js
|- /dist
|- /src
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- index.js
</span></span>|- /node_modules
</code></pre></div><p>还记得我们之前用过的 <code>lodash</code> 吗？出于演示的目的，让我们把这个模块作为我们应用程序中的一个全局变量。要实现这些，我们需要使用 <code>ProvidePlugin</code> 插件。</p> <p>使用 <a href="https://www.webpackjs.com/plugins/provide-plugin" target="_blank" rel="noopener noreferrer"><code>ProvidePlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 后，能够在通过 webpack 编译的每个模块中，通过访问一个变量来获取到 package 包。如果 webpack 知道这个变量在某个模块中被使用了，那么 webpack 将在最终 bundle 中引入我们给定的 package。让我们先移除 <code>lodash</code> 的 <code>import</code> 语句，并通过插件提供它：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import _ from 'lodash';
</span><span class="token prefix deleted">-</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   // Lodash, now imported by this script
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const webpack = require('webpack');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist')
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line">   plugins: [
</span><span class="token prefix inserted">+</span><span class="token line">     new webpack.ProvidePlugin({
</span><span class="token prefix inserted">+</span><span class="token line">       _: 'lodash'
</span><span class="token prefix inserted">+</span><span class="token line">     })
</span><span class="token prefix inserted">+</span><span class="token line">   ]
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>本质上，我们所做的，就是告诉 webpack……</p> <blockquote><p>如果你遇到了至少一处用到 <code>lodash</code> 变量的模块实例，那请你将 <code>lodash</code> package 包引入进来，并将其提供给需要用到它的模块。</p></blockquote> <p>如果我们 run build，将会看到同样的输出：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Hash: f450fa59fa951c68c416
Version: webpack <span class="token number">2.2</span>.0
Time: 343ms
    Asset    Size  Chunks                    Chunk Names
bundle.js  <span class="token number">544</span> kB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  <span class="token punctuation">[</span>big<span class="token punctuation">]</span>  main
   <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./~/lodash/lodash.js <span class="token number">540</span> kB <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">509</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">517</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
   <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">189</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
</code></pre></div><p>我们还可以使用 <code>ProvidePlugin</code> 暴露某个模块中单个导出值，只需通过一个“数组路径”进行配置（例如 <code>[module, child, ...children?]</code>）。所以，让我们做如下设想，无论 <code>join</code> 方法在何处调用，我们都只会得到的是 <code>lodash</code> 中提供的 <code>join</code> 方法。</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   element.innerHTML = join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const webpack = require('webpack');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new webpack.ProvidePlugin({
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       _: 'lodash'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       join: ['lodash', 'join']
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     })
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>这样就能很好的与 <a href="https://www.webpackjs.com/guides/tree-shaking" target="_blank" rel="noopener noreferrer">tree shaking<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配合，将 <code>lodash</code> 库中的其他没用到的部分去除。</p> <h3 id="_2、细粒度-shimming"><a href="#_2、细粒度-shimming" class="header-anchor">#</a> 2、细粒度 shimming</h3> <p>一些传统的模块依赖的 <code>this</code> 指向的是 <code>window</code> 对象。在接下来的用例中，调整我们的 <code>index.js</code>：</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = join(['Hello', 'webpack'], ' ');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">   // Assume we are in the context of `window`
</span><span class="token prefix inserted">+</span><span class="token line">   this.alert('Hmmm, this probably isn\'t a great idea...')
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p>当模块运行在 CommonJS 环境下这将会变成一个问题，也就是说此时的 <code>this</code> 指向的是 <code>module.exports</code>。在这个例子中，你可以通过使用 <a href="https://www.webpackjs.com/loaders/imports-loader/" target="_blank" rel="noopener noreferrer"><code>imports-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 覆写 <code>this</code>：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const webpack = require('webpack');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   module: {
</span><span class="token prefix inserted">+</span><span class="token line">     rules: [
</span><span class="token prefix inserted">+</span><span class="token line">       {
</span><span class="token prefix inserted">+</span><span class="token line">         test: require.resolve('index.js'),
</span><span class="token prefix inserted">+</span><span class="token line">         use: 'imports-loader?this=&gt;window'
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span><span class="token prefix inserted">+</span><span class="token line">     ]
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       join: ['lodash', 'join']
</span><span class="token prefix unchanged"> </span><span class="token line">     })
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><h3 id="_3、全局-exports"><a href="#_3、全局-exports" class="header-anchor">#</a> 3、全局 exports</h3> <p>让我们假设，某个库(library)创建出一个全局变量，它期望用户使用这个变量。为此，我们可以在项目配置中，添加一个小模块来演示说明：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- globals.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>src/globals.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token string">'blah.txt'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> helpers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">parse</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parse something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你可能从来没有在自己的源码中做过这些事情，但是你也许遇到过一个老旧的库(library)，和上面所展示的代码类似。在这个用例中，我们可以使用 <a href="https://www.webpackjs.com/loaders/exports-loader/" target="_blank" rel="noopener noreferrer"><code>exports-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，将一个全局变量作为一个普通的模块来导出。例如，为了将 <code>file</code> 导出为 <code>file</code> 以及将 <code>helpers.parse</code> 导出为 <code>parse</code>，做如下调整：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const webpack = require('webpack');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   module: {
</span><span class="token prefix unchanged"> </span><span class="token line">     rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         test: require.resolve('index.js'),
</span><span class="token prefix unchanged"> </span><span class="token line">         use: 'imports-loader?this=&gt;window'
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       },
</span><span class="token prefix inserted">+</span><span class="token line">       {
</span><span class="token prefix inserted">+</span><span class="token line">         test: require.resolve('globals.js'),
</span><span class="token prefix inserted">+</span><span class="token line">         use: 'exports-loader?file,parse=helpers.parse'
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     ]
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       join: ['lodash', 'join']
</span><span class="token prefix unchanged"> </span><span class="token line">     })
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>现在从我们的 entry 入口文件中(即 <code>src/index.js</code>)，我们能 <code>import { file, parse } from './globals.js';</code> ，然后一切将顺利进行。</p> <h3 id="_4、加载-polyfills"><a href="#_4、加载-polyfills" class="header-anchor">#</a> 4、加载 polyfills</h3> <p>目前为止我们所讨论的所有内容都是处理那些遗留的 package 包，让我们进入到下一个话题：<strong>polyfills</strong>。</p> <p>有很多方法来载入 polyfills。例如，要引入 <a href="https://babeljs.io/docs/usage/polyfill/" target="_blank" rel="noopener noreferrer"><code>babel-polyfill</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 我们只需要如下操作：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save babel-polyfill
</code></pre></div><p>然后使用 <code>import</code> 将其添加到我们的主 bundle 文件：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import 'babel-polyfill';
</span><span class="token prefix inserted">+</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><blockquote><p>请注意，我们没有将 <code>import</code> 绑定到变量。这是因为只需在基础代码(code base)之外，再额外执行 polyfills，这样我们就可以假定代码中已经具有某些原生功能。</p></blockquote> <p>polyfills 虽然是一种模块引入方式，但是<strong>并不推荐在主 bundle 中引入 polyfills</strong>，因为这不利于具备这些模块功能的现代浏览器用户，会使他们下载体积很大、但却不需要的脚本文件。</p> <p>让我们把 <code>import</code> 放入一个新文件，并加入 <a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer"><code>whatwg-fetch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> polyfill：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save whatwg-fetch
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import 'babel-polyfill';
</span><span class="token prefix deleted">-</span><span class="token line">
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- globals.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- polyfills.js
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>src/polyfills.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">'babel-polyfill'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'whatwg-fetch'</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span><span class="token prefix unchanged"> </span><span class="token line"> const webpack = require('webpack');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   entry: './src/index.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   entry: {
</span><span class="token prefix inserted">+</span><span class="token line">     polyfills: './src/polyfills.js',
</span><span class="token prefix inserted">+</span><span class="token line">     index: './src/index.js'
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     filename: 'bundle.js',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     filename: '[name].bundle.js',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   module: {
</span><span class="token prefix unchanged"> </span><span class="token line">     rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         test: require.resolve('index.js'),
</span><span class="token prefix unchanged"> </span><span class="token line">         use: 'imports-loader?this=&gt;window'
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         test: require.resolve('globals.js'),
</span><span class="token prefix unchanged"> </span><span class="token line">         use: 'exports-loader?file,parse=helpers.parse'
</span><span class="token prefix unchanged"> </span><span class="token line">       }
</span><span class="token prefix unchanged"> </span><span class="token line">     ]
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">     new webpack.ProvidePlugin({
</span><span class="token prefix unchanged"> </span><span class="token line">       join: ['lodash', 'join']
</span><span class="token prefix unchanged"> </span><span class="token line">     })
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>如此之后，我们可以在代码中添加一些逻辑，根据条件去加载新的 <code>polyfills.bundle.js</code> 文件。你该如何决定，依赖于那些需要支持的技术以及浏览器。我们将做一些简单的试验，来确定是否需要引入这些 polyfills：</p> <p><strong>dist/index.html</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &lt;!doctype html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line"> &lt;html&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">   &lt;head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;title&gt;Getting Started&lt;/title&gt;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     &lt;script&gt;
</span><span class="token prefix inserted">+</span><span class="token line">       var modernBrowser = (
</span><span class="token prefix inserted">+</span><span class="token line">         'fetch' in window &amp;&amp;
</span><span class="token prefix inserted">+</span><span class="token line">         'assign' in Object
</span><span class="token prefix inserted">+</span><span class="token line">       );
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">       if ( !modernBrowser ) {
</span><span class="token prefix inserted">+</span><span class="token line">         var scriptElement = document.createElement('script');
</span><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line">         scriptElement.async = false;
</span><span class="token prefix inserted">+</span><span class="token line">         scriptElement.src = '/polyfills.bundle.js';
</span><span class="token prefix inserted">+</span><span class="token line">         document.head.appendChild(scriptElement);
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span><span class="token prefix inserted">+</span><span class="token line">     &lt;/script&gt;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &lt;/head&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">   &lt;body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;script src=&quot;index.bundle.js&quot;&gt;&lt;/script&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">   &lt;/body&gt;
</span><span class="token prefix unchanged"> </span><span class="token line"> &lt;/html&gt;
</span></span></code></pre></div><p>现在，我们能在 entry 入口文件中，通过 <code>fetch</code> 获取一些数据：</p> <p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   var element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">
</span><span class="token prefix inserted">+</span><span class="token line"> fetch('https://jsonplaceholder.typicode.com/users')
</span><span class="token prefix inserted">+</span><span class="token line">   .then(response =&gt; response.json())
</span><span class="token prefix inserted">+</span><span class="token line">   .then(json =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">     console.log('We retrieved some data! AND we\'re confident it will work on a variety of browser distributions.')
</span><span class="token prefix inserted">+</span><span class="token line">     console.log(json)
</span><span class="token prefix inserted">+</span><span class="token line">   })
</span><span class="token prefix inserted">+</span><span class="token line">   .catch(error =&gt; console.error('Something went wrong when fetching this data: ', error))
</span></span></code></pre></div><p>当我们开始执行构建时，<code>polyfills.bundle.js</code> 文件将会被载入到浏览器中，然后所有代码将正确无误的在浏览器中执行。请注意，以上的这些设定可能还会有所改进，我们只是对于如何解决「将 polyfills 提供给那些需要引入它的用户」这个问题，向你提供一个很棒的想法。</p> <p>##5、 babel7.4 中 @babel/preset-env 的使用</p> <p><strong>core-js介绍</strong></p> <p>其实core-js是我们能够使用新的API的最重要的包，然而一般情况它隐藏在webpack编译后的代码中，我们一般不会去查看，所以容易被遗忘，我们在webpack生成环境下，查看编译后的代码，可以看到例如includes就是从core-js导出到我们的代码去的。</p> <p><img src="https://s2.ax1x.com/2019/10/07/uR9QE9.png" alt="img"></p> <p><strong>core-js是什么</strong></p> <ul><li>它是JavaScript标准库的polyfill</li> <li>它尽可能的进行模块化，让你能选择你需要的功能</li> <li>它可以不污染全局空间</li> <li>它和babel高度集成，可以对core-js的引入进行最大程度的优化</li></ul> <p><strong>升级core-js@3动机</strong></p> <p>目前我们使用的都默认是core-js@2，它在 2018年 之前就封锁了分支，至此之后的特性都只会添加到core-js@3，这里有一个生产例子，使用了core-js@2不支持的新特性，导致错误</p> <ul><li>core-js@2出现的问题</li> <li>Vue-cli使用flat报错</li> <li>vue-cli也会在V4升级core-js</li> <li>Roadmap for Vue-cli4</li> <li>core-js@3添加的特性</li></ul> <p><strong>core-js@3 特性概览</strong></p> <ul><li>支持ECMAScript稳定功能，引入core-js@3冻结期间的新功能，比如flat</li> <li>加入到ES2016-ES2019中的提案，现在已经被标记为稳定功能</li> <li>更新了提案的实现，增加了proposals配置项，由于提案阶段不稳定，需要谨慎使用</li> <li>增加了对一些web标准的支持，比如URL 和 URLSearchParams</li> <li>现在支持原型方法，同时不污染原型</li> <li>删除了过时的特性</li></ul> <p><strong>core-js@3 与 babel</strong></p> <p>以前我们实现API的时候，会引入整个polyfill,其实polyfill只是包括了以下两个包</p> <div class="language- extra-class"><pre class="language-text"><code>core-js
regenerator-runtime
</code></pre></div><p>core-js@3 升级之后弃用了@babel/polyfill，以下是等价实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// babel.config.js</span>
presets<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useBuiltIns<span class="token operator">:</span> <span class="token string">&quot;entry&quot;</span><span class="token punctuation">,</span> <span class="token comment">// or &quot;usage&quot;，见如下说明</span>
    corejs<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token comment">// 如果 useBuiltIns: &quot;entry&quot; 需要在打包入口文件导入两个包：</span>
<span class="token keyword">import</span> <span class="token string">&quot;core-js/stable&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;regenerator-runtime/runtime&quot;</span>

<span class="token comment">// 如果 useBuiltIns: &quot;usage&quot;，不需要在入口文件里导入包了</span>
</code></pre></div><p>##6、什么是Browserslist</p> <p>关于<strong>preset-env</strong>，我们还可以提供一个<code>targets</code>配置项指定运行环境，就是我们可以配置对应目标浏览器环境，那么<strong>babel</strong>就会编译出对应目标浏览器环境可以运行的代码。相信有同学遇到过在低版本系统ios手机里自己的项目会白屏，其实是某些语法在ios低版本系统里不支持，这个时候我们可以直接配置ios 7浏览器环境都可以支持的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>Copy<span class="token comment">/* babel.config.js */</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'targets'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'browsers'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ie &gt;= 8'</span><span class="token punctuation">,</span> <span class="token string">'iOS 7'</span><span class="token punctuation">]</span> <span class="token comment">// 支持ie8，直接使用iOS浏览器版本7</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然<strong>babel</strong>的<strong>Browserslist</strong>集成还支持在<strong>package.json</strong>文件里或者新建一个 <strong>.browserslistrc</strong> 文件来指定对应目标环境。</p> <p>在开始WEB前端开发之前，开发者必须要明确目标环境。例如：</p> <ul><li>IE 9 +</li> <li>Edge</li> <li>Firefox 60 +</li> <li>Chrome 60 +</li></ul> <h4 id="_1-作用"><a href="#_1-作用" class="header-anchor">#</a> (1) 作用</h4> <p>Browserslist用于配置目标环境。</p> <h4 id="_2-安装"><a href="#_2-安装" class="header-anchor">#</a> <strong>(2) 安装</strong></h4> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev browserslist
</code></pre></div><h4 id="_3-配置"><a href="#_3-配置" class="header-anchor">#</a> (3) 配置</h4> <p>Browserslist的配置可以直接写在<code>package.json</code>的<code>browserslist</code>字段里（推荐），也可以写成名为<code>.browserslistrc</code>的配置文件，但二者不能同时使用。</p> <p><strong>package.json</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;]
}
</code></pre></div><p><strong>.browserslistrc</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; 1%
last 2 versions
</code></pre></div><h4 id="_4-测试"><a href="#_4-测试" class="header-anchor">#</a> (4) 测试</h4> <p>在控制台执行下面的命令会输出当前的目标环境。</p> <div class="language- extra-class"><pre class="language-text"><code>npx browserslist
</code></pre></div><h4 id="_5-语法"><a href="#_5-语法" class="header-anchor">#</a> (5) 语法</h4> <p>注意：大小写不敏感。</p> <p><strong>无配置</strong></p> <p>当<code>package.json</code>中不存在<code>browserslist</code>字段且<code>.browserslistrc</code>也不存在时，相当于</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;defaults&quot;]
}
</code></pre></div><p>或</p> <div class="language- extra-class"><pre class="language-text"><code>defaults
</code></pre></div><p><strong>有配置但为空</strong></p> <p>空</p> <p><strong>浏览器名称 + 版本号</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;ie 10&quot;]
}
</code></pre></div><p><strong>浏览器名称 + 版本号范围</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;ie &gt; 8&quot;]
}
{
  &quot;browserslist&quot;: [&quot;ie 10-11&quot;]
}
</code></pre></div><p><strong>浏览器版本的市场份额</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; 1%&quot;]
}
</code></pre></div><p><strong>浏览器版本的市场份额 + 地区</strong></p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; 1% in CN&quot;]
}
</code></pre></div><h4 id="_6-逻辑运算"><a href="#_6-逻辑运算" class="header-anchor">#</a> (6) 逻辑运算</h4> <p><strong>或运算</strong></p> <p><code>,</code>和<code>or</code>表示或运算（并集）</p> <p>示例：“市场份额超过<code>1%</code>的浏览器版本”和“每种浏览器的最新<code>2</code>个版本”的并集。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; 1%, last 2 versions&quot;]
}
{
  &quot;browserslist&quot;: [&quot;&gt; 1% or last 2 versions&quot;]
}
{
  &quot;browserslist&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;]
}
</code></pre></div><p><strong>与运算</strong></p> <p><code>and</code>表示与运算（交集）</p> <p>示例：“市场份额超过<code>1%</code>的浏览器版本”和“每种浏览器的最新<code>2</code>个版本”的交集。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; 1% and last 2 versions&quot;]
}
</code></pre></div><p><strong>非运算</strong></p> <p><code>not</code>表示非运算（补集）</p> <p>注意：<code>not</code>不能作为第一个条件。</p> <p>示例：“市场份额超过<code>0.5%</code>的浏览器版本”和“每种浏览器的最新<code>2</code>个版本”的差集</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;browserslist&quot;: [&quot;&gt; .5% and not last 2 versions&quot;]
}
{
  &quot;browserslist&quot;: [&quot;&gt; .5% or not last 2 versions&quot;]
}
{
  &quot;browserslist&quot;: [&quot;&gt; .5%, not last 2 versions&quot;]
}
{
  &quot;browserslist&quot;: [&quot;&gt; .5%&quot;, &quot;not last 2 versions&quot;]
}
</code></pre></div><p><a href="https://github.com/browserslist/browserslist#queries" target="_blank" rel="noopener noreferrer">browserslist配置源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="十七、资源模块"><a href="#十七、资源模块" class="header-anchor">#</a> 十七、资源模块</h2> <p>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。</p> <p>在 webpack 5 之前，通常使用：</p> <ul><li><a href="https://webpack.docschina.org/loaders/raw-loader/" target="_blank" rel="noopener noreferrer"><code>raw-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将文件导入为字符串</li> <li><a href="https://webpack.docschina.org/loaders/url-loader/" target="_blank" rel="noopener noreferrer"><code>url-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将文件作为 data URI 内联到 bundle 中</li> <li><a href="https://webpack.docschina.org/loaders/file-loader/" target="_blank" rel="noopener noreferrer"><code>file-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将文件发送到输出目录</li></ul> <p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p> <ul><li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li> <li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li> <li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li> <li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li></ul> <p>当在 webpack 5 中使用旧的 assets loader（如 <code>file-loader</code>/<code>url-loader</code>/<code>raw-loader</code> 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 <code>'javascript/auto'</code> 来解决。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">  rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.(png|jpg|gif)$/i,
</span><span class="token prefix unchanged"> </span><span class="token line">       use: [
</span><span class="token prefix unchanged"> </span><span class="token line">         {
</span><span class="token prefix unchanged"> </span><span class="token line">           loader: 'url-loader',
</span><span class="token prefix unchanged"> </span><span class="token line">           options: {
</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,
</span><span class="token prefix unchanged"> </span><span class="token line">           }
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       ],
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       type: 'javascript/auto'
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">  ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>}
</code></pre></div><p>如需从 asset loader 中排除来自新 URL 处理的 asset，请添加 <code>dependency: { not: ['url'] }</code> 到 loader 配置中。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.(png|jpg|gif)$/i,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dependency: { not: ['url'] },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       use: [
</span><span class="token prefix unchanged"> </span><span class="token line">         {
</span><span class="token prefix unchanged"> </span><span class="token line">           loader: 'url-loader',
</span><span class="token prefix unchanged"> </span><span class="token line">           options: {
</span><span class="token prefix unchanged"> </span><span class="token line">             limit: 8192,
</span><span class="token prefix unchanged"> </span><span class="token line">           },
</span><span class="token prefix unchanged"> </span><span class="token line">         },
</span><span class="token prefix unchanged"> </span><span class="token line">       ],
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">   ],
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>}
</code></pre></div><h3 id="_1、resource-资源"><a href="#_1、resource-资源" class="header-anchor">#</a> 1、Resource 资源</h3> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> module: {
</span><span class="token prefix inserted">+</span><span class="token line">   rules: [
</span><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.png/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset/resource'
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span><span class="token prefix inserted">+</span><span class="token line">   ]
</span><span class="token prefix inserted">+</span><span class="token line"> },
</span></span>};
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mainImage <span class="token keyword">from</span> <span class="token string">'./images/main.png'</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span>src <span class="token operator">=</span> mainImage<span class="token punctuation">;</span> <span class="token comment">// '/dist/151cfcfa1bd74779aadb.png'</span>
</code></pre></div><p>所有 <code>.png</code> 文件都将被发送到输出目录，并且其路径将被注入到 bundle 中。</p> <h4 id="_1-自定义输出文件名"><a href="#_1-自定义输出文件名" class="header-anchor">#</a> (1) 自定义输出文件名</h4> <p>默认情况下，<code>asset/resource</code> 模块以 <code>[hash][ext][query]</code> 文件名发送到输出目录。</p> <p>可以通过在 webpack 配置中设置 <a href="https://webpack.docschina.org/configuration/output/#outputassetmodulefilename" target="_blank" rel="noopener noreferrer"><code>output.assetModuleFilename</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来修改此模板字符串：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: 'images/[hash][ext][query]'
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.png/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: 'asset/resource'
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p>另一种自定义输出文件名的方式是，将某些资源发送到指定目录：</p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   assetModuleFilename: 'images/[hash][ext][query]'
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.png/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: 'asset/resource'
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     },
</span><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.html/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset/resource',
</span><span class="token prefix inserted">+</span><span class="token line">       generator: {
</span><span class="token prefix inserted">+</span><span class="token line">         filename: 'static/[hash][ext][query]'
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p>使用此配置，所有 <code>html</code> 文件都将被发送到输出目录中的 <code>static</code> 目录中。</p> <p><code>Rule.generator.filename</code> 与 <a href="https://webpack.docschina.org/configuration/output/#outputassetmodulefilename" target="_blank" rel="noopener noreferrer"><code>output.assetModuleFilename</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 相同，并且仅适用于 <code>asset</code> 和 <code>asset/resource</code> 模块类型。</p> <h3 id="_2、inline-资源-inlining-asset"><a href="#_2、inline-资源-inlining-asset" class="header-anchor">#</a> 2、inline 资源(inlining asset)</h3> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist'),
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   assetModuleFilename: 'images/[hash][ext][query]'
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\.png/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: 'asset/resource'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.svg/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset/inline'
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     },
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     {
</span><span class="token prefix deleted">-</span><span class="token line">       test: /\.html/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: 'asset/resource',
</span><span class="token prefix deleted">-</span><span class="token line">       generator: {
</span><span class="token prefix deleted">-</span><span class="token line">         filename: 'static/[hash][ext][query]'
</span><span class="token prefix deleted">-</span><span class="token line">       }
</span><span class="token prefix deleted">-</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>};
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import mainImage from './images/main.png';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import metroMap from './images/metro.svg';
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> img.src = mainImage; // '/dist/151cfcfa1bd74779aadb.png'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.style.background = `url(${metroMap})`; // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)
</span></span></code></pre></div><p>所有 <code>.svg</code> 文件都将作为 data URI 注入到 bundle 中。</p> <h4 id="_1-自定义-data-uri-生成器"><a href="#_1-自定义-data-uri-生成器" class="header-anchor">#</a> (1) 自定义 data URI 生成器</h4> <p>webpack 输出的 data URI，默认是呈现为使用 Base64 算法编码的文件内容。</p> <p>如果要使用自定义编码算法，则可以指定一个自定义函数来编码文件内容：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const svgToMiniDataURI = require('mini-svg-data-uri');
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.svg/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: 'asset/inline',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       generator: {
</span><span class="token prefix inserted">+</span><span class="token line">         dataUrl: content =&gt; {
</span><span class="token prefix inserted">+</span><span class="token line">           content = content.toString();
</span><span class="token prefix inserted">+</span><span class="token line">           return svgToMiniDataURI(content);
</span><span class="token prefix inserted">+</span><span class="token line">         }
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p>现在，所有 <code>.svg</code> 文件都将通过 <code>mini-svg-data-uri</code> 包进行编码。</p> <h3 id="_3、source-资源-source-asset"><a href="#_3、source-资源-source-asset" class="header-anchor">#</a> 3、source 资源(source asset)</h3> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const svgToMiniDataURI = require('mini-svg-data-uri');
</span></span>
module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       test: /\.svg/,
</span><span class="token prefix deleted">-</span><span class="token line">       type: 'asset/inline',
</span><span class="token prefix deleted">-</span><span class="token line">       generator: {
</span><span class="token prefix deleted">-</span><span class="token line">         dataUrl: content =&gt; {
</span><span class="token prefix deleted">-</span><span class="token line">           content = content.toString();
</span><span class="token prefix deleted">-</span><span class="token line">           return svgToMiniDataURI(content);
</span><span class="token prefix deleted">-</span><span class="token line">         }
</span><span class="token prefix deleted">-</span><span class="token line">       }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.txt/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset/source',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p><strong>src/example.txt</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>Hello world
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import metroMap from './images/metro.svg';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import exampleText from './example.txt';
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> block.style.background = `url(${metroMap}); // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> block.textContent = exampleText; // 'Hello world'
</span></span></code></pre></div><p>所有 <code>.txt</code> 文件将原样注入到 bundle 中。</p> <h3 id="_4、url-资源"><a href="#_4、url-资源" class="header-anchor">#</a> 4、URL 资源</h3> <p>当使用 <code>new URL('./path/to/asset', import.meta.url)</code>，webpack 也会创建资源模块。</p> <p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> logo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'./logo.svg'</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>根据你配置中 <a href="https://webpack.docschina.org/configuration/target/" target="_blank" rel="noopener noreferrer"><code>target</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的不同，webpack 会将上述代码编译成不同结果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// target: web</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>
  __webpack_public_path__ <span class="token operator">+</span> <span class="token string">'logo.svg'</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>baseURI <span class="token operator">||</span> self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// target: webworker</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>__webpack_public_path__ <span class="token operator">+</span> <span class="token string">'logo.svg'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// target: node, node-webkit, nwjs, electron-main, electron-renderer, electron-preload, async-node</span>
<span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>
  __webpack_public_path__ <span class="token operator">+</span> <span class="token string">'logo.svg'</span><span class="token punctuation">,</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathToFileUrl</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5、通用资源类型"><a href="#_5、通用资源类型" class="header-anchor">#</a> 5、通用资源类型</h3> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       test: /\.txt/,
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p>现在，webpack 将按照默认条件，自动地在 <code>resource</code> 和 <code>inline</code> 之间进行选择：小于 8kb 的文件，将会视为 <code>inline</code> 模块类型，否则会被视为 <code>resource</code> 模块类型。</p> <p>可以通过在 webpack 配置的 module rule 层级中，设置 <a href="https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition" target="_blank" rel="noopener noreferrer"><code>Rule.parser.dataUrlCondition.maxSize</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项来修改此条件：</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> entry: './src/index.js',
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   filename: 'main.js',
</span><span class="token prefix unchanged"> </span><span class="token line">   path: path.resolve(__dirname, 'dist')
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> module: {
</span><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       test: /\.txt/,
</span><span class="token prefix unchanged"> </span><span class="token line">       type: 'asset',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       parser: {
</span><span class="token prefix inserted">+</span><span class="token line">         dataUrlCondition: {
</span><span class="token prefix inserted">+</span><span class="token line">           maxSize: 4 * 1024 // 4kb
</span><span class="token prefix inserted">+</span><span class="token line">         }
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>};
</code></pre></div><p>还可以 <a href="https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition" target="_blank" rel="noopener noreferrer">指定一个函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来决定是否 inline 模块。</p> <h3 id="_6、变更内联-loader-的语法"><a href="#_6、变更内联-loader-的语法" class="header-anchor">#</a> 6、变更内联 loader 的语法</h3> <p>在 asset 模块和 webpack 5 之前，可以使用<a href="https://webpack.docschina.org/concepts/loaders/#inline" target="_blank" rel="noopener noreferrer">内联语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>与上述传统的 loader 结合使用。</p> <p>现在建议去掉所有的 loader 的语法，使用资源查询条件来魔法内联语法的功能。</p> <p>示例，将 <code>raw-loader</code> 替换为 <code>asset/source</code> 类型：</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import myModule from 'raw-loader!my-module';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import myModule from 'my-module?raw';
</span></span></code></pre></div><p>webpack 相关配置：</p> <div class="language-diff extra-class"><pre class="language-diff"><code>module: {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       resouceQuery: /raw/
</span><span class="token prefix inserted">+</span><span class="token line">       type: 'asset/source'
</span><span class="token prefix inserted">+</span><span class="token line">     }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span></code></pre></div><p>如果你想把原始资源排除在其他 loader 的解析范围以外，请使用取反的符合：</p> <div class="language-diff extra-class"><pre class="language-diff"><code>module: {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     {
</span><span class="token prefix inserted">+</span><span class="token line">       test: /\.m?js$/,
</span><span class="token prefix inserted">+</span><span class="token line">       resourceQuery: /^(?!raw$).*/,
</span><span class="token prefix inserted">+</span><span class="token line">     },
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       resouceQuery: /raw/
</span><span class="token prefix unchanged"> </span><span class="token line">       type: 'asset/source'
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span></code></pre></div><h2 id="十八、entry-高级用法"><a href="#十八、entry-高级用法" class="header-anchor">#</a> 十八、entry 高级用法</h2> <h3 id="_1、每个入口使用多种文件类型"><a href="#_1、每个入口使用多种文件类型" class="header-anchor">#</a> 1、每个入口使用多种文件类型</h3> <p>在不使用 <code>import</code> 样式文件的应用程序中（预单页应用程序或其他原因），使用一个值数组结构的 <a href="https://webpack.docschina.org/configuration/entry-context/#entry" target="_blank" rel="noopener noreferrer">entry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，并且在其中传入不同类型的文件，可以实现将 CSS 和 JavaScript（和其他）文件分离在不同的 bundle。</p> <p>举个例子。我们有一个具有两种页面类型的 PHP 应用程序：home(首页) 和 account(帐户)。home 与应用程序其余部分（account 页面）具有不同的布局和不可共享的 JavaScript。我们想要从应用程序文件中输出 home 页面的 <code>home.js</code> 和 <code>home.css</code>，为 account 页面输出 <code>account.js</code> 和 <code>account.css</code>。</p> <p><strong>home.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'home page type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>home.scss</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token comment">// home page individual styles</span>
</code></pre></div><p><strong>account.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'account page type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>account.scss</strong></p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token comment">// account page individual styles</span>
</code></pre></div><p>我们将在 <code>production(生产)</code> 模式中使用 <a href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/" target="_blank" rel="noopener noreferrer"><code>MiniCssExtractPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为 CSS 的一个最佳实践。</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    home<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./home.js'</span><span class="token punctuation">,</span> <span class="token string">'./home.scss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    account<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./account.js'</span><span class="token punctuation">,</span> <span class="token string">'./account.scss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// fallback to style-loader in development</span>
          process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
            <span class="token operator">?</span> <span class="token string">'style-loader'</span>
            <span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>由于我们未指定其他输出路径，因此使用以上配置运行 webpack 将输出到 <code>./dist</code>。<code>./dist</code> 目录下现在包含四个文件：</p> <ul><li>home.js</li> <li>home.css</li> <li>account.js</li> <li>account.css</li></ul> <p>#十九、TypeScript</p> <p><a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 JavaScript 的超集，为其增加了类型系统，可以编译为普通 JavaScript 代码。这篇指南里我们将会学习是如何将 webpack 和 TypeScript 进行集成。</p> <h3 id="_1、基础配置"><a href="#_1、基础配置" class="header-anchor">#</a> 1、基础配置</h3> <p>首先，执行以下命令安装 TypeScript compiler 和 loader：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript ts-loader
</code></pre></div><p>现在，我们将修改目录结构和配置文件：</p> <p><strong>project</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> webpack-demo
</span><span class="token prefix unchanged"> </span><span class="token line"> |- package.json
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> |- tsconfig.json
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- webpack.config.js
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /dist
</span><span class="token prefix unchanged"> </span><span class="token line">   |- bundle.js
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.html
</span><span class="token prefix unchanged"> </span><span class="token line"> |- /src
</span><span class="token prefix unchanged"> </span><span class="token line">   |- index.js
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   |- index.ts
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> |- /node_modules
</span></span></code></pre></div><p><strong>tsconfig.json</strong></p> <p>这里我们设置一个基本的配置，来支持 JSX，并将 TypeScript 编译到 ES5……</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>查看 <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" target="_blank" rel="noopener noreferrer">TypeScript 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 了解更多关于 <code>tsconfig.json</code> 的配置选项。</p> <p>想要了解 webpack 配置的更多信息，请查看 <a href="https://webpack.docschina.org/concepts/configuration/" target="_blank" rel="noopener noreferrer">配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 概念。</p> <p>现在，配置 webpack 处理 TypeScript：</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这会让 webpack 直接从 <code>./index.ts</code> <em>进入</em>，然后通过 <code>ts-loader</code> _加载_所有的 <code>.ts</code> 和 <code>.tsx</code> 文件，并且在当前目录_输出_一个 <code>bundle.js</code> 文件。</p> <p>现在让我们改变 <code>lodash</code> 在 <code>./index.ts</code> 文件中的引入， 因为在 <code>lodash</code> 的定义中没有默认(default)的导出。</p> <p><strong>./index.ts</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import _ from 'lodash';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import * as _ from 'lodash';
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function component() {
</span><span class="token prefix unchanged"> </span><span class="token line">   const element = document.createElement('div');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return element;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> document.body.appendChild(component());
</span></span></code></pre></div><blockquote><p>Tip
如果想在 TypeScript 中保留如<code>import _ from 'lodash';</code>的语法被让它作为一种默认的导入方式，需要在文件 <strong>tsconfig.json</strong> 中设置 <code>&quot;allowSyntheticDefaultImports&quot; : true</code> 和 <code>&quot;esModuleInterop&quot; : true</code> 。这个是与 TypeScript 相关的配置，在本文档中提及仅供参考。</p></blockquote> <h3 id="_2、loader"><a href="#_2、loader" class="header-anchor">#</a> 2、Loader</h3> <p><a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener noreferrer"><code>ts-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在本指南中，我们使用 <code>ts-loader</code>，因为它能够很方便地启用额外的 webpack 功能，例如将其他 web 资源导入到项目中。</p> <blockquote><p><strong>Warning</strong> <code>ts-loader</code>使用<code>tsc</code>TypeScript编译器，并取决于您的<code>tsconfig.json</code>配置。确保避免设置<a href="https://www.typescriptlang.org/tsconfig#module" target="_blank" rel="noopener noreferrer"><code>module</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>为“ CommonJS”，否则webpack将无法<a href="https://webpack.docschina.org/guides/tree-shaking" target="_blank" rel="noopener noreferrer">摇晃您的代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p>请注意，如果您已经在使用<a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener noreferrer"><code>babel-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>代码转译，则可以使用<a href="https://babeljs.io/docs/en/babel-preset-typescript" target="_blank" rel="noopener noreferrer"><code>@babel/preset-typescript</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Babel并让其处理JavaScript和TypeScript文件，而无需使用其他加载器。请记住，与相反<code>ts-loader</code>，底层<a href="https://babeljs.io/docs/en/babel-plugin-transform-typescript" target="_blank" rel="noopener noreferrer"><code>@babel/plugin-transform-typescript</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>插件不执行任何类型检查。</p> <h3 id="_3、source-maps"><a href="#_3、source-maps" class="header-anchor">#</a> 3、Source Maps</h3> <p>想要了解 source map 的更多信息，请查看 <a href="https://webpack.docschina.org/guides/development" target="_blank" rel="noopener noreferrer">开发<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指南。</p> <p>想要启用 source map，我们必须配置 TypeScript，以将内联的 source map 输出到编译后的 JavaScript 文件中。必须在 TypeScript 配置中添加下面这行：</p> <p><strong>tsconfig.json</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> {
</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;compilerOptions&quot;: {
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;outDir&quot;: &quot;./dist/&quot;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     &quot;sourceMap&quot;: true,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     &quot;noImplicitAny&quot;: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;module&quot;: &quot;commonjs&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;target&quot;: &quot;es5&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;jsx&quot;: &quot;react&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;allowJs&quot;: true
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p>现在，我们需要告诉 webpack 提取这些 source map，并内联到最终的 bundle 中。</p> <p><strong>webpack.config.js</strong></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const path = require('path');
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> module.exports = {
</span><span class="token prefix unchanged"> </span><span class="token line">   entry: './src/index.ts',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   devtool: 'inline-source-map',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   module: {
</span><span class="token prefix unchanged"> </span><span class="token line">     rules: [
</span><span class="token prefix unchanged"> </span><span class="token line">       {
</span><span class="token prefix unchanged"> </span><span class="token line">         test: /\.tsx?$/,
</span><span class="token prefix unchanged"> </span><span class="token line">         use: 'ts-loader',
</span><span class="token prefix unchanged"> </span><span class="token line">         exclude: /node_modules/,
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">     ],
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   resolve: {
</span><span class="token prefix unchanged"> </span><span class="token line">     extensions: [ '.tsx', '.ts', '.js' ],
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   output: {
</span><span class="token prefix unchanged"> </span><span class="token line">     filename: 'bundle.js',
</span><span class="token prefix unchanged"> </span><span class="token line">     path: path.resolve(__dirname, 'dist'),
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> };
</span></span></code></pre></div><p>查看 <a href="https://webpack.docschina.org/configuration/devtool/" target="_blank" rel="noopener noreferrer">devtool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档以了解更多信息。</p> <h3 id="_4、使用第三方类库"><a href="#_4、使用第三方类库" class="header-anchor">#</a> 4、使用第三方类库</h3> <p>在从 npm 安装 third party library(第三方库) 时，一定要记得同时安装此 library 的类型声明文件(typing definition)。你可以从 <a href="https://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener noreferrer">TypeSearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中找到并安装这些第三方库的类型声明文件。</p> <p>举个例子，如果想安装 lodash 类型声明文件，我们可以运行下面的命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @types/lodash
</code></pre></div><p>想了解更多，可以查看 <a href="https://blogs.msdn.microsoft.com/typescript/2016/06/15/the-future-of-declaration-files/" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="_5、导入其他资源"><a href="#_5、导入其他资源" class="header-anchor">#</a> 5、导入其他资源</h3> <p>想要在 TypeScript 中使用非代码资源(non-code asset)，我们需要告诉 TypeScript 推断导入资源的类型。在项目里创建一个 <code>custom.d.ts</code> 文件，这个文件用来表示项目中 TypeScript 的自定义类型声明。我们为 <code>.svg</code> 文件设置一个声明：</p> <p><strong>custom.d.ts</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.svg'</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>H这里，我们通过指定任何以 <code>.svg</code> 结尾的导入(import)，将 SVG 声明(declare) 为一个新的模块(module)，并将模块的 <code>content</code> 定义为 <code>any</code>。我们可以通过将类型定义为字符串，来更加显式地将它声明为一个 url。同样的概念适用于其他资源，包括 CSS, SCSS, JSON 等。</p> <h3 id="_6、构建性能"><a href="#_6、构建性能" class="header-anchor">#</a> 6、构建性能</h3> <blockquote><p><strong>Warning</strong>
这可能会降低构建性能。</p></blockquote> <h2 id="二十、构建性能"><a href="#二十、构建性能" class="header-anchor">#</a> 二十、构建性能</h2> <h3 id="_1、通用环境"><a href="#_1、通用环境" class="header-anchor">#</a> 1、通用环境</h3> <p>无论你是在 <a href="https://webpack.docschina.org/guides/development" target="_blank" rel="noopener noreferrer">开发环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 还是在 <a href="https://webpack.docschina.org/guides/production" target="_blank" rel="noopener noreferrer">生产环境<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下运行构建脚本，以下最佳实践都会有所帮助。</p> <h4 id="_1-更新到最新版本"><a href="#_1-更新到最新版本" class="header-anchor">#</a> (1) 更新到最新版本</h4> <p>使用最新的 webpack 版本。我们会经常进行性能优化。webpack 的最新稳定版本是：</p> <p><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/github/package-json/v/webpack/webpack.svg?label=webpack&amp;style=flat-square&amp;maxAge=3600" alt="latest webpack version"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>将 <strong>Node.js</strong> 更新到最新版本，也有助于提高性能。除此之外，将你的 package 管理工具（例如 <code>npm</code> 或者 <code>yarn</code>）更新到最新版本，也有助于提高性能。较新的版本能够建立更高效的模块树以及提高解析速度。</p> <h4 id="_2-loader"><a href="#_2-loader" class="header-anchor">#</a> (2) loader</h4> <p>将 loader 应用于最少数量的必要模块。而非如下:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>通过使用 <code>include</code> 字段，仅将 loader 应用在实际需要将其转换的模块：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-引导-bootstrap"><a href="#_3-引导-bootstrap" class="header-anchor">#</a> (3) 引导(bootstrap)</h4> <p>每个额外的 loader/plugin 都有其启动时间。尽量少地使用工具。</p> <h4 id="_4-解析"><a href="#_4-解析" class="header-anchor">#</a> (4) 解析</h4> <p>以下步骤可以提高解析速度：</p> <ul><li>减少 <code>resolve.modules</code>, <code>resolve.extensions</code>, <code>resolve.mainFiles</code>, <code>resolve.descriptionFiles</code> 中条目数量，因为他们会增加文件系统调用的次数。</li> <li>如果你不使用 symlinks（例如 <code>npm link</code> 或者 <code>yarn link</code>），可以设置 <code>resolve.symlinks: false</code>。</li> <li>如果你使用自定义 resolve plugin 规则，并且没有指定 context 上下文，可以设置 <code>resolve.cacheWithContext: false</code>。</li></ul> <h4 id="_5-dll"><a href="#_5-dll" class="header-anchor">#</a> (5) dll</h4> <p>使用 <code>DllPlugin</code> 为更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。</p> <h4 id="_6-小即是快-smaller-faster"><a href="#_6-小即是快-smaller-faster" class="header-anchor">#</a> (6) 小即是快(smaller = faster)</h4> <p>减少编译结果的整体大小，以提高构建性能。尽量保持 chunk 体积小。</p> <ul><li>使用数量更少/体积更小的 library。</li> <li>在多页面应用程序中使用 <code>SplitChunksPlugin</code>。</li> <li>在多页面应用程序中使用 <code>SplitChunksPlugin</code>，并开启 <code>async</code> 模式。</li> <li>移除未引用代码。</li> <li>只编译你当前正在开发的那些代码。</li></ul> <h4 id="_7-worker-池-worker-pool"><a href="#_7-worker-池-worker-pool" class="header-anchor">#</a> (7) worker 池(worker pool)</h4> <p><code>thread-loader</code> 可以将非常消耗资源的 loader 分流给一个 worker pool。</p> <h4 id="_8-持久化缓存"><a href="#_8-持久化缓存" class="header-anchor">#</a> (8) 持久化缓存</h4> <p>在 webpack 配置中使用 <a href="https://webpack.docschina.org/configuration/other-options/#cache" target="_blank" rel="noopener noreferrer"><code>cache</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选项。使用 <code>package.json</code> 中的 <code>&quot;postinstall&quot;</code> 清除缓存目录。</p> <h4 id="_9-自定义-plugin-loader"><a href="#_9-自定义-plugin-loader" class="header-anchor">#</a> (9) 自定义 plugin/loader</h4> <p>对它们进行概要分析，以免在此处引入性能问题。</p> <h4 id="_10-progress-plugin"><a href="#_10-progress-plugin" class="header-anchor">#</a> (10 )Progress plugin</h4> <p>将 <code>ProgressPlugin</code> 从 webpack 中删除，可以缩短构建时间。请注意，<code>ProgressPlugin</code> 可能不会为快速构建提供太多价值，因此，请权衡利弊再使用。</p> <h3 id="_2、开发环境"><a href="#_2、开发环境" class="header-anchor">#</a> 2、开发环境</h3> <p>以下步骤对于_开发环境_特别有帮助。</p> <h4 id="_1-增量编译"><a href="#_1-增量编译" class="header-anchor">#</a> (1) 增量编译</h4> <p>使用 webpack 的 watch mode(监听模式)。而不使用其他工具来 watch 文件和调用 webpack 。内置的 watch mode 会记录时间戳并将此信息传递给 compilation 以使缓存失效。</p> <p>在某些配置环境中，watch mode 会回退到 poll mode(轮询模式)。监听许多文件会导致 CPU 大量负载。在这些情况下，可以使用 <code>watchOptions.poll</code> 来增加轮询的间隔时间。</p> <h4 id="_2-在内存中编译"><a href="#_2-在内存中编译" class="header-anchor">#</a> (2) 在内存中编译</h4> <p>下面几个工具通过在内存中（而不是写入磁盘）编译和 serve 资源来提高性能：</p> <ul><li><code>webpack-dev-server</code></li> <li><code>webpack-hot-middleware</code></li> <li><code>webpack-dev-middleware</code></li></ul> <h4 id="_3-stats-tojson-加速"><a href="#_3-stats-tojson-加速" class="header-anchor">#</a> (3) stats.toJson 加速</h4> <p>webpack 4 默认使用 <code>stats.toJson()</code> 输出大量数据。除非在增量步骤中做必要的统计，否则请避免获取 <code>stats</code> 对象的部分内容。<code>webpack-dev-server</code> 在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中，从 <code>stats</code> 对象获取的数据量。</p> <h4 id="_4-devtool"><a href="#_4-devtool" class="header-anchor">#</a> (4) Devtool</h4> <p>需要注意的是不同的 <code>devtool</code> 设置，会导致性能差异。</p> <ul><li><code>&quot;eval&quot;</code> 具有最好的性能，但并不能帮助你转译代码。</li> <li>如果你能接受稍差一些的 map 质量，可以使用 <code>cheap-source-map</code> 变体配置来提高性能</li> <li>使用 <code>eval-source-map</code> 变体配置进行增量编译。</li></ul> <blockquote><p>Tip
在大多数情况下，最佳选择是 <code>eval-cheap-module-source-map</code>。</p></blockquote> <h4 id="_5-避免在生产环境下才会用到的工具"><a href="#_5-避免在生产环境下才会用到的工具" class="header-anchor">#</a> (5) 避免在生产环境下才会用到的工具</h4> <p>某些 utility, plugin 和 loader 都只用于生产环境。例如，在开发环境下使用 <code>TerserPlugin</code> 来 minify(压缩) 和 mangle(混淆破坏) 代码是没有意义的。通常在开发环境下，应该排除以下这些工具：</p> <ul><li><code>TerserPlugin</code></li> <li><code>[fullhash]</code>/<code>[chunkhash]</code>/<code>[contenthash]</code></li> <li><code>AggressiveSplittingPlugin</code></li> <li><code>AggressiveMergingPlugin</code></li> <li><code>ModuleConcatenationPlugin</code></li></ul> <h4 id="_6-最小化-entry-chunk"><a href="#_6-最小化-entry-chunk" class="header-anchor">#</a> (6) 最小化 entry chunk</h4> <p>webpack 只会在文件系统中输出已经更新的 chunk。某些配置选项（HMR, <code>output.chunkFilename</code> 的 <code>[name]</code>/<code>[chunkhash]/[contenthash]</code>，<code>[fullhash]</code>）来说，除了对已经更新的 chunk 无效之外，对于 entry chunk 也不会生效。</p> <p>确保在生成 entry chunk 时，尽量减少其体积以提高性能。下面的配置为运行时代码创建了一个额外的 chunk，所以它的生成代价较低：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    runtimeChunk<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-避免额外的优化步骤"><a href="#_7-避免额外的优化步骤" class="header-anchor">#</a> (7) 避免额外的优化步骤</h4> <p>webpack 通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    removeAvailableModules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    removeEmptyChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    splitChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_8-输出结果不携带路径信息"><a href="#_8-输出结果不携带路径信息" class="header-anchor">#</a> (8) 输出结果不携带路径信息</h4> <p>webpack 会在输出的 bundle 中生成路径信息。然而，在打包数千个模块的项目中，这会导致造成垃圾回收性能压力。在 <code>options.output.pathinfo</code> 设置中关闭：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    pathinfo<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_9-node-js-版本-8-9-10-9-11-1"><a href="#_9-node-js-版本-8-9-10-9-11-1" class="header-anchor">#</a> (9) Node.js 版本 8.9.10-9.11.1</h4> <p>Node.js v8.9.10 - v9.11.1 中的 ES2015 <code>Map</code> 和 <code>Set</code> 实现，存在 <a href="https://github.com/nodejs/node/issues/19769" target="_blank" rel="noopener noreferrer">性能回退<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。webpack 大量地使用这些数据结构，因此这次回退也会影响编译时间。</p> <p>之前和之后的 Node.js 版本不受影响。</p> <h4 id="_10-typescript-loader"><a href="#_10-typescript-loader" class="header-anchor">#</a> (10) TypeScript loader</h4> <p>你可以为 loader 传入 <code>transpileOnly</code> 选项，以缩短使用 <code>ts-loader</code> 时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，请使用 <a href="https://www.npmjs.com/package/fork-ts-checker-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>ForkTsCheckerWebpackPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。使用此插件会将检查过程移至单独的进程，可以加快 TypeScript 的类型检查和 ESLint 插入的速度。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Tip
这是一个关于 <code>ts-loader</code> <a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/fork-ts-checker-webpack-plugin" target="_blank" rel="noopener noreferrer">完整示例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的 Github 仓库。</p></blockquote> <h3 id="_3、生产环境"><a href="#_3、生产环境" class="header-anchor">#</a> 3、生产环境</h3> <p>以下步骤对于_生产环境_特别有帮助。</p> <blockquote><p>Warning
不要为了很小的性能收益，牺牲应用程序的质量！注意，在大多数情况下，优化代码质量比构建性能更重要。</p></blockquote> <h4 id="_1-多个-compilation-对象"><a href="#_1-多个-compilation-对象" class="header-anchor">#</a> (1) 多个 compilation 对象</h4> <p>在创建多个 compilation 时，以下工具可以帮助到你：</p> <ul><li><a href="https://github.com/trivago/parallel-webpack" target="_blank" rel="noopener noreferrer"><code>parallel-webpack</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：它允许在一个 worker 池中运行 compilation。</li> <li><code>cache-loader</code>：可以在多个 compilation 之间共享缓存。</li></ul> <h4 id="_2-source-maps"><a href="#_2-source-maps" class="header-anchor">#</a> (2) Source Maps</h4> <p>source map 相当消耗资源。你真的需要它们？</p> <h3 id="_4、工具相关问题"><a href="#_4、工具相关问题" class="header-anchor">#</a> 4、工具相关问题</h3> <p>下列工具存在某些可能会降低构建性能的问题：</p> <h4 id="_1-babel"><a href="#_1-babel" class="header-anchor">#</a> (1) Babel</h4> <ul><li>最小化项目中的 preset/plugin 数量。</li></ul> <h4 id="_2-typescript"><a href="#_2-typescript" class="header-anchor">#</a> (2) TypeScript</h4> <ul><li>在单独的进程中使用 <code>fork-ts-checker-webpack-plugin</code> 进行类型检查。</li> <li>配置 loader 跳过类型检查。</li> <li>使用 <code>ts-loader</code> 时，设置 <code>happyPackMode: true</code> / <code>transpileOnly: true</code>。</li></ul> <h4 id="_3-sass"><a href="#_3-sass" class="header-anchor">#</a> (3) Sass</h4> <ul><li><code>node-sass</code> 中有个来自 Node.js 线程池的阻塞线程的 bug。 当使用 <code>thread-loader</code> 时，需要设置 <code>workerParallelJobs: 2</code>。</li></ul> <h2 id="廿一、内容安全策略"><a href="#廿一、内容安全策略" class="header-anchor">#</a> 廿一、内容安全策略</h2> <p>webpack 能够为其加载的所有脚本添加 <code>nonce</code>。要启用此功能，需要在引入的入口脚本中设置一个 <code>__webpack_nonce__</code> 变量。应该为每个唯一的页面视图生成和提供一个唯一的基于 hash 的 nonce，这就是为什么 <code>__webpack_nonce__</code> 要在入口文件中指定，而不是在配置中指定的原因。注意，<code>nonce</code> 应该是一个 base64 编码的字符串。</p> <h3 id="_1、示例-3"><a href="#_1、示例-3" class="header-anchor">#</a> 1、示例</h3> <p>在 entry 文件中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
__webpack_nonce__ <span class="token operator">=</span> <span class="token string">'c29tZSBjb29sIHN0cmluZyB3aWxsIHBvcCB1cCAxMjM='</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><h3 id="_2、启用-csp"><a href="#_2、启用-csp" class="header-anchor">#</a> 2、启用 CSP</h3> <p>注意，默认情况下不启用 CSP。需要与文档(document)一起发送相应的 <code>CSP</code> header 或 meta 标签 <code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; ...&gt;</code>，以告知浏览器启用 CSP。以下是一个包含 CDN 白名单 URL 的 CSP header 的示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com;
</code></pre></div><p>更多CSP知识，请移步<a href="https://www.cnblogs.com/both-eyes/p/10841875.html" target="_blank" rel="noopener noreferrer">内容安全策略（CSP）详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>#廿二、编写一个Loader</p> <p><code>loader</code>是一个 <code>node</code> 模块。当应用 <code>loader</code> 转换资源时，将调用此函数。给定的函数将使用提供给它的上下文访问<a href="https://webpack.docschina.org/api/loaders/" target="_blank" rel="noopener noreferrer">Loader API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><code>this</code>。</p> <h3 id="_1、基本配置-2"><a href="#_1、基本配置-2" class="header-anchor">#</a> 1、基本配置</h3> <p>在深入研究不同类型的<code>loader</code>，及它们的用法和示例之前，让我们看一下可以在本地开发和测试加载器的三种方式。</p> <p>为了测试单个装载程序，你可以简单地在配置文件中，使用<code>path</code> 来解析一个本地文件：</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'path/to/loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token comment">/* ... */</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>要测试多个，您可以利用<code>resolveLoader.modules</code>配置来更新webpack在何处搜索 <code>loader</code>。例如，如果你的项目中有一个本地<code>/loaders</code>目录：</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  resolveLoader<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>#廿三、编写一个Plugin</p> <p>#廿四、脚手架</p> <h2 id="廿五、渐进式网络应用程序"><a href="#廿五、渐进式网络应用程序" class="header-anchor">#</a> 廿五、渐进式网络应用程序</h2> <h2 id="廿六、ecmascript-modules"><a href="#廿六、ecmascript-modules" class="header-anchor">#</a> 廿六、ECMAScript Modules</h2> <h2 id="廿七、package-exports"><a href="#廿七、package-exports" class="header-anchor">#</a> 廿七、Package exports</h2> <h2 id="廿八、web-workers"><a href="#廿八、web-workers" class="header-anchor">#</a> 廿八、Web Workers</h2> <h2 id="廿九、集成"><a href="#廿九、集成" class="header-anchor">#</a> 廿九、集成</h2> <h2 id="三十、开发-vagrant"><a href="#三十、开发-vagrant" class="header-anchor">#</a> 三十、开发 - Vagrant</h2></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65a6c00f.js" defer></script><script src="/assets/js/2.a5843350.js" defer></script><script src="/assets/js/18.170c7bd6.js" defer></script>
  </body>
</html>
