(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{376:function(s,e,t){"use strict";t.r(e);var n=t(42),a=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"webpack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[s._v("#")]),s._v(" Webpack")]),s._v(" "),t("h2",{attrs:{id:"一、起步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、起步"}},[s._v("#")]),s._v(" 一、起步")]),s._v(" "),t("h3",{attrs:{id:"_1、基本安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本安装"}},[s._v("#")]),s._v(" 1、基本安装")]),s._v(" "),t("p",[s._v("首先我们创建一个目录，初始化 npm，然后 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/installation#local-installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("在本地安装 webpack"),t("OutboundLink")],1),s._v("，接着安装 "),t("a",{attrs:{href:"https://github.com/webpack/webpack-cli",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("webpack-cli")]),t("OutboundLink")],1),s._v("（此工具用于在命令行中运行 webpack）：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir webpack-demo\ncd webpack-demo\nnpm init -y\nnpm install webpack webpack-cli --save-dev\n")])])]),t("p",[s._v("现在，我们将创建以下目录结构、文件和内容：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])])])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("component")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" element "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// lodash（目前通过一个 script 引入）对于执行这一行是必需的")]),s._v("\n  element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerHTML "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ndocument"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("appendChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("component")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("index.html")])]),s._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token doctype"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),t("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("utf-8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("起步"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://unpkg.com/lodash@4.17.20"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("./src/index.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),t("p",[s._v("我们还需要调整 "),t("code",[s._v("package.json")]),s._v(" 文件，以便确保我们安装包是 "),t("code",[s._v("private(私有的)")]),s._v("，并且移除 "),t("code",[s._v("main")]),s._v(" 入口。这可以防止意外发布你的代码。")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("{\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "description": "",\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "main": "index.js",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "private": true,\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack": "^5.4.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-cli": "^4.2.0"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[t("strong",[s._v("启动项目")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npx http-server\n")])])]),t("p",[s._v("在此示例中，"),t("code",[s._v("<script>")]),s._v(" 标签之间存在隐式依赖关系。在 "),t("code",[s._v("index.js")]),s._v(" 文件执行之前，还需要在页面中先引入 "),t("code",[s._v("lodash")]),s._v("。这是因为 "),t("code",[s._v("index.js")]),s._v(" 并未显式声明它需要 "),t("code",[s._v("lodash")]),s._v("，只是假定推测已经存在一个全局变量 "),t("code",[s._v("_")]),s._v("。")]),s._v(" "),t("p",[s._v("使用这种方式去管理 JavaScript 项目会有一些问题：")]),s._v(" "),t("ul",[t("li",[s._v("无法直接体现，脚本的执行依赖于外部库。")]),s._v(" "),t("li",[s._v("如果依赖不存在，或者引入顺序错误，应用程序将无法正常运行。")]),s._v(" "),t("li",[s._v("如果依赖被引入但是并没有使用，浏览器将被迫下载无用代码。")])]),s._v(" "),t("p",[s._v("让我们使用 webpack 来管理这些脚本。")]),s._v(" "),t("h3",{attrs:{id:"_2、创建一个bundle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建一个bundle"}},[s._v("#")]),s._v(" 2、创建一个bundle")]),s._v(" "),t("p",[s._v("首先，我们稍微调整下目录结构，创建分发代码("),t("code",[s._v("./dist")]),s._v(")文件夹用于存放分发代码，源代码("),t("code",[s._v("./src")]),s._v(")文件夹仍存放源代码。")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.html\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])])])])]),t("p",[s._v("要在 "),t("code",[s._v("index.js")]),s._v(" 中打包 "),t("code",[s._v("lodash")]),s._v(" 依赖，我们需要在本地安装 library：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install --save lodash\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // lodash（目前通过一个 script 引入）对于执行这一行是必需的\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // lodash，现在通过一个 script 引入\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[t("strong",[s._v("dist/index.html")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<!DOCTYPE html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <meta charset="utf-8" />\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    <title>起步</title>\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="https://unpkg.com/lodash@4.17.20"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <body>\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="./src/index.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="main.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </body>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("</html>\n")])])])])]),t("p",[t("strong",[s._v("开始打包")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npx webpack\n")])])]),t("h3",{attrs:{id:"_3、模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、模块"}},[s._v("#")]),s._v(" 3、模块")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://babeljs.io/learn-es2015/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ES2015"),t("OutboundLink")],1),s._v(" 中的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("import")]),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("export")]),t("OutboundLink")],1),s._v(" 语句已经被标准化。虽然大多数浏览器还无法支持它们，但是 webpack 却能够提供开箱即用般的支持。")]),s._v(" "),t("p",[s._v("事实上，webpack 在幕后会将代码“"),t("strong",[s._v("转译")]),s._v("”，以便旧版本浏览器可以执行。如果你检查 "),t("code",[s._v("dist/main.js")]),s._v("，你可以看到 webpack 具体如何实现，这是独创精巧的设计！除了 "),t("code",[s._v("import")]),s._v(" 和 "),t("code",[s._v("export")]),s._v("，webpack 还能够很好地支持多种其他模块语法，更多信息请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/module-methods",target:"_blank",rel:"noopener noreferrer"}},[s._v("模块 API"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("注意，webpack 不会更改代码中除 "),t("code",[s._v("import")]),s._v(" 和 "),t("code",[s._v("export")]),s._v(" 语句以外的部分。如果你在使用其它 "),t("a",{attrs:{href:"http://es6-features.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ES2015 特性"),t("OutboundLink")],1),s._v("，请确保你在 webpack "),t("a",{attrs:{href:"https://webpack.docschina.org/concepts/loaders/",target:"_blank",rel:"noopener noreferrer"}},[s._v("loader 系统"),t("OutboundLink")],1),s._v(" 中使用了 "),t("a",{attrs:{href:"https://babel.docschina.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Babel"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("请查看编译后的代码。")])]),s._v(" "),t("h3",{attrs:{id:"_4、使用一个配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用一个配置文件"}},[s._v("#")]),s._v(" 4、使用一个配置文件")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])])])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("现在，让我们通过新的配置文件再次执行构建：")]),s._v(" "),t("h3",{attrs:{id:"_5、npm-scripts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、npm-scripts"}},[s._v("#")]),s._v(" 5、npm scripts")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("{\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "private": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "scripts": {\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1"\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack"\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack": "^5.4.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-cli": "^4.2.0"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "dependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "lodash": "^4.17.20"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("现在运行以下命令：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm run build\n")])])]),t("h2",{attrs:{id:"二、管理资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、管理资源"}},[s._v("#")]),s._v(" 二、管理资源")]),s._v(" "),t("h3",{attrs:{id:"_1、设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、设置"}},[s._v("#")]),s._v(" 1、设置")]),s._v(" "),t("p",[s._v("在开始之前，让我们对项目做一个小的修改：")]),s._v(" "),t("p",[t("strong",[s._v("dist/index.html")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<!DOCTYPE html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <meta charset="utf-8" />\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    <title>起步</title>\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    <title>管理资源</title>\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <body>\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="main.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="bundle.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </body>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("</html>\n")])])])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'main.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("h3",{attrs:{id:"_2、加载-css"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、加载-css"}},[s._v("#")]),s._v(" 2、加载 CSS")]),s._v(" "),t("p",[s._v("为了在 JavaScript 模块中 "),t("code",[s._v("import")]),s._v(" 一个 CSS 文件，你需要安装 "),t("a",{attrs:{href:"https://webpack.docschina.org/loaders/style-loader",target:"_blank",rel:"noopener noreferrer"}},[s._v("style-loader"),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://webpack.docschina.org/loaders/css-loader",target:"_blank",rel:"noopener noreferrer"}},[s._v("css-loader"),t("OutboundLink")],1),s._v("，并在 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/module",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("module")]),s._v(" 配置"),t("OutboundLink")],1),s._v(" 中添加这些 loader：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev style-loader css-loader\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("我们尝试一下，通过在项目中添加一个新的 "),t("code",[s._v("style.css")]),s._v(" 文件，并将其 import 到我们的 "),t("code",[s._v("index.js")]),s._v(" 中：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- style.css\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("src/style.css")])]),s._v(" "),t("div",{staticClass:"language-css extra-class"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v(".hello")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("color")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" red"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './style.css';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.classList.add('hello');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[s._v("现在运行 build 命令：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm run build\n")])])]),t("h3",{attrs:{id:"_3、加载-images-图像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、加载-images-图像"}},[s._v("#")]),s._v(" 3、加载 images 图像")]),s._v(" "),t("p",[s._v("假如，现在我们正在下载 CSS，但是像 background 和 icon 这样的图像，要如何处理呢？在 webpack 5 中，可以使用内置的 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/asset-modules/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Asset Modules"),t("OutboundLink")],1),s._v("，我们可以轻松地将这些内容混入我们的系统中：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(png|svg|jpg|jpeg|gif)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("我们向项目添加一个图像，然后看它是如何工作的，你可以使用任何你喜欢的图像：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- icon.png\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- style.css\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './style.css';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Icon from './icon.png';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.classList.add('hello');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // 将图像添加到我们已经存在的 div 中。\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const myIcon = new Image();\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  myIcon.src = Icon;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.appendChild(myIcon);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[t("strong",[s._v("src/style.css")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(".hello {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  color: red;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  background: url('./icon.png');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("重新构建并再次打开 "),t("code",[s._v("index.html")]),s._v(" 文件：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm run build\n")])])]),t("h3",{attrs:{id:"_4、加载-fonts-字体"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、加载-fonts-字体"}},[s._v("#")]),s._v(" 4、加载 fonts 字体")]),s._v(" "),t("p",[s._v("那么，像字体这样的其他资源如何处理呢？使用 Asset Modules 可以接收并加载任何文件，然后将其输出到构建目录。这就是说，我们可以将它们用于任何类型的文件，也包括字体。让我们更新 "),t("code",[s._v("webpack.config.js")]),s._v(" 来处理字体文件：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(png|svg|jpg|jpeg|gif)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(woff|woff2|eot|ttf|otf)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("在项目中添加一些字体文件：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- my-font.woff\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- my-font.woff2\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- icon.png\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- style.css\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[s._v("配置好 loader 并将字体文件放在合适的位置后，你可以通过一个 "),t("code",[s._v("@font-face")]),s._v(" 声明将其混合。本地的 "),t("code",[s._v("url(...)")]),s._v(" 指令会被 webpack 获取处理，就像它处理图片一样：")]),s._v(" "),t("p",[t("strong",[s._v("src/style.css")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("@font-face {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  font-family: 'MyFont';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  src: url('./my-font.woff2') format('woff2'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    url('./my-font.woff') format('woff');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  font-weight: 600;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  font-style: normal;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(".hello {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  color: red;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  font-family: 'MyFont';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  background: url('./icon.png');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("现在，让我们重新构建，然后看下 webpack 是否处理了我们的字体：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm run build\n")])])]),t("h3",{attrs:{id:"_5、加载数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、加载数据"}},[s._v("#")]),s._v(" 5、加载数据")]),s._v(" "),t("p",[s._v("此外，可以加载的有用资源还有数据，如 JSON 文件，CSV、TSV 和 XML。类似于 NodeJS，JSON 支持实际上是内置的，也就是说 "),t("code",[s._v("import Data from './data.json'")]),s._v(" 默认将正常运行。要导入 CSV、TSV 和 XML，你可以使用 "),t("a",{attrs:{href:"https://github.com/theplatapi/csv-loader",target:"_blank",rel:"noopener noreferrer"}},[s._v("csv-loader"),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://github.com/gisikw/xml-loader",target:"_blank",rel:"noopener noreferrer"}},[s._v("xml-loader"),t("OutboundLink")],1),s._v("。让我们处理加载这三类文件：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install --save-dev csv-loader xml-loader\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(png|svg|jpg|jpeg|gif)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(woff|woff2|eot|ttf|otf)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(csv|tsv)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['csv-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.xml$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['xml-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("在项目中添加一些数据文件：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- data.xml\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- data.csv\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- my-font.woff\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- my-font.woff2\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- icon.png\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- style.css\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("src/data.xml")])]),s._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("note")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Mary"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("John"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("heading")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Reminder"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("heading")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Call Cindy on Tuesday"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("note")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/data.csv")])]),s._v(" "),t("div",{staticClass:"language-csv extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("to,from,heading,body\nMary,John,Reminder,Call Cindy on Tuesday\nZoe,Bill,Reminder,Buy orange juice\nAutumn,Lindsey,Letter,I miss you\n")])])]),t("p",[s._v("现在，你可以 "),t("code",[s._v("import")]),s._v(" 这四种类型的数据(JSON, CSV, TSV, XML)中的任何一种，所导入的 "),t("code",[s._v("Data")]),s._v(" 变量，将包含可直接使用的已解析 JSON：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './style.css';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Icon from './icon.png';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Data from './data.xml';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Notes from './data.csv';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.classList.add('hello');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Add the image to our existing div.\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const myIcon = new Image();\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  myIcon.src = Icon;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.appendChild(myIcon);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log(Data);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log(Notes);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[s._v("重新执行 "),t("code",[s._v("npm run build")]),s._v(" 命令，然后打开 "),t("code",[s._v("dist/index.html")]),s._v("。查看开发者工具中的控制台，你应该能够看到导入的数据会被打印出来！")]),s._v(" "),t("h4",{attrs:{id:"_1-自定义-json-模块-parser"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义-json-模块-parser"}},[s._v("#")]),s._v(" (1) 自定义 JSON 模块 parser")]),s._v(" "),t("p",[s._v("通过使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/module/#ruleparserparse",target:"_blank",rel:"noopener noreferrer"}},[s._v("自定义 parser"),t("OutboundLink")],1),s._v(" 替代特定的 webpack loader，可以将任何 "),t("code",[s._v("toml")]),s._v("、"),t("code",[s._v("yaml")]),s._v(" 或 "),t("code",[s._v("json5")]),s._v(" 文件作为 JSON 模块导入。")]),s._v(" "),t("p",[s._v("假设你在 "),t("code",[s._v("src")]),s._v(" 文件夹下有一个 "),t("code",[s._v("data.toml")]),s._v("、一个 "),t("code",[s._v("data.yaml")]),s._v(" 以及一个 "),t("code",[s._v("data.json5")]),s._v(" 文件：")]),s._v(" "),t("p",[t("strong",[s._v("src/data.toml")])]),s._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("title")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TOML Example"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("owner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tom Preston-Werner"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("organization")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GitHub"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("bio")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GitHub Cofounder & CEO\\nLikes tater tots and beer."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("dob")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token date number"}},[s._v("1979-05-27T07:32:00Z")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/data.yaml")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" YAML Example\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("owner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Tom Preston"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Werner\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("organization")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" GitHub\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bio")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n    GitHub Cofounder & CEO\n    Likes tater tots and beer.\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dob")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token datetime number"}},[s._v("1979-05-27T07:32:00.000Z")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/data.json5")])]),s._v(" "),t("div",{staticClass:"language-json5 extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json5"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// comment")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("title")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JSON5 Example"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("owner")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tom Preston-Werner"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("organization")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GitHub"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("bio")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GitHub Cofounder & CEO\\n\\\nLikes tater tots and beer."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property unquoted"}},[s._v("dob")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1979-05-27T07:32:00.000Z"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("首先安装 "),t("code",[s._v("toml")]),s._v("，"),t("code",[s._v("yamljs")]),s._v(" 和 "),t("code",[s._v("json5")]),s._v(" 的 packages：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" toml yamljs json5 --save-dev\n")])])]),t("p",[s._v("并在你的 webpack 中配置它们：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const toml = require('toml');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const yaml = require('yamljs');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const json5 = require('json5');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(png|svg|jpg|jpeg|gif)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(woff|woff2|eot|ttf|otf)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.(csv|tsv)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['csv-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.xml$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        use: ['xml-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.toml$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'json',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        parser: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("          parse: toml.parse,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.yaml$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'json',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        parser: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("          parse: yaml.parse,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        test: /\\.json5$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        type: 'json',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        parser: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("          parse: json5.parse,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("        },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './style.css';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Icon from './icon.png';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Data from './data.xml';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Notes from './data.csv';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import toml from './data.toml';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import yaml from './data.yaml';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import json from './data.json5';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(toml.title); // output `TOML Example`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(toml.owner.name); // output `Tom Preston-Werner`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(yaml.title); // output `YAML Example`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(yaml.owner.name); // output `Tom Preston-Werner`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(json.title); // output `JSON5 Example`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("console.log(json.owner.name); // output `Tom Preston-Werner`\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.classList.add('hello');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Add the image to our existing div.\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const myIcon = new Image();\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  myIcon.src = Icon;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.appendChild(myIcon);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log(Data);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log(Notes);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[s._v("再次运行 "),t("code",[s._v("npm run build")]),s._v(" 命令并在浏览器中打开 "),t("code",[s._v("dist/index.html")]),s._v("，可以在控制台上看到打印结果。")]),s._v(" "),t("h3",{attrs:{id:"_6、全局资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、全局资源"}},[s._v("#")]),s._v(" 6、全局资源")]),s._v(" "),t("p",[s._v("上述所有内容中最出色之处在于，以这种方式加载资源，你可以以更直观的方式将模块和资源组合在一起。无需依赖于含有全部资源的 "),t("code",[s._v("/assets")]),s._v(" 目录，而是将资源与代码组合在一起使用。例如，类似这样的结构会非常有用：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /assets\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |– /components\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |  |– /my-component\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |  |  |– index.jsx\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |  |  |– index.css\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |  |  |– icon.svg\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |  |  |– img.png\n")])])])])]),t("p",[s._v("这种配置方式会使你的代码更具备可移植性，因为现有的集中放置的方式会让所有资源紧密耦合起来。假如你想在另一个项目中使用 "),t("code",[s._v("/my-component")]),s._v("，只需将其复制或移动到 "),t("code",[s._v("/components")]),s._v(" 目录下。只要你已经安装过全部_外部依赖_，并且_已经在配置中定义过相同的 loader_，那么项目应该能够良好运行。")]),s._v(" "),t("p",[s._v("但是，假如你只能被局限在旧有开发方式，或者你有一些在多个组件（视图、模板、模块等）之间共享的资源。你仍然可以将这些资源存储在一个基本目录(base directory)中，甚至配合使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/resolve/#resolvealias",target:"_blank",rel:"noopener noreferrer"}},[s._v("alias"),t("OutboundLink")],1),s._v(" 来使它们更方便 "),t("code",[s._v("import 导入")]),s._v("。")]),s._v(" "),t("p",[s._v("#三、管理输出")]),s._v(" "),t("p",[s._v("到目前为止，我们都是在 "),t("code",[s._v("index.html")]),s._v(" 文件中手动引入所有资源，然而随着应用程序增长，并且一旦开始 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/caching",target:"_blank",rel:"noopener noreferrer"}},[s._v("在文件名中使用 hash"),t("OutboundLink")],1),s._v(" 并输出 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/code-splitting",target:"_blank",rel:"noopener noreferrer"}},[s._v("多个 bundle"),t("OutboundLink")],1),s._v("，如果继续手动管理 "),t("code",[s._v("index.html")]),s._v(" 文件，就会变得困难起来。然而，通过一些插件可以使这个过程更容易管控。")]),s._v(" "),t("h3",{attrs:{id:"_1、预先准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、预先准备"}},[s._v("#")]),s._v(" 1、预先准备")]),s._v(" "),t("p",[s._v("首先，调整一下我们的项目：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- print.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[s._v("我们在 "),t("code",[s._v("src/print.js")]),s._v(" 文件中添加一些逻辑：")]),s._v(" "),t("p",[t("strong",[s._v("src/print.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printMe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'I get called from print.js!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("并且在 "),t("code",[s._v("src/index.js")]),s._v(" 文件中使用这个函数：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import printMe from './print.js';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const btn = document.createElement('button');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  btn.innerHTML = 'Click me and check the console!';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  btn.onclick = printMe;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.appendChild(btn);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])])])])]),t("p",[s._v("还要更新 "),t("code",[s._v("dist/index.html")]),s._v(" 文件，来为 webpack 分离入口做好准备：")]),s._v(" "),t("p",[t("strong",[s._v("dist/index.html")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<!DOCTYPE html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("<html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <meta charset="utf-8" />\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    <title>管理资源</title>\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    <title>管理输出</title>\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="./print.bundle.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  <body>\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="bundle.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    <script src="./index.bundle.js"><\/script>\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  </body>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("</html>\n")])])])])]),t("p",[s._v("现在调整配置。我们将在 entry 添加 "),t("code",[s._v("src/print.js")]),s._v(" 作为新的入口起点（"),t("code",[s._v("print")]),s._v("），然后修改 output，以便根据入口起点定义的名称，动态地产生 bundle 名称：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[t("strong",[s._v("执行 "),t("code",[s._v("npm run build")])])]),s._v(" "),t("p",[s._v("我们可以看到，webpack 生成 "),t("code",[s._v("print.bundle.js")]),s._v(" 和 "),t("code",[s._v("index.bundle.js")]),s._v(" 文件，这也和我们在 "),t("code",[s._v("index.html")]),s._v(" 文件中指定的文件名称相对应。如果你在浏览器中打开 "),t("code",[s._v("index.html")]),s._v("，就可以看到在点击按钮时会发生什么。")]),s._v(" "),t("p",[s._v("但是，如果我们更改了我们的一个入口起点的名称，甚至添加了一个新的入口，会发生什么？会在构建时重新命名生成的 bundle，但是我们的 "),t("code",[s._v("index.html")]),s._v(" 文件仍然引用旧的名称。让我们用 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/html-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("HtmlWebpackPlugin")]),t("OutboundLink")],1),s._v(" 来解决这个问题。")]),s._v(" "),t("h3",{attrs:{id:"_2、设置-htmlwebpackplugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置-htmlwebpackplugin"}},[s._v("#")]),s._v(" 2、设置 HtmlWebpackPlugin")]),s._v(" "),t("p",[s._v("首先安装插件，并且调整 "),t("code",[s._v("webpack.config.js")]),s._v(" 文件：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev html-webpack-plugin\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: '管理输出',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("在我们构建之前，你应该了解，虽然在 "),t("code",[s._v("dist/")]),s._v(" 文件夹我们已经有了 "),t("code",[s._v("index.html")]),s._v(" 这个文件，然而 "),t("code",[s._v("HtmlWebpackPlugin")]),s._v(" 还是会默认生成它自己的 "),t("code",[s._v("index.html")]),s._v(" 文件。也就是说，它会用新生成的 "),t("code",[s._v("index.html")]),s._v(" 文件，替换我们的原有文件。")]),s._v(" "),t("p",[s._v("如果在代码编辑器中打开 "),t("code",[s._v("index.html")]),s._v("，你会看到 "),t("code",[s._v("HtmlWebpackPlugin")]),s._v(" 创建了一个全新的文件，所有的 bundle 会自动添加到 html 中。")]),s._v(" "),t("h3",{attrs:{id:"_3、清理-dist-文件夹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、清理-dist-文件夹"}},[s._v("#")]),s._v(" 3、清理 "),t("code",[s._v("/dist")]),s._v(" 文件夹")]),s._v(" "),t("p",[s._v("你可能已经注意到，由于遗留了之前的指南和代码示例，我们的 "),t("code",[s._v("/dist")]),s._v(" 文件夹显得相当杂乱。webpack 将生成文件并放置在 "),t("code",[s._v("/dist")]),s._v(" 文件夹中，但是它不会追踪哪些文件是实际在项目中用到的。")]),s._v(" "),t("p",[s._v("通常比较推荐的做法是，在每次构建前清理 "),t("code",[s._v("/dist")]),s._v(" 文件夹，这样只会生成用到的文件。让我们实现这个需求。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.npmjs.com/package/clean-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("clean-webpack-plugin")]),t("OutboundLink")],1),s._v(" 是一个流行的清理插件，安装和配置它。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev clean-webpack-plugin\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin(),\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Output Management',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("现在，执行 "),t("code",[s._v("npm run build")]),s._v("，检查 "),t("code",[s._v("/dist")]),s._v(" 文件夹。如果一切顺利，现在只会看到构建后生成的文件，而没有旧文件！")]),s._v(" "),t("h3",{attrs:{id:"_4、manifest"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、manifest"}},[s._v("#")]),s._v(" 4、manifest")]),s._v(" "),t("p",[s._v("你可能会很感兴趣，webpack 和 webpack 插件似乎“知道”应该生成哪些文件。答案是，webpack 通过 manifest，可以追踪所有模块到输出 bundle 之间的映射。如果你想要知道如何以其他方式来控制 webpack "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("输出")]),t("OutboundLink")],1),s._v("，了解 manifest 是个好的开始。")]),s._v(" "),t("p",[s._v("通过 "),t("a",{attrs:{href:"https://github.com/shellscape/webpack-manifest-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("WebpackManifestPlugin")]),t("OutboundLink")],1),s._v(" 插件，可以将 manifest 数据提取为一个容易使用的 json 文件。")]),s._v(" "),t("p",[s._v("首先安装 webpack-manifest-plugin：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install webpack-manifest-plugin --save-dev\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin')\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { WebpackManifestPlugin } = require('webpack-manifest-plugin')\n")])]),s._v("\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     title: '管理输出',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   }),\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   new WebpackManifestPlugin()\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("};\n")])])]),t("p",[s._v("现在，执行 "),t("code",[s._v("npm run build")]),s._v("，会发现 "),t("code",[s._v("dist/manifest.json")]),s._v("文件，文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index.js"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoindex.bundle.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"print.js"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoprint.bundle.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index.html"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoindex.html"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"四、开发环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、开发环境"}},[s._v("#")]),s._v(" 四、开发环境")]),s._v(" "),t("p",[s._v("如果你一直跟随之前的指南，应该对一些 webpack 基础知识有着很扎实的理解。在我们继续之前，先来看看如何设置一个开发环境，使我们的开发体验变得更轻松一些。")]),s._v(" "),t("p",[s._v("在开始前，我们先将 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/mode/#mode-development",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("mode")]),s._v(" 设置为 "),t("code",[s._v("'development'")]),t("OutboundLink")],1),s._v("，并将 "),t("code",[s._v("title")]),s._v(" 设置为 "),t("code",[s._v("'Development'")]),s._v("。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Output Management',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Development',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("h3",{attrs:{id:"_1、使用-source-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用-source-map"}},[s._v("#")]),s._v(" 1、使用 source-map")]),s._v(" "),t("p",[s._v("当 webpack 打包源代码时，可能会很难追踪到 error(错误) 和 warning(警告) 在源代码中的原始位置。例如，如果将三个源文件（"),t("code",[s._v("a.js")]),s._v(", "),t("code",[s._v("b.js")]),s._v(" 和 "),t("code",[s._v("c.js")]),s._v("）打包到一个 bundle（"),t("code",[s._v("bundle.js")]),s._v("）中，而其中一个源文件包含一个错误，那么堆栈跟踪就会直接指向到 "),t("code",[s._v("bundle.js")]),s._v("。你可能需要准确地知道错误来自于哪个源文件，所以这种提示这通常不会提供太多帮助。")]),s._v(" "),t("p",[s._v("为了更容易地追踪 error 和 warning，JavaScript 提供了 "),t("a",{attrs:{href:"http://blog.teamtreehouse.com/introduction-source-maps",target:"_blank",rel:"noopener noreferrer"}},[s._v("source maps"),t("OutboundLink")],1),s._v(" 功能，可以将编译后的代码映射回原始源代码。如果一个错误来自于 "),t("code",[s._v("b.js")]),s._v("，source map 就会明确的告诉你。")]),s._v(" "),t("h4",{attrs:{id:"_1-devtool-配置说明表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-devtool-配置说明表"}},[s._v("#")]),s._v(" (1) devtool 配置说明表")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("devtool")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("performance")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("production")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("quality")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("comment")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("(none)")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": fastest  "),t("strong",[s._v("rebuild")]),s._v(": fastest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("bundle")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Recommended choice for production builds with maximum performance.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[t("code",[s._v("eval")])])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": fast  "),t("strong",[s._v("rebuild")]),s._v(": fastest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("generated")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Recommended choice for development builds with maximum performance.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("eval-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": fast")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Tradeoff choice for development builds.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("eval-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": fast")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Tradeoff choice for development builds.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[t("code",[s._v("eval-source-map")])])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": ok")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Recommended choice for development builds with high quality SourceMaps.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("strong",[t("code",[s._v("source-map")])])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Recommended choice for production builds with high quality SourceMaps.")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Possible choice when publishing a single file")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("eval-nosources-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": fast")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("eval-nosources-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": fast")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("eval-nosources-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": ok")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-nosources-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-nosources-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("inline-nosources-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("nosources-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("nosources-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("nosources-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-nosources-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference, source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-nosources-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference, source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-nosources-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference, source code not included")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-cheap-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": ok  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("transformed")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-cheap-module-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slow  "),t("strong",[s._v("rebuild")]),s._v(": slow")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original lines")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hidden-source-map")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("strong",[s._v("build")]),s._v(": slowest  "),t("strong",[s._v("rebuild")]),s._v(": slowest")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("original")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("no reference. Possible choice when using SourceMap only for error reporting purposes.")])])])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("开发环境推荐配置")])]),s._v(" "),t("p",[s._v("以下选项非常适合开发环境：")]),s._v(" "),t("p",[t("code",[s._v("eval")]),s._v(" - 每个模块都使用 "),t("code",[s._v("eval()")]),s._v(" 执行，并且都有 "),t("code",[s._v("//@ sourceURL")]),s._v("。此选项会非常快地构建。主要缺点是，由于会映射到转换后的代码，而不是映射到原始代码（没有从 loader 中获取 source map），所以不能正确的显示行数。")]),s._v(" "),t("p",[t("code",[s._v("eval-source-map")]),s._v(" - 每个模块使用 "),t("code",[s._v("eval()")]),s._v(" 执行，并且 source map 转换为 DataUrl 后添加到 "),t("code",[s._v("eval()")]),s._v(" 中。初始化 source map 时比较慢，但是会在重新构建时提供比较快的速度，并且生成实际的文件。行数能够正确映射，因为会映射到原始代码中。它会生成用于开发环境的最佳品质的 source map。")]),s._v(" "),t("p",[t("code",[s._v("eval-cheap-source-map")]),s._v(" - 类似 "),t("code",[s._v("eval-source-map")]),s._v("，每个模块使用 "),t("code",[s._v("eval()")]),s._v(' 执行。这是 "cheap(低开销)" 的 source map，因为它没有生成列映射(column mapping)，只是映射行数。它会忽略源自 loader 的 source map，并且仅显示转译后的代码，就像 '),t("code",[s._v("eval")]),s._v(" devtool。")]),s._v(" "),t("p",[t("code",[s._v("eval-cheap-module-source-map")]),s._v(" - 类似 "),t("code",[s._v("eval-cheap-source-map")]),s._v("，并且，在这种情况下，源自 loader 的 source map 会得到更好的处理结果。然而，loader source map 会被简化为每行一个映射(mapping)。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("生产环境推荐配置")])]),s._v(" "),t("p",[s._v("这些选项通常用于生产环境中：")]),s._v(" "),t("p",[t("code",[s._v("(none)")]),s._v("（省略 "),t("code",[s._v("devtool")]),s._v(" 选项） - 不生成 source map。这是一个不错的选择。")]),s._v(" "),t("p",[t("code",[s._v("source-map")]),s._v(" - 整个 source map 作为一个单独的文件生成。它为 bundle 添加了一个引用注释，以便开发工具知道在哪里可以找到它。")]),s._v(" "),t("p",[t("code",[s._v("hidden-source-map")]),s._v(" - 与 "),t("code",[s._v("source-map")]),s._v(" 相同，但不会为 bundle 添加引用注释。如果你只想 source map 映射那些源自错误报告的错误堆栈跟踪信息，但不想为浏览器开发工具暴露你的 source map，这个选项会很有用。")]),s._v(" "),t("p",[t("code",[s._v("nosources-source-map")]),s._v(" - 创建的 source map 不包含 "),t("code",[s._v("sourcesContent(源代码内容)")]),s._v("。它可以用来映射客户端上的堆栈跟踪，而无须暴露所有的源代码。你可以将 source map 文件部署到 web 服务器。")])])]),s._v(" "),t("p",[s._v("###(2) 配置示例")]),s._v(" "),t("p",[s._v("webpack 仓库中包含一个 "),t("a",{attrs:{href:"https://github.com/webpack/webpack/tree/master/examples/source-map",target:"_blank",rel:"noopener noreferrer"}},[s._v("显示所有 "),t("code",[s._v("devtool")]),s._v(" 变体效果的示例"),t("OutboundLink")],1),s._v("。这些例子或许会有助于你理解这些差异之处。")]),s._v(" "),t("p",[t("strong",[s._v("example.coffee")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("## Taken from http://coffeescript.org/\n\n## Objects:\nmath =\n  root:   Math.sqrt\n  square: square\n  cube:   (x) -> x * square x\n\n## Splats:\nrace = (winner, runners...) ->\n  print winner, runners\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('var path = require("path");\n\nmodule.exports = [\n\t"eval",\n\t"eval-cheap-source-map",\n\t"eval-cheap-module-source-map",\n\t"eval-source-map",\n\t"cheap-source-map",\n\t"cheap-module-source-map",\n\t"inline-cheap-source-map",\n\t"inline-cheap-module-source-map",\n\t"source-map",\n\t"inline-source-map",\n\t"hidden-source-map",\n\t"nosources-source-map"\n].map(devtool => ({\n\tmode: "development",\n\tentry: {\n\t\tbundle: "coffee-loader!./example.coffee"\n\t},\n\toutput: {\n\t\tpath: path.join(__dirname, "dist"),\n\t\tfilename: `./[name]-${devtool}.js`\n\t},\n\tdevtool,\n\toptimization: {\n\t\truntimeChunk: true\n\t}\n}));\n')])])]),t("p",[t("strong",[s._v("Generated source-maps")])]),s._v(" "),t("ul",[t("li",[s._v("source-map.js and source-map.js.map")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\n// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n\n\n/***/ })\n],\n0,[[0,1]]]);\n//## sourceMappingURL=bundle-source-map.js.map\n{"version":3,"sources":["webpack:///./example.coffee"],"names":[],"mappings":";;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK","file":"./bundle-source-map.js","sourcesContent":["## Taken from http://coffeescript.org/\\n\\n## Objects:\\nmath =\\n  root:   Math.sqrt\\n  square: square\\n  cube:   (x) -> x * square x\\n\\n## Splats:\\nrace = (winner, runners...) ->\\n  print winner, runners\\n"],"sourceRoot":""}\n')])])]),t("ul",[t("li",[s._v("hidden-source-map.js and hidden-source-map.js.map")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\n// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n\n\n/***/ })\n],\n0,[[0,1]]]);\n{"version":3,"sources":["webpack:///./example.coffee"],"names":[],"mappings":";;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK","file":"./bundle-hidden-source-map.js","sourcesContent":["## Taken from http://coffeescript.org/\\n\\n## Objects:\\nmath =\\n  root:   Math.sqrt\\n  square: square\\n  cube:   (x) -> x * square x\\n\\n## Splats:\\nrace = (winner, runners...) ->\\n  print winner, runners\\n"],"sourceRoot":""}\n')])])]),t("ul",[t("li",[s._v("inline-source-map.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\n// Taken from http://coffeescript.org/\n\n// Objects:\nvar math, race;\n\nmath = {\n  root: Math.sqrt,\n  square: square,\n  cube: function(x) {\n    return x * square(x);\n  }\n};\n\n// Splats:\nrace = function(winner, ...runners) {\n  return print(winner, runners);\n};\n\n\n/***/ })\n],\n0,[[0,1]]]);\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9leGFtcGxlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFVTs7O0FBQUE7O0FBQ1YsT0FDRTtFQUFBLE1BQVEsSUFBSSxDQUFDLElBQWI7RUFDQSxRQUFRLE1BRFI7RUFFQSxNQUFRLFNBQUMsQ0FBRDtXQUFPLElBQUksT0FBTyxDQUFQO0VBQVg7QUFGUixFQUZROzs7QUFPVixPQUFPLFNBQUMsTUFBRCxLQUFTLE9BQVQ7U0FDTCxNQUFNLE1BQU4sRUFBYyxPQUFkO0FBREsiLCJmaWxlIjoiLi9idW5kbGUtaW5saW5lLXNvdXJjZS1tYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIjIFRha2VuIGZyb20gaHR0cDovL2NvZmZlZXNjcmlwdC5vcmcvXG5cbiMgT2JqZWN0czpcbm1hdGggPVxuICByb290OiAgIE1hdGguc3FydFxuICBzcXVhcmU6IHNxdWFyZVxuICBjdWJlOiAgICh4KSAtPiB4ICogc3F1YXJlIHhcblxuIyBTcGxhdHM6XG5yYWNlID0gKHdpbm5lciwgcnVubmVycy4uLikgLT5cbiAgcHJpbnQgd2lubmVyLCBydW5uZXJzXG4iXSwic291cmNlUm9vdCI6IiJ9\n')])])]),t("ul",[t("li",[s._v("nosources-source-map.js.map")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{"version":3,"sources":["webpack:///./example.coffee"],"names":[],"mappings":";;;;;;;;;AAEU;;;AAAA;;AACV,OACE;EAAA,MAAQ,IAAI,CAAC,IAAb;EACA,QAAQ,MADR;EAEA,MAAQ,SAAC,CAAD;WAAO,IAAI,OAAO,CAAP;EAAX;AAFR,EAFQ;;;AAOV,OAAO,SAAC,MAAD,KAAS,OAAT;SACL,MAAM,MAAN,EAAc,OAAd;AADK","file":"./bundle-nosources-source-map.js","sourceRoot":""}\n')])])]),t("ul",[t("li",[s._v("eval-source-map.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/*\n * ATTENTION: An "eval-source-map" devtool has been used.\n * This devtool is neither made for production nor for readable output files.\n * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.\n * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n * or disable the default devtool with "devtool: false".\n * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).\n */\n(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\neval("// Taken from http://coffeescript.org/\\n\\n// Objects:\\nvar math, race;\\n\\nmath = {\\n  root: Math.sqrt,\\n  square: square,\\n  cube: function(x) {\\n    return x * square(x);\\n  }\\n};\\n\\n// Splats:\\nrace = function(winner, ...runners) {\\n  return print(winner, runners);\\n};\\n//## sourceURL=[module]\\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vZXhhbXBsZS5jb2ZmZWU/MjQxNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFVTs7O0FBQUEsSUFBQSxJQUFBLEVBQUE7O0FBQ1YsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFRLElBQUksQ0FBQyxJQUFiO0VBQ0EsTUFBQSxFQUFRLE1BRFI7RUFFQSxJQUFBLEVBQVEsUUFBQSxDQUFDLENBQUQsQ0FBQTtXQUFPLENBQUEsR0FBSSxNQUFBLENBQU8sQ0FBUDtFQUFYO0FBRlIsRUFGUTs7O0FBT1YsSUFBQSxHQUFPLFFBQUEsQ0FBQyxNQUFELEVBQUEsR0FBUyxPQUFULENBQUE7U0FDTCxLQUFBLENBQU0sTUFBTixFQUFjLE9BQWQ7QUFESyIsInNvdXJjZXNDb250ZW50IjpbIiMgVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuIyBPYmplY3RzOlxubWF0aCA9XG4gIHJvb3Q6ICAgTWF0aC5zcXJ0XG4gIHNxdWFyZTogc3F1YXJlXG4gIGN1YmU6ICAgKHgpIC0+IHggKiBzcXVhcmUgeFxuXG4jIFNwbGF0czpcbnJhY2UgPSAod2lubmVyLCBydW5uZXJzLi4uKSAtPlxuICBwcmludCB3aW5uZXIsIHJ1bm5lcnNcbiJdLCJmaWxlIjoiMC5qcyJ9\\n//## sourceURL=webpack-internal:///0\\n");\n\n/***/ })\n],\n0,[[0,1]]]);\n')])])]),t("ul",[t("li",[s._v("eval.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/*\n * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").\n * This devtool is neither made for production nor for readable output files.\n * It uses "eval()" calls to create a separate source file in the browser devtools.\n * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n * or disable the default devtool with "devtool: false".\n * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).\n */\n(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\neval("// Taken from http://coffeescript.org/\\n\\n// Objects:\\nvar math, race;\\n\\nmath = {\\n  root: Math.sqrt,\\n  square: square,\\n  cube: function(x) {\\n    return x * square(x);\\n  }\\n};\\n\\n// Splats:\\nrace = function(winner, ...runners) {\\n  return print(winner, runners);\\n};\\n\\n\\n//## sourceURL=webpack:///./example.coffee?../../node_modules/coffee-loader/dist/cjs.js");\n\n/***/ })\n],\n0,[[0,1]]]);\n')])])]),t("ul",[t("li",[s._v("eval-cheap-source-map.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/*\n * ATTENTION: An "eval-source-map" devtool has been used.\n * This devtool is neither made for production nor for readable output files.\n * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.\n * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n * or disable the default devtool with "devtool: false".\n * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).\n */\n(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\neval("// Taken from http://coffeescript.org/\\n\\n// Objects:\\nvar math, race;\\n\\nmath = {\\n  root: Math.sqrt,\\n  square: square,\\n  cube: function(x) {\\n    return x * square(x);\\n  }\\n};\\n\\n// Splats:\\nrace = function(winner, ...runners) {\\n  return print(winner, runners);\\n};\\n//## sourceURL=[module]\\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2V4YW1wbGUuY29mZmVlP2VlNTgiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuLy8gT2JqZWN0czpcbnZhciBtYXRoLCByYWNlO1xuXG5tYXRoID0ge1xuICByb290OiBNYXRoLnNxcnQsXG4gIHNxdWFyZTogc3F1YXJlLFxuICBjdWJlOiBmdW5jdGlvbih4KSB7XG4gICAgcmV0dXJuIHggKiBzcXVhcmUoeCk7XG4gIH1cbn07XG5cbi8vIFNwbGF0czpcbnJhY2UgPSBmdW5jdGlvbih3aW5uZXIsIC4uLnJ1bm5lcnMpIHtcbiAgcmV0dXJuIHByaW50KHdpbm5lciwgcnVubmVycyk7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\\n//## sourceURL=webpack-internal:///0\\n");\n\n/***/ })\n],\n0,[[0,1]]]);\n')])])]),t("ul",[t("li",[s._v("eval-cheap-module-source-map.js")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/*\n * ATTENTION: An "eval-source-map" devtool has been used.\n * This devtool is neither made for production nor for readable output files.\n * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.\n * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n * or disable the default devtool with "devtool: false".\n * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).\n */\n(self["webpackChunk"] = self["webpackChunk"] || []).push([[0],[\n/* 0 */\n/*!*********************************************************************!*\\\n  !*** ../../node_modules/coffee-loader/dist/cjs.js!./example.coffee ***!\n  \\*********************************************************************/\n/*! unknown exports (runtime-defined) */\n/*! runtime requirements:  */\n/***/ (() => {\n\neval("// Taken from http://coffeescript.org/\\n\\n// Objects:\\nvar math, race;\\n\\nmath = {\\n  root: Math.sqrt,\\n  square: square,\\n  cube: function(x) {\\n    return x * square(x);\\n  }\\n};\\n\\n// Splats:\\nrace = function(winner, ...runners) {\\n  return print(winner, runners);\\n};\\n//## sourceURL=[module]\\n//## sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vZXhhbXBsZS5jb2ZmZWU/MjQxNiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFVTs7O0FBQUEsSUFBQSxJQUFBLEVBQUE7O0FBQ1YsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFRLElBQUksQ0FBQyxJQUFiO0VBQ0EsTUFBQSxFQUFRLE1BRFI7RUFFQSxJQUFBLEVBQVEsUUFBQSxDQUFDLENBQUQsQ0FBQTtXQUFPLENBQUEsR0FBSSxNQUFBLENBQU8sQ0FBUDtFQUFYO0FBRlIsRUFGUTs7O0FBT1YsSUFBQSxHQUFPLFFBQUEsQ0FBQyxNQUFELEVBQUEsR0FBUyxPQUFULENBQUE7U0FDTCxLQUFBLENBQU0sTUFBTixFQUFjLE9BQWQ7QUFESyIsInNvdXJjZXNDb250ZW50IjpbIiMgVGFrZW4gZnJvbSBodHRwOi8vY29mZmVlc2NyaXB0Lm9yZy9cblxuIyBPYmplY3RzOlxubWF0aCA9XG4gIHJvb3Q6ICAgTWF0aC5zcXJ0XG4gIHNxdWFyZTogc3F1YXJlXG4gIGN1YmU6ICAgKHgpIC0+IHggKiBzcXVhcmUgeFxuXG4jIFNwbGF0czpcbnJhY2UgPSAod2lubmVyLCBydW5uZXJzLi4uKSAtPlxuICBwcmludCB3aW5uZXIsIHJ1bm5lcnNcbiJdLCJmaWxlIjoiMC5qcyJ9\\n//## sourceURL=webpack-internal:///0\\n");\n\n/***/ })\n],\n0,[[0,1]]]);\n')])])]),t("ul",[t("li",[s._v("cheap-module-source-map.js.map")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{"version":3,"file":"./bundle-cheap-module-source-map.js","sources":["webpack:///./example.coffee"],"sourcesContent":["## Taken from http://coffeescript.org/\\n\\n## Objects:\\nmath =\\n  root:   Math.sqrt\\n  square: square\\n  cube:   (x) -> x * square x\\n\\n## Splats:\\nrace = (winner, runners...) ->\\n  print winner, runners\\n"],"mappings":";;;;;;;;;AAEA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAFA;AACA;;AAIA;AACA;AADA;AACA;AACA;A;;A","sourceRoot":""}\n')])])]),t("ul",[t("li",[s._v("cheap-source-map.js.map")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{"version":3,"file":"./bundle-cheap-source-map.js","sources":["webpack:///./example.coffee"],"sourcesContent":["// Taken from http://coffeescript.org/\\n\\n// Objects:\\nvar math, race;\\n\\nmath = {\\n  root: Math.sqrt,\\n  square: square,\\n  cube: function(x) {\\n    return x * square(x);\\n  }\\n};\\n\\n// Splats:\\nrace = function(winner, ...runners) {\\n  return print(winner, runners);\\n};\\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;A","sourceRoot":""}\n')])])]),t("h4",{attrs:{id:"_3-演练"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-演练"}},[s._v("#")]),s._v(" (3) 演练")]),s._v(" "),t("p",[s._v("对于本指南，我们将使用 "),t("code",[s._v("inline-source-map")]),s._v(" 选项，这有助于解释说明示例意图（此配置仅用于示例，不要用于生产环境）：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devtool: 'inline-source-map',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("现在，让我们来做一些调试，在 "),t("code",[s._v("print.js")]),s._v(" 文件中生成一个错误：")]),s._v(" "),t("p",[t("strong",[s._v("src/print.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("export default function printMe() {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log('I get called from print.js!');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  cosnole.log('I get called from print.js!');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("**运行 "),t("code",[s._v("npm run build**")])]),s._v(" "),t("p",[s._v("现在，在浏览器中打开生成的 "),t("code",[s._v("index.html")]),s._v(" 文件，点击按钮，并且在控制台查看显示的错误。错误应该如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Uncaught ReferenceError: cosnole is not defined\n   at HTMLButtonElement.printMe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("print.js:2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("我们可以看到，此错误包含有发生错误的文件（"),t("code",[s._v("print.js")]),s._v("）和行号（2）的引用。这是非常有帮助的，因为现在我们可以确切地知道，所要解决问题的位置。")]),s._v(" "),t("h3",{attrs:{id:"_2、选择一个开发工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、选择一个开发工具"}},[s._v("#")]),s._v(" 2、选择一个开发工具")]),s._v(" "),t("p",[s._v("在每次编译代码时，手动运行 "),t("code",[s._v("npm run build")]),s._v(" 会显得很麻烦。")]),s._v(" "),t("p",[s._v("webpack 提供几种可选方式，帮助你在代码发生变化后自动编译代码：")]),s._v(" "),t("ul",[t("li",[s._v("webpack's "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/watch/#watch",target:"_blank",rel:"noopener noreferrer"}},[s._v("Watch Mode"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/webpack/webpack-dev-server",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-dev-server"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/webpack/webpack-dev-middleware",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-dev-middleware"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("多数场景中，你可能需要使用 "),t("code",[s._v("webpack-dev-server")]),s._v("，但是不妨探讨一下以上的所有选项。")]),s._v(" "),t("h4",{attrs:{id:"_1-使用-watch-mode-观察模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-watch-mode-观察模式"}},[s._v("#")]),s._v(" (1) 使用 watch mode("),t("em",[s._v("观察模式")]),s._v(")")]),s._v(" "),t("p",[s._v('你可以指示 webpack "watch" 依赖图中所有文件的更改。如果其中一个文件被更新，代码将被重新编译，所以你不必再去手动运行整个构建。')]),s._v(" "),t("p",[s._v("我们添加一个用于启动 webpack watch mode 的 npm scripts：")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("{\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "private": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "watch": "webpack --watch",\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "clean-webpack-plugin": "^3.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "html-webpack-plugin": "^4.5.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack": "^5.4.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-cli": "^4.2.0"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "dependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "lodash": "^4.17.20"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("如果不想在 watch 触发增量构建后删除 "),t("code",[s._v("index.html")]),s._v(" 文件，可以在 "),t("code",[s._v("CleanWebpackPlugin")]),s._v(" 中配置 "),t("a",{attrs:{href:"https://github.com/johnagan/clean-webpack-plugin#options-and-defaults-optional",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("cleanStaleWebpackAssets")]),s._v(" 选项"),t("OutboundLink")],1),s._v(" 来实现：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devtool: 'inline-source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin(),\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("现在，你可以在命令行中运行 "),t("code",[s._v("npm run watch")]),s._v("，然后就会看到 webpack 是如何编译代码。 然而，你会发现并没有退出命令行。这是因为此 script 当前还在 watch 你的文件。")]),s._v(" "),t("p",[s._v("现在，webpack 观察文件的同时，先移除我们之前加入的错误：")]),s._v(" "),t("p",[t("strong",[s._v("src/print.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("export default function printMe() {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  cosnole.log('I get called from print.js!');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  console.log('I get called from print.js!');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("现在，保存文件并检查 terminal(终端) 窗口。应该可以看到 webpack 自动地重新编译修改后的模块！")]),s._v(" "),t("p",[s._v("唯一的缺点是，为了看到修改后的实际效果，你需要刷新浏览器。如果能够自动刷新浏览器就更好了，因此接下来我们会尝试通过 "),t("code",[s._v("webpack-dev-server")]),s._v(" 实现此功能。")]),s._v(" "),t("h4",{attrs:{id:"_2-使用-webpack-dev-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-webpack-dev-server"}},[s._v("#")]),s._v(" (2) 使用 webpack-dev-server")]),s._v(" "),t("p",[t("code",[s._v("webpack-dev-server")]),s._v(" 为你提供了一个简单的 web server，并且具有 live reloading(实时重新加载) 功能。设置如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack-dev-server\n")])])]),t("p",[s._v("修改配置文件，告知 dev server，从什么位置查找文件：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devtool: 'inline-source-map',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    contentBase: './dist',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("以上配置告知 "),t("code",[s._v("webpack-dev-server")]),s._v("，将 "),t("code",[s._v("dist")]),s._v(" 目录下的文件 serve 到 "),t("code",[s._v("localhost:8080")]),s._v(" 下。")]),s._v(" "),t("p",[s._v("我们添加一个可以直接运行 dev server 的 script：")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("{\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "private": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "watch": "webpack --watch",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "start": "webpack serve --open",\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "clean-webpack-plugin": "^3.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "html-webpack-plugin": "^4.5.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack": "^5.4.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-cli": "^4.2.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-dev-server": "^3.11.0"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "dependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "lodash": "^4.17.20"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("现在，在命令行中运行 "),t("code",[s._v("npm start")]),s._v("，我们会看到浏览器自动加载页面。如果你更改任何源文件并保存它们，web server 将在编译代码后自动重新加载。试试看！")]),s._v(" "),t("h4",{attrs:{id:"_3-使用-webpack-dev-middleware"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-webpack-dev-middleware"}},[s._v("#")]),s._v(" (3) 使用 webpack-dev-middleware")]),s._v(" "),t("p",[t("code",[s._v("webpack-dev-middleware")]),s._v(" 是一个封装器(wrapper)，它可以把 webpack 处理过的文件发送到一个 server。 "),t("code",[s._v("webpack-dev-server")]),s._v(" 在内部使用了它，然而它也可以作为一个单独的 package 来使用，以便根据需求进行更多自定义设置。下面是一个 webpack-dev-middleware 配合 express server 的示例。")]),s._v(" "),t("p",[s._v("首先，安装 "),t("code",[s._v("express")]),s._v(" 和 "),t("code",[s._v("webpack-dev-middleware")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev express webpack-dev-middleware\n")])])]),t("p",[s._v("现在，我们需要调整 webpack 配置文件，以确保 middleware(中间件) 功能能够正确启用：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    print: './src/print.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devtool: 'inline-source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    contentBase: './dist',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new CleanWebpackPlugin({ cleanStaleWebpackAssets: false }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      title: 'Development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    publicPath: '/',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("我们将会在 server 脚本使用 "),t("code",[s._v("publicPath")]),s._v("，以确保文件资源能够正确地 serve 在 "),t("code",[s._v("http://localhost:3000")]),s._v(" 下，稍后我们会指定 port number(端口号)。接下来是设置自定义 "),t("code",[s._v("express")]),s._v(" server：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- server.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- print.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("server.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" express "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpackDevMiddleware "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-dev-middleware'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("express")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./webpack.config.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" compiler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("webpack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 告知 express 使用 webpack-dev-middleware，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 以及将 webpack.config.js 配置文件作为基础配置。")]),s._v("\napp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("webpackDevMiddleware")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    publicPath"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("publicPath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将文件 serve 到 port 3000。")]),s._v("\napp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Example app listening on port 3000!\\n'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("现在，添加一个 npm script，以使我们更方便地运行 server：")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("{\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "private": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "test": "echo \\"Error: no test specified\\" && exit 1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "watch": "webpack --watch",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "start": "webpack serve --open",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "server": "node server.js",\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "clean-webpack-plugin": "^3.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "express": "^4.17.1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "html-webpack-plugin": "^4.5.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack": "^5.4.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-cli": "^4.2.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-dev-middleware": "^4.0.2",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "webpack-dev-server": "^3.11.0"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('  "dependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "lodash": "^4.17.20"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")])])])])]),t("p",[s._v("现在，在 terminal(终端) 中执行 "),t("code",[s._v("npm run server")]),s._v("，将会有类似如下信息输出：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Example app listening on port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-dev-middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" asset index.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.38")]),s._v(" MiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" asset print.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.25")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: print"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" asset index.html "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("274")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" runtime modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.9")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" modules\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cacheable modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("406")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   ./src/print.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   ./node_modules/lodash/lodash.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" webpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0 compiled successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("709")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-dev-middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compiled successfully.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-dev-middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compiling"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-dev-middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" assets by status "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.38")]),s._v(" MiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cached"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" assets\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cached modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("javascript"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.9")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cached"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" modules\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" webpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0 compiled successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-dev-middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compiled successfully.\n")])])]),t("p",[s._v("现在，打开浏览器，访问 "),t("code",[s._v("http://localhost:3000")]),s._v("。应该看到 webpack 应用程序已经运行！")]),s._v(" "),t("h2",{attrs:{id:"五、代码分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、代码分离"}},[s._v("#")]),s._v(" 五、代码分离")]),s._v(" "),t("p",[s._v("代码分离是 webpack 中最引人注目的特性之一。此特性能够把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。")]),s._v(" "),t("p",[s._v("常用的代码分离方法有三种：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("入口起点")]),s._v("：使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("entry")]),t("OutboundLink")],1),s._v(" 配置手动地分离代码。")]),s._v(" "),t("li",[t("strong",[s._v("防止重复")]),s._v("：使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context/#dependencies",target:"_blank",rel:"noopener noreferrer"}},[s._v("Entry dependencies"),t("OutboundLink")],1),s._v(" 或者 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("SplitChunksPlugin")]),t("OutboundLink")],1),s._v(" 去重和分离 chunk。")]),s._v(" "),t("li",[t("strong",[s._v("动态导入")]),s._v("：通过模块的内联函数调用来分离代码。")])]),s._v(" "),t("h3",{attrs:{id:"_1、入口起点-entry-point"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、入口起点-entry-point"}},[s._v("#")]),s._v(" 1、入口起点(entry point)")]),s._v(" "),t("p",[s._v("这是迄今为止最简单直观的分离代码的方式。不过，这种方式手动配置较多，并有一些隐患，我们将会解决这些问题。先来看看如何从 main bundle 中分离 another module(另一个模块)：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- another-module.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[t("strong",[s._v("another-module.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" _ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Another'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'module'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'loaded!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: './src/index.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    another: './src/another-module.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: 'main.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("正如前面提到的，这种方式存在一些隐患：")]),s._v(" "),t("ul",[t("li",[s._v("如果入口 chunk 之间包含一些重复的模块，那些重复模块都会被引入到各个 bundle 中。")]),s._v(" "),t("li",[s._v("这种方法不够灵活，并且不能动态地将核心应用程序逻辑中的代码拆分出来。")])]),s._v(" "),t("p",[s._v("以上两点中，第一点对我们的示例来说无疑是个问题，因为之前我们在 "),t("code",[s._v("./src/index.js")]),s._v(" 中也引入过 "),t("code",[s._v("lodash")]),s._v("，这样就在两个 bundle 中造成重复引用。在下一章节会移除重复的模块。")]),s._v(" "),t("h3",{attrs:{id:"_2、防止重复-prevent-duplication"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、防止重复-prevent-duplication"}},[s._v("#")]),s._v(" 2、防止重复(prevent duplication)")]),s._v(" "),t("h4",{attrs:{id:"_1-入口依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-入口依赖"}},[s._v("#")]),s._v(" (1) 入口依赖")]),s._v(" "),t("p",[s._v("配置 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context/#dependencies",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("dependOn")]),s._v(" option"),t("OutboundLink")],1),s._v(" 选项，这样可以在多个 chunk 之间共享模块：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    another: './src/another-module.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      import: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      dependOn: 'shared',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    another: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      import: './src/another-module.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      dependOn: 'shared',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    shared: 'lodash',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("如果我们要在一个 HTML 页面上使用多个入口时，还需设置 "),t("code",[s._v("optimization.runtimeChunk: 'single'")]),s._v("，否则还会遇到"),t("a",{attrs:{href:"https://bundlers.tooling.report/code-splitting/multi-entry/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),t("OutboundLink")],1),s._v("所述的麻烦。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      import: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      dependOn: 'shared',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    another: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      import: './src/another-module.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      dependOn: 'shared',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    shared: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    runtimeChunk: 'single',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("构建结果如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-cli"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compilation finished\nasset shared.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: shared"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset runtime.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.79")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset index.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.77")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset another.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.65")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: another"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntrypoint index "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.77")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" index.bundle.js\nEntrypoint another "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.65")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" another.bundle.js\nEntrypoint shared "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("557")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" runtime.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.79")]),s._v(" KiB shared.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB\nruntime modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.76")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" modules\ncacheable modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB\n  ./node_modules/lodash/lodash.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ./src/another-module.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("257")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwebpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0 compiled successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("249")]),s._v(" ms\n")])])]),t("p",[s._v("由上可知，除了生成 "),t("code",[s._v("shared.bundle.js")]),s._v("，"),t("code",[s._v("index.bundle.js")]),s._v(" 和 "),t("code",[s._v("another.bundle.js")]),s._v(" 之外，还生成了一个 "),t("code",[s._v("runtime.bundle.js")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("尽管可以在 webpack 中允许每个页面使用多入口，应尽可能避免使用多入口："),t("code",[s._v("entry: { page: ['./analytics', './app'] }")]),s._v("。如此，在使用 "),t("code",[s._v("async")]),s._v(" 脚本标签时，会有更好的优化以及一致的执行顺序。")]),s._v(" "),t("h4",{attrs:{id:"_2-splitchunksplugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-splitchunksplugin"}},[s._v("#")]),s._v(" (2) SplitChunksPlugin")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("SplitChunksPlugin")]),t("OutboundLink")],1),s._v(" 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。让我们使用这个插件，将之前的示例中重复的 "),t("code",[s._v("lodash")]),s._v(" 模块去除：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     another: './src/another-module.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     splitChunks: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       chunks: 'all',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("optimization.splitChunks")]),t("OutboundLink")],1),s._v(" 配置选项之后，现在应该可以看出，"),t("code",[s._v("index.bundle.js")]),s._v(" 和 "),t("code",[s._v("another.bundle.js")]),s._v(" 中已经移除了重复的依赖模块。需要注意的是，插件将 "),t("code",[s._v("lodash")]),s._v(" 分离到单独的 chunk，并且将其从 main bundle 中移除，减轻了大小。执行 "),t("code",[s._v("npm run build")]),s._v(" 查看效果：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-cli"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compilation finished\nasset vendors-node_modules_lodash_lodash_js.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id hint: vendors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset index.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.92")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset another.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: another"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntrypoint index "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("558")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" vendors-node_modules_lodash_lodash_js.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB index.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.92")]),s._v(" KiB\nEntrypoint another "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("558")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" vendors-node_modules_lodash_lodash_js.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB another.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(" KiB\nruntime modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.64")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" modules\ncacheable modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB\n  ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("257")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ./src/another-module.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ./node_modules/lodash/lodash.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwebpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0 compiled successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("241")]),s._v(" ms\n")])])]),t("h4",{attrs:{id:"_3-其他分割工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-其他分割工具"}},[s._v("#")]),s._v(" (3) 其他分割工具")]),s._v(" "),t("p",[s._v("以下是由社区提供，一些对于代码分离很有帮助的 plugin 和 loader：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.npmjs.com/package/mini-css-extract-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("mini-css-extract-plugin")]),t("OutboundLink")],1),s._v(": 用于将 CSS 从主应用程序中分离。")])]),s._v(" "),t("p",[s._v("首先，需要安装 "),t("code",[s._v("mini-css-extract-plugin")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install --save-dev mini-css-extract-plugin css-loader\n")])])]),t("p",[s._v("推荐将 "),t("code",[s._v("mini-css-extract-plugin")]),s._v(" 与 "),t("a",{attrs:{href:"https://github.com/webpack-contrib/css-loader",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("css-loader")]),t("OutboundLink")],1),s._v(" 结合使用。")]),s._v(" "),t("p",[s._v("接下来创建文件配置Webpack：")]),s._v(" "),t("p",[t("strong",[s._v("src/style.css")])]),s._v(" "),t("div",{staticClass:"language-css extra-class"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("body")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("background")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" green"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("import _ from 'lodash'\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './styles.css'\n")])]),s._v("\nfunction component() {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const element = document.createElement('div')\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" element.innerHTML = _.join(['Hello', 'webpack'], ' ')\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" return element\n")])]),s._v("}\n\ndocument.body.appendChild(component())\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path')\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const MiniCssExtractPlugin = require('mini-css-extract-plugin')\n")])]),s._v("\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   another: './src/another-module.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" \n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.css$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       use: [MiniCssExtractPlugin.loader, 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   new MiniCssExtractPlugin()\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" ],\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   splitChunks: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     chunks: 'all',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("}\n")])])]),t("p",[s._v("执行"),t("code",[s._v("npm run build")]),s._v("结果如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("assets by status 555 KiB [compared for emit]\n  asset vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB [compared for emit] (id hint: vendors)\n  asset another.bundle.js 8.68 KiB [compared for emit] (name: another)\nassets by status 9.26 KiB [emitted]\n  asset index.bundle.js 9.23 KiB [emitted] (name: index)\n  asset index.css 30 bytes [emitted] (name: index)\nEntrypoint index 556 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB index.css 30 bytes index.bundle.js 9.23 KiB\nEntrypoint another 555 KiB = vendors-node_modules_lodash_lodash_js.bundle.js 546 KiB another.bundle.js 8.68 KiB\nruntime modules 7.64 KiB 14 modules\ncode generated modules 528 KiB (javascript) 29 bytes (css/mini-extract) [code generated]\n  modules by path ./src/*.js 316 bytes\n    ./src/index.js 232 bytes [built] [code generated]\n    ./src/another-module.js 84 bytes [built] [code generated]\n  modules by path ./src/*.css 50 bytes (javascript) 29 bytes (css/mini-extract)\n    ./src/style.css 50 bytes [built] [code generated]\n    css ./node_modules/css-loader/dist/cjs.js!./src/style.css 29 bytes [code generated]\n  ../../../node_modules/lodash/lodash.js 528 KiB [built] [code generated]\nwebpack 5.21.0 compiled successfully in 594 ms\n✨  Done in 1.44s.\n")])])]),t("p",[s._v("如上所见，"),t("code",[s._v("./src/style.css")]),s._v("被单独的打包出来。")]),s._v(" "),t("h3",{attrs:{id:"_3、动态导入-dynamic-import"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、动态导入-dynamic-import"}},[s._v("#")]),s._v(" 3、动态导入(dynamic import)")]),s._v(" "),t("p",[s._v("当涉及到动态代码拆分时，webpack 提供了两个类似的技术。第一种，也是推荐选择的方式是，使用符合 "),t("a",{attrs:{href:"https://github.com/tc39/proposal-dynamic-import",target:"_blank",rel:"noopener noreferrer"}},[s._v("ECMAScript 提案"),t("OutboundLink")],1),s._v(" 的 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/module-methods/#import-1",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("import()")]),s._v(" 语法"),t("OutboundLink")],1),s._v(" 来实现动态导入。第二种，则是 webpack 的遗留功能，使用 webpack 特定的 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/module-methods/#requireensure",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("require.ensure")]),t("OutboundLink")],1),s._v("。让我们先尝试使用第一种……")]),s._v(" "),t("p",[s._v("在我们开始之前，先从上述示例的配置中移除掉多余的 "),t("a",{attrs:{href:"https://webpack.docschina.org/concepts/entry-points/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("entry")]),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("optimization.splitChunks")]),t("OutboundLink")],1),s._v("，因为接下来的演示中并不需要它们：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    index: './src/index.js',\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    another: './src/another-module.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    splitChunks: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      chunks: 'all',\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    },\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("};\n")])])])])]),t("p",[s._v("我们将更新我们的项目，移除现在未使用的文件：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- another-module.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[s._v("现在，我们不再使用 statically import(静态导入) "),t("code",[s._v("lodash")]),s._v("，而是通过 dynamic import(动态导入) 来分离出一个 chunk：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function component() {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function getComponent() {\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return import('lodash')\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    .then(({ default: _ }) => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    })\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    .catch((error) => 'An error occurred while loading the component');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("document.body.appendChild(component());\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("getComponent().then((component) => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  document.body.appendChild(component);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("});\n")])])])])]),t("p",[s._v("我们之所以需要 "),t("code",[s._v("default")]),s._v("，是因为 webpack 4 在导入 CommonJS 模块时，将不再解析为 "),t("code",[s._v("module.exports")]),s._v(" 的值，而是为 CommonJS 模块创建一个 artificial namespace 对象，更多有关背后原因的信息，请阅读 "),t("a",{attrs:{href:"https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack 4: import() and CommonJs"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("让我们执行 webpack，查看 "),t("code",[s._v("lodash")]),s._v(" 是否会分离到一个单独的 bundle：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webpack-cli"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Compilation finished\nasset vendors-node_modules_lodash_lodash_js.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id hint: vendors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset index.bundle.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.5")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("compared "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" emit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nruntime modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.37")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" modules\ncacheable modules "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB\n  ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("434")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ./node_modules/lodash/lodash.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("530")]),s._v(" KiB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code generated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwebpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0 compiled successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("268")]),s._v(" ms\n")])])]),t("p",[s._v("由于 "),t("code",[s._v("import()")]),s._v(" 会返回一个 promise，因此它可以和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("async")]),s._v(" 函数"),t("OutboundLink")],1),s._v("一起使用。下面是如何通过 async 函数简化代码：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("function getComponent() {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("async function getComponent() {\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const element = document.createElement('div');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  const { default: _ } = await import('lodash');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return import('lodash')\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    .then(({ default: _ }) => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      const element = document.createElement('div');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    })\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    .catch((error) => 'An error occurred while loading the component');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  return element;\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("}\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("getComponent().then((component) => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  document.body.appendChild(component);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("});\n")])])])])]),t("h3",{attrs:{id:"_4、预获取-预加载模块-prefetch-preload-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、预获取-预加载模块-prefetch-preload-module"}},[s._v("#")]),s._v(" 4、预获取/预加载模块(prefetch/preload module)")]),s._v(" "),t("p",[s._v("webpack v4.6.0+ 增加了对预获取和预加载的支持。")]),s._v(" "),t("p",[s._v('在声明 import 时，使用下面这些内置指令，可以让 webpack 输出 "resource hint(资源提示)"，来告知浏览器：')]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("prefetch")]),s._v("(预获取)：将来某些导航下可能需要的资源")]),s._v(" "),t("li",[t("strong",[s._v("preload")]),s._v("(预加载)：当前导航下可能需要资源")])]),s._v(" "),t("p",[s._v("下面这个 prefetch 的简单示例中，有一个 "),t("code",[s._v("HomePage")]),s._v(" 组件，其内部渲染一个 "),t("code",[s._v("LoginButton")]),s._v(" 组件，然后在点击后按需加载 "),t("code",[s._v("LoginModal")]),s._v(" 组件。")]),s._v(" "),t("p",[t("strong",[s._v("LoginButton.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* webpackPrefetch: true */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./path/to/LoginModal.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("这会生成 "),t("code",[s._v('<link rel="prefetch" href="login-modal-chunk.js">')]),s._v(" 并追加到页面头部，指示着浏览器在闲置时间预取 "),t("code",[s._v("login-modal-chunk.js")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("与 prefetch 指令相比，preload 指令有许多不同之处：")]),s._v(" "),t("ul",[t("li",[s._v("preload chunk 会在父 chunk 加载时，以并行方式开始加载。prefetch chunk 会在父 chunk 加载结束后开始加载。")]),s._v(" "),t("li",[s._v("preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载。")]),s._v(" "),t("li",[s._v("preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻。")]),s._v(" "),t("li",[s._v("浏览器支持程度不同。")])]),s._v(" "),t("p",[s._v("下面这个简单的 preload 示例中，有一个 "),t("code",[s._v("Component")]),s._v("，依赖于一个较大的 library，所以应该将其分离到一个独立的 chunk 中。")]),s._v(" "),t("p",[s._v("我们假想这里的图表组件 "),t("code",[s._v("ChartComponent")]),s._v(" 组件需要依赖体积巨大的 "),t("code",[s._v("ChartingLibrary")]),s._v(" 库。它会在渲染时显示一个 "),t("code",[s._v("LoadingIndicator(加载进度条)")]),s._v(" 组件，然后立即按需导入 "),t("code",[s._v("ChartingLibrary")]),s._v("：")]),s._v(" "),t("p",[t("strong",[s._v("ChartComponent.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* webpackPreload: true */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ChartingLibrary'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("在页面中使用 "),t("code",[s._v("ChartComponent")]),s._v(" 时，在请求 ChartComponent.js 的同时，还会通过 "),t("code",[s._v('<link rel="preload">')]),s._v(" 请求 charting-library-chunk。假定 page-chunk 体积很小，很快就被加载好，页面此时就会显示 "),t("code",[s._v("LoadingIndicator(加载进度条)")]),s._v(" ，等到 "),t("code",[s._v("charting-library-chunk")]),s._v(" 请求完成，LoadingIndicator 组件才消失。启动仅需要很少的加载时间，因为只进行单次往返，而不是两次往返。尤其是在高延迟环境下。")]),s._v(" "),t("h3",{attrs:{id:"_5、bundle-分析-bundle-analysis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、bundle-分析-bundle-analysis"}},[s._v("#")]),s._v(" 5、bundle 分析(bundle analysis)")]),s._v(" "),t("p",[s._v("一旦开始分离代码，一件很有帮助的事情是，分析输出结果来检查模块在何处结束。 "),t("a",{attrs:{href:"https://github.com/webpack/analyse",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方分析工具"),t("OutboundLink")],1),s._v(" 是一个不错的开始。还有一些其他社区支持的可选项：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://alexkuz.github.io/webpack-chart/",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-chart"),t("OutboundLink")],1),s._v(": webpack stats 可交互饼图。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://chrisbateman.github.io/webpack-visualizer/",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-visualizer"),t("OutboundLink")],1),s._v(": 可视化并分析你的 bundle，检查哪些模块占用空间，哪些可能是重复使用的。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-bundle-analyzer"),t("OutboundLink")],1),s._v("：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://webpack.jakoblind.no/optimize",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack bundle optimize helper"),t("OutboundLink")],1),s._v("：这个工具会分析你的 bundle，并提供可操作的改进措施，以减少 bundle 的大小。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/bundle-stats/bundle-stats",target:"_blank",rel:"noopener noreferrer"}},[s._v("bundle-stats"),t("OutboundLink")],1),s._v("：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。")])]),s._v(" "),t("p",[s._v("#六、懒加载")]),s._v(" "),t("p",[s._v("懒加载或者按需加载，是一种很好的优化网页或应用的方式。这种方式实际上是先把你的代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。这样加快了应用的初始加载速度，减轻了它的总体体积，因为某些代码块可能永远不会被加载。")]),s._v(" "),t("h3",{attrs:{id:"_1、示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、示例"}},[s._v("#")]),s._v(" 1、示例")]),s._v(" "),t("p",[s._v("我们在"),t("a",{attrs:{href:"https://webpack.docschina.org/guides/code-splitting#dynamic-imports",target:"_blank",rel:"noopener noreferrer"}},[s._v("代码分离"),t("OutboundLink")],1),s._v("中的例子基础上，进一步做些调整来说明这个概念。那里的代码确实会在脚本运行的时候产生一个分离的代码块 "),t("code",[s._v("lodash.bundle.js")]),s._v(" ，在技术概念上“懒加载”它。问题是加载这个包并不需要用户的交互 - 意思是每次加载页面的时候都会请求它。这样做并没有对我们有很多帮助，还会对性能产生负面影响。")]),s._v(" "),t("p",[s._v("我们试试不同的做法。我们增加一个交互，当用户点击按钮的时候用 console 打印一些文字。但是会等到第一次交互的时候再加载那个代码块（"),t("code",[s._v("print.js")]),s._v("）。为此，我们返回到代码分离的例子中，把 "),t("code",[s._v("lodash")]),s._v(" 放到主代码块中，重新运行_代码分离_中的代码。")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- print.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[t("strong",[s._v("src/print.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'The print.js module has loaded! See the network tab in dev tools...'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Button Clicked: Here\\'s \"some text\"!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" async function getComponent() {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const _ = await import(/* webpackChunkName: \"lodash\" */ 'lodash');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const button = document.createElement('button');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const br = document.createElement('br');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   button.innerHTML = 'Click me and look at the console!';\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.appendChild(br);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.appendChild(button);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // Note that because a network request is involved, some indication\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // of loading would need to be shown in a production-level site/app.\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   button.onclick = e => import(/* webpackChunkName: \"print\" */ './print').then(module => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     const print = module.default;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     print();\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   });\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" getComponent().then(component => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   document.body.appendChild(component);\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" });\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("blockquote",[t("p",[s._v("Warning\n注意当调用 ES6 模块的 "),t("code",[s._v("import()")]),s._v(" 方法（引入模块）时，必须指向模块的 "),t("code",[s._v(".default")]),s._v(" 值，因为它才是 promise 被处理后返回的实际的 "),t("code",[s._v("module")]),s._v(" 对象。")])]),s._v(" "),t("p",[s._v("现在运行 webpack 来验证一下我们的懒加载功能：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n          Asset       Size  Chunks                    Chunk Names\nprint.bundle.js  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("417")]),s._v(" bytes       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         print\nindex.bundle.js     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("548")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  index\n     index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("189")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("h3",{attrs:{id:"_2、框架"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、框架"}},[s._v("#")]),s._v(" 2、框架")]),s._v(" "),t("p",[s._v("许多框架和类库对于如何用它们自己的方式来实现（懒加载）都有自己的建议。这里有一些例子：")]),s._v(" "),t("ul",[t("li",[s._v("React: "),t("a",{attrs:{href:"https://reacttraining.com/react-router/web/guides/code-splitting",target:"_blank",rel:"noopener noreferrer"}},[s._v("Code Splitting and Lazy Loading"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("Vue: "),t("a",{attrs:{href:"https://vuedose.tips/tips/dynamic-imports-in-vue-js-for-better-performance/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dynamic Imports in Vue.js for better performance"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("Angular: "),t("a",{attrs:{href:"https://angular.io/guide/router#milestone-6-asynchronous-routing",target:"_blank",rel:"noopener noreferrer"}},[s._v("Lazy Loading route configuration"),t("OutboundLink")],1),s._v(" and "),t("a",{attrs:{href:"https://medium.com/@var_bin/angularjs-webpack-lazyload-bb7977f390dd",target:"_blank",rel:"noopener noreferrer"}},[s._v("AngularJS + webpack = lazyLoad"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"七、缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七、缓存"}},[s._v("#")]),s._v(" 七、缓存")]),s._v(" "),t("p",[s._v("以上，我们使用 webpack 来打包我们的模块化后的应用程序，webpack 会生成一个可部署的 "),t("code",[s._v("/dist")]),s._v(" 目录，然后把打包后的内容放置在此目录中。只要 "),t("code",[s._v("/dist")]),s._v(" 目录中的内容部署到 server 上，client（通常是浏览器）就能够访问此 server 的网站及其资源。而最后一步获取资源是比较耗费时间的，这就是为什么浏览器使用一种名为 "),t("a",{attrs:{href:"https://searchstorage.techtarget.com/definition/cache",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存"),t("OutboundLink")],1),s._v(" 的技术。可以通过命中缓存，以降低网络流量，使网站加载速度更快，然而，如果我们在部署新版本时不更改资源的文件名，浏览器可能会认为它没有被更新，就会使用它的缓存版本。由于缓存的存在，当你需要获取新的代码时，就会显得很棘手。")]),s._v(" "),t("p",[s._v("此指南的重点在于通过必要的配置，以确保 webpack 编译生成的文件能够被客户端缓存，而在文件内容变化后，能够请求到新的文件。")]),s._v(" "),t("h3",{attrs:{id:"_1、输出文件的文件名-output-filename"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、输出文件的文件名-output-filename"}},[s._v("#")]),s._v(" 1、输出文件的文件名(output filename)")]),s._v(" "),t("p",[s._v("我们可以通过替换 "),t("code",[s._v("output.filename")]),s._v(" 中的 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputfilename",target:"_blank",rel:"noopener noreferrer"}},[s._v("substitutions"),t("OutboundLink")],1),s._v(" 设置，来定义输出文件的名称。webpack 提供了一种使用称为 "),t("strong",[s._v("substitution(可替换模板字符串)")]),s._v(" 的方式，通过带括号字符串来模板化文件名。其中，"),t("code",[s._v("[contenthash]")]),s._v(" substitution 将根据资源内容创建出唯一 hash。当资源内容发生变化时，"),t("code",[s._v("[contenthash]")]),s._v(" 也会发生变化。")]),s._v(" "),t("p",[s._v("这里使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/getting-started",target:"_blank",rel:"noopener noreferrer"}},[s._v("起步"),t("OutboundLink")],1),s._v(" 中的示例和 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/output-management",target:"_blank",rel:"noopener noreferrer"}},[s._v("管理输出"),t("OutboundLink")],1),s._v(" 中的 "),t("code",[s._v("plugins")]),s._v(" 插件来作为项目基础，所以我们依然不必手动地维护 "),t("code",[s._v("index.html")]),s._v(" 文件：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Output Management',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Caching',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].[contenthash].js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("使用此配置，然后运行我们的 build script "),t("code",[s._v("npm run build")]),s._v("，产生以下输出：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                       Asset       Size  Chunks                    Chunk Names\nmain.7e2c49a622975ebd9b7e.js     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("544")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\n                  index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("197")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("可以看到，bundle 的名称是它内容（通过 hash）的映射。如果我们不做修改，然后再次运行构建，我们以为文件名会保持不变。然而，如果我们真的运行，可能会发现情况并非如此：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                       Asset       Size  Chunks                    Chunk Names\nmain.205199ab45963f6a62ec.js     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("544")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\n                  index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("197")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("这也是因为 webpack 在入口 chunk 中，包含了某些 boilerplate(引导模板)，特别是 runtime 和 manifest。（boilerplate 指 webpack 运行时的引导代码）")]),s._v(" "),t("h3",{attrs:{id:"_2、提取引导模板-extracting-boilerplate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、提取引导模板-extracting-boilerplate"}},[s._v("#")]),s._v(" 2、提取引导模板(extracting boilerplate)")]),s._v(" "),t("p",[s._v("正如我们在 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/code-splitting",target:"_blank",rel:"noopener noreferrer"}},[s._v("代码分离"),t("OutboundLink")],1),s._v(" 中所学到的，"),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("SplitChunksPlugin")]),t("OutboundLink")],1),s._v(" 可以用于将模块分离到单独的 bundle 中。webpack 还提供了一个优化功能，可使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/#optimizationruntimechunk",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("optimization.runtimeChunk")]),t("OutboundLink")],1),s._v(" 选项将 runtime 代码拆分为一个单独的 chunk。将其设置为 "),t("code",[s._v("single")]),s._v(" 来为所有 chunk 创建一个 runtime bundle：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Caching',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].[contenthash].js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     runtimeChunk: 'single',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("再次构建，然后查看提取出来的 "),t("code",[s._v("runtime")]),s._v(" bundle：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Hash: 82c9c385607b2150fab2\nVersion: webpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.12")]),s._v(".0\nTime: 3027ms\n                          Asset       Size  Chunks             Chunk Names\nruntime.cc17ae2a94ec771e9221.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  runtime\n   main.e81de2cf758ada72f306.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.5")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\n                     index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("275")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/buildin/module.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("497")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/buildin/global.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("489")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("309")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" hidden module\n")])])]),t("p",[s._v("将第三方库(library)（例如 "),t("code",[s._v("lodash")]),s._v(" 或 "),t("code",[s._v("react")]),s._v("）提取到单独的 "),t("code",[s._v("vendor")]),s._v(" chunk 文件中，是比较推荐的做法，这是因为，它们很少像本地的源代码那样频繁修改。因此通过实现以上步骤，利用 client 的长效缓存机制，命中缓存来消除请求，并减少向 server 获取资源，同时还能保证 client 代码和 server 代码版本一致。 这可以通过使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/#split-chunks-example-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("SplitChunksPlugin 示例 2"),t("OutboundLink")],1),s._v(" 中演示的 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("SplitChunksPlugin")]),t("OutboundLink")],1),s._v(" 插件的 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/#splitchunkscachegroups",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("cacheGroups")]),t("OutboundLink")],1),s._v(" 选项来实现。我们在 "),t("code",[s._v("optimization.splitChunks")]),s._v(" 添加如下 "),t("code",[s._v("cacheGroups")]),s._v(" 参数并构建：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Caching',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].[contenthash].js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     runtimeChunk: 'single',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     splitChunks: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       cacheGroups: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         vendor: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           test: /[\\\\/]node_modules[\\\\/]/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           name: 'vendors',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           chunks: 'all',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("再次构建，然后查看新的 "),t("code",[s._v("vendor")]),s._v(" bundle：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                          Asset       Size  Chunks             Chunk Names\nruntime.cc17ae2a94ec771e9221.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  runtime\nvendors.a42c3ca0d742766d7a28.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.4")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  vendors\n   main.abf44fedb7d11d4312d7.js  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("240")]),s._v(" bytes       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\n                     index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("现在，我们可以看到 "),t("code",[s._v("main")]),s._v(" 不再含有来自 "),t("code",[s._v("node_modules")]),s._v(" 目录的 "),t("code",[s._v("vendor")]),s._v(" 代码，并且体积减少到 "),t("code",[s._v("240 bytes")]),s._v("！")]),s._v(" "),t("h3",{attrs:{id:"_3、模块标识符-module-identifier"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、模块标识符-module-identifier"}},[s._v("#")]),s._v(" 3、模块标识符(module identifier)")]),s._v(" "),t("p",[s._v("在项目中再添加一个模块 "),t("code",[s._v("print.js")]),s._v("：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- print.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[t("strong",[s._v("print.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" export default function print(text) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   console.log(text);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import Print from './print';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // lodash 是由当前 script 脚本 import 进来的\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.onclick = Print.bind(null, 'Hello webpack!');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[s._v("再次运行构建，然后我们期望的是，只有 "),t("code",[s._v("main")]),s._v(" bundle 的 hash 发生变化，然而……")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                           Asset       Size  Chunks                    Chunk Names\n  runtime.1400d5af64fc1b7b3a45.js    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.85")]),s._v(" kB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         runtime\n  vendor.a7561fb0e9a071baadb9.js     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("541")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  vendor\n    main.b746e3eb72875af2caa9.js    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.22")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         main\n                      index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("352")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("……我们可以看到这三个文件的 hash 都变化了。这是因为每个 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/module-variables/#moduleid-commonjs",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("module.id")]),t("OutboundLink")],1),s._v(" 会默认地基于解析顺序(resolve order)进行增量。也就是说，当解析顺序发生变化，ID 也会随之改变。因此，简要概括：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("main")]),s._v(" bundle 会随着自身的新增内容的修改，而发生变化。")]),s._v(" "),t("li",[t("code",[s._v("vendor")]),s._v(" bundle 会随着自身的 "),t("code",[s._v("module.id")]),s._v(" 的变化，而发生变化。")]),s._v(" "),t("li",[t("code",[s._v("manifest")]),s._v(" runtime 会因为现在包含一个新模块的引用，而发生变化。")])]),s._v(" "),t("p",[s._v("第一个和最后一个都是符合预期的行为，"),t("code",[s._v("vendor")]),s._v(" hash 发生变化是我们要修复的。我们将 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/#optimizationmoduleids",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("optimization.moduleIds")]),t("OutboundLink")],1),s._v(" 设置为 "),t("code",[s._v("'deterministic'")]),s._v("：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Caching',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].[contenthash].js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   optimization: {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     moduleIds: 'deterministic',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     runtimeChunk: 'single',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     splitChunks: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       cacheGroups: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         vendor: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           test: /[\\\\/]node_modules[\\\\/]/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           name: 'vendors',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           chunks: 'all',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("现在，不论是否添加任何新的本地依赖，对于前后两次构建，"),t("code",[s._v("vendor")]),s._v(" hash 都应该保持一致：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                          Asset       Size  Chunks             Chunk Names\n   main.216e852f60c8829c2289.js  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("340")]),s._v(" bytes       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\nvendors.55e79e5927a639d21a1b.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.5")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  vendors\nruntime.725a1a51ede5ae0cfde0.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  runtime\n                     index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEntrypoint main "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.216e852f60c8829c2289.js\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("然后，修改 "),t("code",[s._v("src/index.js")]),s._v("，临时移除额外的依赖：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import Print from './print';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" // import Print from './print';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // lodash 是由当前 script 脚本 import 进来的\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.onclick = Print.bind(null, 'Hello webpack!');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // element.onclick = Print.bind(null, 'Hello webpack!');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[s._v("最后，再次运行我们的构建：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n                          Asset       Size  Chunks             Chunk Names\n   main.ad717f2466ce655fff5c.js  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("274")]),s._v(" bytes       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\nvendors.55e79e5927a639d21a1b.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.5")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  vendors\nruntime.725a1a51ede5ae0cfde0.js   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(" KiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  runtime\n                     index.html  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" bytes          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEntrypoint main "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" runtime.725a1a51ede5ae0cfde0.js vendors.55e79e5927a639d21a1b.js main.ad717f2466ce655fff5c.js\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("我们可以看到，这两次构建中，"),t("code",[s._v("vendor")]),s._v(" bundle 文件名称，都是 "),t("code",[s._v("55e79e5927a639d21a1b")]),s._v("。")]),s._v(" "),t("p",[s._v("#八、创建 library")]),s._v(" "),t("p",[s._v("除了打包应用程序，webpack 还可以用于打包 JavaScript library。")]),s._v(" "),t("p",[s._v("假设你正在编写一个名为 "),t("code",[s._v("webpack-numbers")]),s._v(" 的小的 library，可以将数字 1 到 5 转换为文本表示，反之亦然，例如将 2 转换为 'two'。")]),s._v(" "),t("p",[s._v("基本的项目结构可能如下所示：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    |- ref.json\n")])])])])]),t("p",[s._v("初始化 npm，安装 webpack 和 lodash：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" init -y\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack lodash\n")])])]),t("p",[t("strong",[s._v("src/ref.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"One"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Two"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Three"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Four"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Five"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"num"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"word"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Zero"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" _ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" numRef "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./ref.json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("numToWord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("num")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" _"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reduce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("numRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("accum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ref")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" num "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("word "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" accum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("word")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" _"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reduce")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("numRef"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("accum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ref")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("word "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" word "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" word"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toLowerCase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" ref"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" accum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("这个 library 的调用规范如下：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("ES2015 module import:")])])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" webpackNumbers "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-numbers'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\nwebpackNumbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Two'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[s._v("CommonJS module require:")])])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpackNumbers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-numbers'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\nwebpackNumbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Two'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[s._v("AMD module require:")])])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpackNumbers'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("webpackNumbers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  webpackNumbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Two'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("consumer(使用者) 还可以通过一个 script 标签来加载和使用此 library：")]),s._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token doctype"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),t("span",{pre:!0,attrs:{class:"token name"}},[s._v("doctype")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  ...\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://unpkg.com/webpack-numbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 全局变量")]),s._v("\n    webpackNumbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Five'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// window 对象中的属性")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webpackNumbers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wordToNum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Five'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  ")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),t("p",[s._v("注意，我们还可以通过以下配置方式，将 library 暴露为：")]),s._v(" "),t("ul",[t("li",[s._v("global 对象中的属性，用于 Node.js。")]),s._v(" "),t("li",[t("code",[s._v("this")]),s._v(" 对象中的属性。")])]),s._v(" "),t("p",[s._v("完整的 library 配置和代码，请查看 "),t("a",{attrs:{href:"https://github.com/kalcifer/webpack-library-example",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-library-example"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_1、基本配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本配置"}},[s._v("#")]),s._v(" 1、基本配置")]),s._v(" "),t("p",[s._v("现在，让我们以某种方式打包这个 library，能够实现以下几个目标：")]),s._v(" "),t("ul",[t("li",[s._v("使用 "),t("code",[s._v("externals")]),s._v(" 选项，避免将 "),t("code",[s._v("lodash")]),s._v(" 打包到应用程序，而使用者会去加载它。")]),s._v(" "),t("li",[s._v("将 library 的名称设置为 "),t("code",[s._v("webpack-numbers")]),s._v("。")]),s._v(" "),t("li",[s._v("将 library 暴露为一个名为 "),t("code",[s._v("webpackNumbers")]),s._v(" 的变量。")]),s._v(" "),t("li",[s._v("能够访问其他 Node.js 中的 library。")])]),s._v(" "),t("p",[s._v("此外，consumer(使用者) 应该能够通过以下方式访问 library：")]),s._v(" "),t("ul",[t("li",[s._v("ES2015 模块。例如 "),t("code",[s._v("import webpackNumbers from 'webpack-numbers'")]),s._v("。")]),s._v(" "),t("li",[s._v("CommonJS 模块。例如 "),t("code",[s._v("require('webpack-numbers')")]),s._v(".")]),s._v(" "),t("li",[s._v("全局变量，在通过 "),t("code",[s._v("script")]),s._v(" 标签引入时。")])]),s._v(" "),t("p",[s._v("我们可以从如下 webpack 基本配置开始：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-numbers.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2、外部化-lodash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、外部化-lodash"}},[s._v("#")]),s._v(" 2、外部化 lodash")]),s._v(" "),t("p",[s._v("现在，如果执行 "),t("code",[s._v("webpack")]),s._v("，你会发现创建了一个体积相当大的文件。如果你查看这个文件，会看到 lodash 也被打包到代码中。在这种场景中，我们更倾向于把 "),t("code",[s._v("lodash")]),s._v(" 当作 "),t("code",[s._v("peerDependency")]),s._v("。也就是说，consumer(使用者) 应该已经安装过 "),t("code",[s._v("lodash")]),s._v(" 。因此，你就可以放弃控制此外部 library ，而是将控制权让给使用 library 的 consumer。")]),s._v(" "),t("p",[s._v("这可以使用 "),t("code",[s._v("externals")]),s._v(" 配置来完成：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'webpack-numbers.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   externals: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     lodash: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs2: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       amd: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       root: '_',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("这意味着你的 library 需要一个名为 "),t("code",[s._v("lodash")]),s._v(" 的依赖，这个依赖在 consumer 环境中必须存在且可用。")]),s._v(" "),t("h3",{attrs:{id:"_3、暴露-library"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、暴露-library"}},[s._v("#")]),s._v(" 3、暴露 library")]),s._v(" "),t("p",[s._v("对于用法广泛的 library，我们希望它能够兼容不同的环境，例如 CommonJS，AMD，Node.js 或者作为一个全局变量。为了让你的 library 能够在各种使用环境中可用，需要在 "),t("code",[s._v("output")]),s._v(" 中添加 "),t("code",[s._v("library")]),s._v(" 属性：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'webpack-numbers.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     library: 'webpackNumbers',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   externals: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     lodash: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs2: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       amd: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       root: '_',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("这会将你的 library bundle 暴露为名为 "),t("code",[s._v("webpackNumbers")]),s._v(" 的全局变量，consumer 通过此名称来 import。为了让 library 和其他环境兼容，则需要在配置中添加 "),t("code",[s._v("libraryTarget")]),s._v(" 属性。这个选项可以控制以多种形式暴露 library。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'webpack-numbers.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     library: 'webpackNumbers',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     libraryTarget: 'umd',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   externals: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     lodash: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       commonjs2: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       amd: 'lodash',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       root: '_',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("有以下几种方式暴露 library：")]),s._v(" "),t("ul",[t("li",[s._v("变量：作为一个全局变量，通过 "),t("code",[s._v("script")]),s._v(" 标签来访问（"),t("code",[s._v("libraryTarget:'var'")]),s._v("）。")]),s._v(" "),t("li",[s._v("this：通过 "),t("code",[s._v("this")]),s._v(" 对象访问（"),t("code",[s._v("libraryTarget:'this'")]),s._v("）。")]),s._v(" "),t("li",[s._v("window：在浏览器中通过 "),t("code",[s._v("window")]),s._v(" 对象访问（"),t("code",[s._v("libraryTarget:'window'")]),s._v("）。")]),s._v(" "),t("li",[s._v("UMD：在 AMD 或 CommonJS "),t("code",[s._v("require")]),s._v(" 之后可访问（"),t("code",[s._v("libraryTarget:'umd'")]),s._v("）。")])]),s._v(" "),t("p",[s._v("如果设置了 "),t("code",[s._v("library")]),s._v(" 但没有设置 "),t("code",[s._v("libraryTarget")]),s._v("，则 "),t("code",[s._v("libraryTarget")]),s._v(" 默认指定为 "),t("code",[s._v("var")]),s._v("，详细说明请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output",target:"_blank",rel:"noopener noreferrer"}},[s._v("output "),t("OutboundLink")],1),s._v("文档。查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output#outputlibrarytarget",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("output.libraryTarget")]),t("OutboundLink")],1),s._v(" 文档，以获取所有可用选项的详细列表。")]),s._v(" "),t("h4",{attrs:{id:"_1-发布准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-发布准备"}},[s._v("#")]),s._v(" (1) 发布准备")]),s._v(" "),t("p",[s._v("遵循 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/production",target:"_blank",rel:"noopener noreferrer"}},[s._v("生产环境"),t("OutboundLink")],1),s._v(" 指南中提到的步骤，来优化生产环境下的输出结果。那么，我们还需要将生成 bundle 的文件路径，添加到 "),t("code",[s._v("package.json")]),s._v(" 中的 "),t("code",[s._v("main")]),s._v(" 字段中。")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ...\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/webpack-numbers.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("或者，按照这个 "),t("a",{attrs:{href:"https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md#typical-usage",target:"_blank",rel:"noopener noreferrer"}},[s._v("指南"),t("OutboundLink")],1),s._v("，将其添加为标准模块：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ...\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"module"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("这里的 key(键) "),t("code",[s._v("main")]),s._v(" 是参照 "),t("a",{attrs:{href:"https://docs.npmjs.com/files/package.json#main",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("package.json")]),s._v(" 标准"),t("OutboundLink")],1),s._v("，而 "),t("code",[s._v("module")]),s._v(" 是参照 "),t("a",{attrs:{href:"https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("一个"),t("OutboundLink")],1),t("a",{attrs:{href:"https://github.com/rollup/rollup/wiki/pkg.module",target:"_blank",rel:"noopener noreferrer"}},[s._v("提案"),t("OutboundLink")],1),s._v("，此提案允许 JavaScript 生态系统升级使用 ES2015 模块，而不会破坏向后兼容性。")]),s._v(" "),t("h4",{attrs:{id:"_2-发布-library"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-发布-library"}},[s._v("#")]),s._v(" (2) 发布 library")]),s._v(" "),t("p",[s._v("现在，你可以 "),t("a",{attrs:{href:"https://docs.npmjs.com/getting-started/publishing-npm-packages",target:"_blank",rel:"noopener noreferrer"}},[s._v("将其发布为一个 npm package"),t("OutboundLink")],1),s._v("，并且在 "),t("a",{attrs:{href:"https://unpkg.com/#/",target:"_blank",rel:"noopener noreferrer"}},[s._v("unpkg.com"),t("OutboundLink")],1),s._v(" 找到它，并分发给你的用户。")]),s._v(" "),t("ul",[t("li",[s._v("注册npm仓库账号")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://www.npmjs.com 上面的账号\n$ npm adduser\n")])])]),t("ul",[t("li",[s._v("上传包")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm publish\n")])])]),t("p",[s._v("坑：403 Forbidden")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("查看npm源：npm config get registry\n切换npm源方法一：npm config set registry http://registry.npmjs.org\n切换npm源方法二：nrm use npm\n")])])]),t("p",[s._v("#九、环境变量")]),s._v(" "),t("p",[s._v("想要消除 "),t("code",[s._v("webpack.config.js")]),s._v(" 在 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/development",target:"_blank",rel:"noopener noreferrer"}},[s._v("开发环境"),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/production",target:"_blank",rel:"noopener noreferrer"}},[s._v("生产环境"),t("OutboundLink")],1),s._v(" 之间的差异，你可能需要环境变量(environment variable)。")]),s._v(" "),t("p",[s._v("webpack 命令行 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/cli/#environment-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("环境配置"),t("OutboundLink")],1),s._v(" 的 "),t("code",[s._v("--env")]),s._v(" 参数，可以允许你传入任意数量的环境变量。而在 "),t("code",[s._v("webpack.config.js")]),s._v(" 中可以访问到这些环境变量。例如，"),t("code",[s._v("--env production")]),s._v(" 或 "),t("code",[s._v("--env NODE_ENV=local")]),s._v("（"),t("code",[s._v("NODE_ENV")]),s._v(" 通常约定用于定义环境类型，查看 "),t("a",{attrs:{href:"https://dzone.com/articles/what-you-should-know-about-node-env",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),t("OutboundLink")],1),s._v("）。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("npx webpack --env "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("local --env production --progress\n")])])]),t("blockquote",[t("p",[s._v("Tip\n如果设置 "),t("code",[s._v("env")]),s._v(" 变量，却没有赋值，"),t("code",[s._v("--env production")]),s._v(" 默认表示将 "),t("code",[s._v("env.production")]),s._v(" 设置为 "),t("code",[s._v("true")]),s._v("。还有许多其他可以使用的语法。更多详细信息，请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/cli/#environment-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack CLI"),t("OutboundLink")],1),s._v(" 文档。")])]),s._v(" "),t("p",[s._v("对于我们的 webpack 配置，有一个必须要修改之处。通常，"),t("code",[s._v("module.exports")]),s._v(" 指向配置对象。要使用 "),t("code",[s._v("env")]),s._v(" 变量，你必须将 "),t("code",[s._v("module.exports")]),s._v(" 转换成一个函数：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Use env.<YOUR VARIABLE> here:")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NODE_ENV: '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 'local'")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Production: '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("production"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bundle.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"十、安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十、安装"}},[s._v("#")]),s._v(" 十、安装")]),s._v(" "),t("p",[s._v("本指南介绍了安装 webpack 的各种方法。")]),s._v(" "),t("h3",{attrs:{id:"_1、前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、前提条件"}},[s._v("#")]),s._v(" 1、前提条件")]),s._v(" "),t("p",[s._v("在开始之前，请确保安装了 "),t("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js"),t("OutboundLink")],1),s._v(" 的最新版本。使用 Node.js 最新的长期支持版本(LTS - Long Term Support)，是理想的起步。 使用旧版本，你可能遇到各种问题，因为它们可能缺少 webpack 功能， 或者缺少相关 package。")]),s._v(" "),t("h3",{attrs:{id:"_2、本地安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、本地安装"}},[s._v("#")]),s._v(" 2、本地安装")]),s._v(" "),t("p",[s._v("最新的 webpack 正式版本是：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/webpack/webpack/releases",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://img.shields.io/npm/v/webpack.svg?label=webpack&style=flat-square&maxAge=3600",alt:"GitHub release"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("要安装最新版本或特定版本，请运行以下命令之一：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 或指定版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack@"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Tip\n是否使用 "),t("code",[s._v("--save-dev")]),s._v(" 取决于你的应用场景。假设你仅使用 webpack 进行构建操作，那么建议你在安装时使用 "),t("code",[s._v("--save-dev")]),s._v(" 选项，因为可能你不需要在生产环境上使用 webpack。如果需要应用于生产环境，请忽略 "),t("code",[s._v("--save-dev")]),s._v(" 选项。")])]),s._v(" "),t("p",[s._v("如果你使用 webpack v4+ 版本，你还需要安装 "),t("a",{attrs:{href:"https://webpack.docschina.org/api/cli/",target:"_blank",rel:"noopener noreferrer"}},[s._v("CLI"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack-cli\n")])])]),t("p",[s._v("对于大多数项目，我们建议本地安装。这可以在引入重大更新(breaking change)版本时，更容易分别升级项目。 通常会通过运行一个或多个 "),t("a",{attrs:{href:"https://docs.npmjs.com/misc/scripts",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm scripts"),t("OutboundLink")],1),s._v(" 以在本地 "),t("code",[s._v("node_modules")]),s._v(" 目录中查找安装的 webpack， 来运行 webpack：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack --config webpack.config.js"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Tip\n想要运行本地安装的 webpack，你可以通过 "),t("code",[s._v("node_modules/.bin/webpack")]),s._v(" 来访问它的二进制版本。另外，如果你使用的是 npm v5.2.0 或更高版本，则可以运行 "),t("code",[s._v("npx webpack")]),s._v(" 来执行。")])]),s._v(" "),t("h3",{attrs:{id:"_3、全局安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、全局安装"}},[s._v("#")]),s._v(" 3、全局安装")]),s._v(" "),t("p",[s._v("通过以下 NPM 安装方式，可以使 "),t("code",[s._v("webpack")]),s._v(" 在全局环境下可用：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --global webpack\n")])])]),t("blockquote",[t("p",[s._v("Warning\n"),t("strong",[s._v("不推荐")]),s._v(" 全局安装 webpack。这会将你项目中的 webpack 锁定到指定版本，并且在使用不同的 webpack 版本的项目中， 可能会导致构建失败。")])]),s._v(" "),t("h3",{attrs:{id:"_4、最新体验版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、最新体验版本"}},[s._v("#")]),s._v(" 4、最新体验版本")]),s._v(" "),t("p",[s._v("如果你热衷于使用最新版本的 webpack，你可以使用以下命令安装 beta 版本， 或者直接从 webpack 的仓库中安装：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack@next\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 或特定的 tag/分支")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack/webpack"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#<tagname/branchname>")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Warning\n安装这些最新体验版本时要小心！它们可能仍然包含 bug，因此不应该用于生产环境。")])]),s._v(" "),t("h2",{attrs:{id:"十一、模块热替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十一、模块热替换"}},[s._v("#")]),s._v(" 十一、模块热替换")]),s._v(" "),t("p",[s._v("模块热替换(hot module replacement 或 HMR)是 webpack 提供的最有用的功能之一。它允许在运行时更新所有类型的模块， 而无需完全刷新。本页面重点介绍其 "),t("strong",[s._v("实现")]),s._v("，而 "),t("a",{attrs:{href:"https://webpack.docschina.org/concepts/hot-module-replacement",target:"_blank",rel:"noopener noreferrer"}},[s._v("概念"),t("OutboundLink")],1),s._v(" 页面提供了更多关于 它的工作原理以及为什么它有用的细节。")]),s._v(" "),t("blockquote",[t("p",[s._v("Warning\n"),t("strong",[s._v("HMR")]),s._v(" 不适用于生产环境，这意味着它应当用于开发环境。更多详细信息， 请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/production",target:"_blank",rel:"noopener noreferrer"}},[s._v("生产环境"),t("OutboundLink")],1),s._v(" 指南。")])]),s._v(" "),t("h3",{attrs:{id:"_1、启用-hmr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、启用-hmr"}},[s._v("#")]),s._v(" 1、启用 HMR")]),s._v(" "),t("p",[s._v("此功能可以很大程度提高生产效率。我们要做的就是更新 "),t("a",{attrs:{href:"https://github.com/webpack/webpack-dev-server",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack-dev-server"),t("OutboundLink")],1),s._v(" 配置， 然后使用 webpack 内置的 HMR 插件。我们还要删除掉 "),t("code",[s._v("print.js")]),s._v(" 的入口起点， 因为现在已经在 "),t("code",[s._v("index.js")]),s._v(" 模块中引用了它。")]),s._v(" "),t("blockquote",[t("p",[s._v("Tip\n如果你在技术选型中使用了 "),t("code",[s._v("webpack-dev-middleware")]),s._v(" 而没有使用 "),t("code",[s._v("webpack-dev-server")]),s._v("，请使用 "),t("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-hot-middleware",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("webpack-hot-middleware")]),t("OutboundLink")],1),s._v(" 依赖包，以在你的自定义服务器或应用程序上启用 HMR。")])]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      app: './src/index.js',\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      print: './src/print.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devtool: 'inline-source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     contentBase: './dist',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     hot: true,\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // new CleanWebpackPlugin(['dist/*']) for < v2 versions of CleanWebpackPlugin\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Hot Module Replacement',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("现在，我们来修改 "),t("code",[s._v("index.js")]),s._v(" 文件，以便当 "),t("code",[s._v("print.js")]),s._v(" 内部发生变更时可以告诉 webpack 接受更新的模块。")]),s._v(" "),t("p",[t("strong",[s._v("index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import printMe from './print.js';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const btn = document.createElement('button');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.innerHTML = 'Click me and check the console!';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.onclick = printMe;\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.appendChild(btn);\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" if (module.hot) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module.hot.accept('./print.js', function() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     console.log('Accepting the updated printMe module!');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     printMe();\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   })\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("p",[s._v("更改 "),t("code",[s._v("print.js")]),s._v(" 中 "),t("code",[s._v("console.log")]),s._v(" 的输出内容，你将会在浏览器中看到如下的输出 （不要担心现在 "),t("code",[s._v("button.onclick = printMe()")]),s._v(" 的输出，我们稍后也会更新该部分）。")]),s._v(" "),t("p",[t("strong",[s._v("print.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" export default function printMe() {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   console.log('I get called from print.js!');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   console.log('Updating print.js...');\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("p",[t("strong",[s._v("console")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("[HMR] Waiting for update signal from WDS...\nmain.js:4395 [WDS] Hot Module Replacement enabled.\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" 2main.js:4395 [WDS] App updated. Recompiling...\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" main.js:4395 [WDS] App hot update...\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" main.js:4330 [HMR] Checking for updates on the server...\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" main.js:10024 Accepting the updated printMe module!\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" 0.4b8ee77….hot-update.js:10 Updating print.js...\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" main.js:4330 [HMR] Updated modules:\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" main.js:4330 [HMR]  - 20\n")])])])])]),t("h3",{attrs:{id:"_2、通过-node-js-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、通过-node-js-api"}},[s._v("#")]),s._v(" 2、通过 Node.js API")]),s._v(" "),t("p",[s._v("在 Node.js API 中使用 webpack dev server 时，不要将 dev server 选项放在 webpack 配置对象中。而是在创建时， 将其作为第二个参数传递。例如：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("new WebpackDevServer(compiler, options)\n")])])]),t("p",[s._v("想要启用 HMR，还需要修改 webpack 配置对象，使其包含 HMR 入口起点。"),t("code",[s._v("webpack-dev-server")]),s._v(" 依赖包中具有一个叫做 "),t("code",[s._v("addDevServerEntrypoints")]),s._v(" 的方法，你可以通过使用这个方法来实现。这是关于如何使用的一个基本示例：")]),s._v(" "),t("p",[t("strong",[s._v("dev-server.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpackDevServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-dev-server'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./webpack.config.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" options "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  contentBase"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  hot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nwebpackDevServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addDevServerEntrypoints")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" compiler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("webpack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("webpackDevServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev server listening on port 8080'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Tip\n如果你正在使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/development#using-webpack-dev-middleware",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("webpack-dev-middleware")]),t("OutboundLink")],1),s._v("，可以通过 "),t("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-hot-middleware",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("webpack-hot-middleware")]),t("OutboundLink")],1),s._v(" 依赖包，在自定义 dev server 中启用 HMR。")])]),s._v(" "),t("h3",{attrs:{id:"_3、问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、问题"}},[s._v("#")]),s._v(" 3、问题")]),s._v(" "),t("p",[s._v("模块热替换可能比较难以掌握。为了说明这一点，我们回到刚才的示例中。如果你继续点击示例页面上的按钮， 你会发现控制台仍在打印旧的 "),t("code",[s._v("printMe")]),s._v(" 函数。")]),s._v(" "),t("p",[s._v("这是因为按钮的 "),t("code",[s._v("onclick")]),s._v(" 事件处理函数仍然绑定在旧的 "),t("code",[s._v("printMe")]),s._v(" 函数上。")]),s._v(" "),t("p",[s._v("为了让 HMR 正常工作，我们需要更新代码，使用 "),t("code",[s._v("module.hot.accept")]),s._v(" 将其绑定到新的 "),t("code",[s._v("printMe")]),s._v(" 函数上：")]),s._v(" "),t("p",[t("strong",[s._v("index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import printMe from './print.js';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const btn = document.createElement('button');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.innerHTML = 'Click me and check the console!';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.onclick = printMe;  // onclick event is bind to the original printMe function\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.appendChild(btn);\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" let element = component(); // 存储 element，以在 print.js 修改时重新渲染\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(element);\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" if (module.hot) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module.hot.accept('./print.js', function() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     console.log('Accepting the updated printMe module!');\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     printMe();\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     document.body.removeChild(element);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     element = component(); // 重新渲染 "component"，以便更新 click 事件处理函数\n')]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     document.body.appendChild(element);\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("h3",{attrs:{id:"_4、hmr-加载样式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、hmr-加载样式"}},[s._v("#")]),s._v(" 4、HMR 加载样式")]),s._v(" "),t("p",[s._v("借助于 "),t("code",[s._v("style-loader")]),s._v("，使用模块热替换来加载 CSS 实际上极其简单。此 loader 在幕后使用了 "),t("code",[s._v("module.hot.accept")]),s._v("，在 CSS 依赖模块更新之后，会将其 patch(修补) 到 "),t("code",[s._v("<style>")]),s._v(" 标签中。")]),s._v(" "),t("p",[s._v("首先使用以下命令安装两个 loader ：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev style-loader css-loader\n")])])]),t("p",[s._v("然后更新配置文件，使用这两个 loader。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     app: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devtool: 'inline-source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     contentBase: './dist',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     hot: true,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: /\\.css$/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: ['style-loader', 'css-loader'],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Hot Module Replacement',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("如同 import 模块，热加载样式表同样很简单：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" | - package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" | - webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" | - /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   | - bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" | - /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   | - index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   | - print.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   | - styles.css\n")])])])])]),t("p",[t("strong",[s._v("styles.css")])]),s._v(" "),t("div",{staticClass:"language-css extra-class"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("body")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("background")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import printMe from './print.js';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import './styles.css';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const btn = document.createElement('button');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.innerHTML = 'Click me and check the console!';\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   btn.onclick = printMe;  // onclick event is bind to the original printMe function\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.appendChild(btn);\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" let element = component();\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(element);\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" if (module.hot) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module.hot.accept('./print.js', function() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     console.log('Accepting the updated printMe module!');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     document.body.removeChild(element);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     element = component(); // Re-render the "component" to update the click handler\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     document.body.appendChild(element);\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("p",[s._v("将 "),t("code",[s._v("body")]),s._v(" 的 style 改为 "),t("code",[s._v("background: red;")]),s._v("，你应该可以立即看到页面的背景颜色随之更改，而无需完全刷新。")]),s._v(" "),t("p",[t("strong",[s._v("styles.css")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" body {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   background: blue;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   background: red;\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("p",[s._v("#十二、Tree Shaking")]),s._v(" "),t("p",[t("em",[s._v("tree shaking")]),s._v(" 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 "),t("a",{attrs:{href:"http://exploringjs.com/es6/ch_modules.html#static-module-structure",target:"_blank",rel:"noopener noreferrer"}},[s._v("静态结构"),t("OutboundLink")],1),s._v(" 特性，例如 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("import")]),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("export")]),t("OutboundLink")],1),s._v("。这个术语和概念实际上是由 ES2015 模块打包工具 "),t("a",{attrs:{href:"https://github.com/rollup/rollup",target:"_blank",rel:"noopener noreferrer"}},[s._v("rollup"),t("OutboundLink")],1),s._v(" 普及起来的。")]),s._v(" "),t("p",[s._v("webpack 2 正式版本内置支持 ES2015 模块（也叫做 "),t("em",[s._v("harmony modules")]),s._v("）和未使用模块检测能力。新的 webpack 4 正式版本扩展了此检测能力，通过 "),t("code",[s._v("package.json")]),s._v(" 的 "),t("code",[s._v('"sideEffects"')]),s._v(' 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 "pure(纯正 ES2015 模块)"，由此可以安全地删除文件中未使用的部分。')]),s._v(" "),t("h3",{attrs:{id:"_1、添加一个通用模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、添加一个通用模块"}},[s._v("#")]),s._v(" 1、添加一个通用模块")]),s._v(" "),t("p",[s._v("在我们的项目中添加一个新的通用模块文件 "),t("code",[s._v("src/math.js")]),s._v("，并导出两个函数：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.html\n")])]),s._v("|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- math.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[t("strong",[s._v("src/math.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("square")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cube")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("需要将 "),t("code",[s._v("mode")]),s._v(" 配置设置成"),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/mode/#mode-development",target:"_blank",rel:"noopener noreferrer"}},[s._v("development"),t("OutboundLink")],1),s._v("，以确定 bundle 不会被压缩：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" devtool: 'source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   usedExports: true,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("配置完这些后，更新入口脚本，使用其中一个新方法，并且为了简化示例，我们先将 "),t("code",[s._v("lodash")]),s._v(" 删除：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import { cube } from './math.js';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('pre');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // Lodash, now imported by this script\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     'Hello webpack!',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     '5 cubed is equal to ' + cube(5)\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ].join('\\n\\n');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[s._v("注意，我们"),t("strong",[s._v("没有从 "),t("code",[s._v("src/math.js")]),s._v(" 模块中 "),t("code",[s._v("import")]),s._v(" 另外一个 "),t("code",[s._v("square")]),s._v(" 方法")]),s._v("。这个函数就是所谓的“未引用代码(dead code)”，也就是说，应该删除掉未被引用的 "),t("code",[s._v("export")]),s._v("。现在运行 npm script "),t("code",[s._v("npm run build")]),s._v("，并查看输出的 bundle：")]),s._v(" "),t("p",[t("strong",[s._v("dist/bundle.js (around lines 90 - 100)")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 1 */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/***/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __webpack_exports__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __webpack_require__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use strict'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* unused harmony export square */")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* harmony export (immutable) */")]),s._v(" __webpack_exports__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("square")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cube")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("注意，上面的 "),t("code",[s._v("unused harmony export square")]),s._v(" 注释。如果你观察它下面的代码，你会注意到虽然我们没有引用 "),t("code",[s._v("square")]),s._v("，但它仍然被包含在 bundle 中。我们将在下一节解决这个问题。")]),s._v(" "),t("h3",{attrs:{id:"_2、将文件标记为-side-effect-free-无副作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、将文件标记为-side-effect-free-无副作用"}},[s._v("#")]),s._v(" 2、将文件标记为 side-effect-free(无副作用)")]),s._v(" "),t("p",[s._v("在一个纯粹的 ESM 模块世界中，很容易识别出哪些文件有 side effect。然而，我们的项目无法达到这种纯度，所以，此时有必要提示 webpack compiler 哪些代码是“纯粹部分”。")]),s._v(" "),t("p",[s._v("通过 package.json 的 "),t("code",[s._v('"sideEffects"')]),s._v(" 属性，来实现这种方式。")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("如果所有代码都不包含 side effect，我们就可以简单地将该属性标记为 "),t("code",[s._v("false")]),s._v("，来告知 webpack，它可以安全地删除未用到的 export。")]),s._v(" "),t("blockquote",[t("p",[s._v('Tip\n"side effect(副作用)" 的定义是，在导入时会执行特殊行为的代码，而不是仅仅暴露一个 export 或多个 export。举例说明，例如 polyfill，它影响全局作用域，并且通常不提供 export。')])]),s._v(" "),t("p",[s._v("如果你的代码确实有一些副作用，可以改为提供一个数组：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/some-side-effectful-file.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("此数组支持简单的 glob 模式匹配相关文件。其内部使用了 "),t("a",{attrs:{href:"https://github.com/fitzgen/glob-to-regexp",target:"_blank",rel:"noopener noreferrer"}},[s._v("glob-to-regexp"),t("OutboundLink")],1),s._v("（支持："),t("code",[s._v("*")]),s._v("，"),t("code",[s._v("**")]),s._v("，"),t("code",[s._v("{a,b}")]),s._v("，"),t("code",[s._v("[a-z]")]),s._v("）。如果匹配模式为 "),t("code",[s._v("*.css")]),s._v("，且不包含 "),t("code",[s._v("/")]),s._v("，将被视为 "),t("code",[s._v("**/*.css")]),s._v("。")]),s._v(" "),t("blockquote",[t("p",[s._v("Tip\n注意，所有导入文件都会受到 tree shaking 的影响。这意味着，如果在项目中使用类似 "),t("code",[s._v("css-loader")]),s._v(" 并 import 一个 CSS 文件，则需要将其添加到 side effect 列表中，以免在生产模式中无意中将它删除：")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/some-side-effectful-file.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.css"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("最后，还可以在 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/module/#rulesideeffects",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("module.rules")]),s._v(" 配置选项"),t("OutboundLink")],1),s._v(" 中设置 "),t("code",[s._v('"sideEffects"')]),s._v("。")]),s._v(" "),t("p",[t("strong",[s._v("具体操作入下：")])]),s._v(" "),t("ul",[t("li",[s._v("安装依赖")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" webpack-cli webpack-dev-server css-loader style-loader -D\n// 注意webpack-cli 与 webpack-dev-server的版本匹配\n")])])]),t("ul",[t("li",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.html\n")])]),s._v("|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- math.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- some-side-effectful-file.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- style.css\n")])]),s._v("|- /node_modules\n")])])]),t("ul",[t("li",[s._v("src/some-side-effectful-file.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'side effectful'")]),s._v("\n")])])]),t("ul",[t("li",[s._v("src/style.css")])]),s._v(" "),t("div",{staticClass:"language-css extra-class"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("body")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blueviolet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("import { cube } from './math.js'\n\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import Greeting from './some-side-effectful-file'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("import './style.css'\n")])]),s._v("\nfunction component() {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const element = document.createElement('pre')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" element.innerHTML = [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   'Hello webpack!',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   '5 cubed is equal to ' + cube(5)\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" ].join('\\n\\n')\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" return element\n")])]),s._v("}\n\ndocument.body.appendChild(component())\n")])])]),t("ul",[t("li",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path')\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   usedExports: true,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      test: /\\.css$/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("      use: ['style-loader', 'css-loader']\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("    }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   contentBase: path.join(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("};\n")])])]),t("ul",[t("li",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("{\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "private": true,\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "sideEffects": false,\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "test": "echo \\"Error: no test specified\\" && exit 1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "build": "webpack",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "start": "webpack-dev-server"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "css-loader": "^5.0.2",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "style-loader": "^2.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack": "^5.21.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-cli": "3.3.12",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-dev-server": "^3.11.2"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("}\n")])])]),t("ul",[t("li",[s._v("开发环境运行项目")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm run build\n")])])]),t("p",[s._v("结果发现，"),t("code",[s._v("style.css")]),s._v("和"),t("code",[s._v("some-side-effectful-file.js")]),s._v("都被打包了。")]),s._v(" "),t("ul",[t("li",[s._v("生产环境运行项目")])]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path')\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'development',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" mode: 'production',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   index: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" optimization: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   usedExports: true,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.css$/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       use: ['style-loader', 'css-loader']\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   contentBase: path.join(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("};\n")])])]),t("p",[s._v("结果发现，"),t("code",[s._v("style.css")]),s._v("和"),t("code",[s._v("some-side-effectful-file.js")]),s._v("不在打包的目标文件了。")]),s._v(" "),t("ul",[t("li",[s._v("修改 "),t("code",[s._v("package.json")])])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("{\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "private": true,\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "sideEffects": false,\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "sideEffects": ["./src/some-side-effectful-file.js", "*.css"],\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "scripts": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "test": "echo \\"Error: no test specified\\" && exit 1",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "build": "webpack",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "start": "webpack-dev-server"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "css-loader": "^5.0.2",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "style-loader": "^2.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack": "^5.21.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-cli": "3.3.12",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-dev-server": "^3.11.2"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("}\n")])])]),t("p",[s._v("#十三、生产环境")]),s._v(" "),t("p",[s._v("在本指南中，我们将深入一些最佳实践和工具，将站点或应用程序构建到生产环境中。")]),s._v(" "),t("h3",{attrs:{id:"_1、配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置"}},[s._v("#")]),s._v(" 1、配置")]),s._v(" "),t("p",[t("strong",[s._v("development(开发环境)")]),s._v(" 和 "),t("strong",[s._v("production(生产环境)")]),s._v(" 这两个环境下的构建目标存在着巨大差异。在"),t("strong",[s._v("开发环境")]),s._v("中，我们需要：强大的 source map 和一个有着 live reloading(实时重新加载) 或 hot module replacement(热模块替换) 能力的 localhost server。而"),t("strong",[s._v("生产环境")]),s._v("目标则转移至其他方面，关注点在于压缩 bundle、更轻量的 source map、资源优化等，通过这些优化方式改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写"),t("strong",[s._v("彼此独立的 webpack 配置")]),s._v("。")]),s._v(" "),t("p",[s._v("虽然，以上我们将 "),t("em",[s._v("生产环境")]),s._v(" 和 "),t("em",[s._v("开发环境")]),s._v(' 做了细微区分，但是，请注意，我们还是会遵循不重复原则(Don\'t repeat yourself - DRY)，保留一个 "common(通用)" 配置。为了将这些配置合并在一起，我们将使用一个名为 '),t("a",{attrs:{href:"https://github.com/survivejs/webpack-merge",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("webpack-merge")]),t("OutboundLink")],1),s._v(' 的工具。此工具会引用 "common" 配置，因此我们不必再在环境特定(environment-specific)的配置中编写重复代码。')]),s._v(" "),t("p",[s._v("我们先从安装 "),t("code",[s._v("webpack-merge")]),s._v(" 开始，并将之前指南中已经成型的那些代码进行分离：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev webpack-merge\n")])])]),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.common.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.dev.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.prod.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- math.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("webpack.common.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const HtmlWebpackPlugin = require('html-webpack-plugin');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     app: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     // 对于 CleanWebpackPlugin 的 v2 versions 以下版本，使用 new CleanWebpackPlugin(['dist/*'])\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new CleanWebpackPlugin(),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new HtmlWebpackPlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       title: 'Production',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[t("strong",[s._v("webpack.dev.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { merge } = require('webpack-merge');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const common = require('./webpack.common.js');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = merge(common, {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   mode: 'development',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devtool: 'inline-source-map',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devServer: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     contentBase: './dist',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" });\n")])])])])]),t("p",[t("strong",[s._v("webpack.prod.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const { merge } = require('webpack-merge');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const common = require('./webpack.common.js');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = merge(common, {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   mode: 'production',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" });\n")])])])])]),t("p",[s._v("现在，在 "),t("code",[s._v("webpack.common.js")]),s._v(" 中，我们设置了 "),t("code",[s._v("entry")]),s._v(" 和 "),t("code",[s._v("output")]),s._v(" 配置，并且在其中引入这两个环境公用的全部插件。在 "),t("code",[s._v("webpack.dev.js")]),s._v(" 中，我们将 "),t("code",[s._v("mode")]),s._v(" 设置为 "),t("code",[s._v("development")]),s._v("，并且为此环境添加了推荐的 "),t("code",[s._v("devtool")]),s._v("（强大的 source map）和简单的 "),t("code",[s._v("devServer")]),s._v(" 配置。最后，在 "),t("code",[s._v("webpack.prod.js")]),s._v(" 中，我们将 "),t("code",[s._v("mode")]),s._v(" 设置为 "),t("code",[s._v("production")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_2、npm-scripts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、npm-scripts"}},[s._v("#")]),s._v(" 2、NPM Scripts")]),s._v(" "),t("p",[s._v("现在，我们把 "),t("code",[s._v("scripts")]),s._v(" 重新指向到新配置。让 "),t("code",[s._v("npm start")]),s._v(" script 中 "),t("code",[s._v("webpack-dev-server")]),s._v(", 使用 "),t("code",[s._v("webpack.dev.js")]),s._v(", 而让 "),t("code",[s._v("npm run build")]),s._v(" script 使用 "),t("code",[s._v("webpack.prod.js")]),s._v(":")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("{\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "name": "webpack-demo",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "version": "1.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "description": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "private": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "sideEffects": [\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "./src/some-side-effectful-file.js",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "*.css"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "scripts": {\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "start": "webpack serve --open",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "start": "webpack serve --open --config webpack.dev.js",\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack"\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('    "build": "webpack --config webpack.prod.js"\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "keywords": [],\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "author": "",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "license": "ISC",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(' "devDependencies": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "clean-webpack-plugin": "^3.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "css-loader": "^5.0.2",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "html-webpack-plugin": "^5.1.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "style-loader": "^2.0.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack": "^5.21.0",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-cli": "3.3.12",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-dev-server": "^3.11.2",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "webpack-merge": "^5.7.3"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("}\n")])])]),t("p",[s._v("随便运行下这些脚本，然后查看输出结果的变化，然后我们会继续添加一些_生产环境_配置。")]),s._v(" "),t("h2",{attrs:{id:"十四、依赖管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十四、依赖管理"}},[s._v("#")]),s._v(" 十四、依赖管理")]),s._v(" "),t("blockquote",[t("p",[s._v("es6 modules")])]),s._v(" "),t("blockquote",[t("p",[s._v("commonjs")])]),s._v(" "),t("blockquote",[t("p",[s._v("amd")])]),s._v(" "),t("h3",{attrs:{id:"_1、带表达式的-require-语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、带表达式的-require-语句"}},[s._v("#")]),s._v(" 1、带表达式的 require 语句")]),s._v(" "),t("p",[s._v("如果你的 request 含有表达式(expressions)，就会创建一个上下文(context)，因为在编译时(compile time)并不清楚 "),t("strong",[s._v("具体")]),s._v(" 导入哪个模块。")]),s._v(" "),t("p",[s._v("示例，考虑到我们有包含 "),t("code",[s._v(".ejs")]),s._v(" 文件的如下目录结构：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("example_directory\n│\n└───template\n│   │   table.ejs\n│   │   table-row.ejs\n│   │\n│   └───directory\n│       │   another.ejs\n")])])]),t("p",[s._v("当下面的 "),t("code",[s._v("require()")]),s._v(" 调用被解析：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./template/'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.ejs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("webpack 解析 "),t("code",[s._v("require()")]),s._v(" 调用，然后提取出如下一些信息：")]),s._v(" "),t("div",{staticClass:"language-code extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Directory: ./template\nRegular expression: /^.*\\.ejs$/\n")])])]),t("p",[t("strong",[s._v("context module")])]),s._v(" "),t("p",[s._v("会生成一个 context module(上下文模块)。它包含 "),t("strong",[s._v("目录下的所有模块")]),s._v(" 的引用，如果一个 request 符合正则表达式，就能 require 进来。该context module包含一个map（映射）对象，会把requests翻译成对应的模块id。（request参考"),t("a",{attrs:{href:"https://webpack.docschina.org/glossary/",target:"_blank",rel:"noopener noreferrer"}},[s._v("概念术语"),t("OutboundLink")],1),s._v(" ）")]),s._v(" "),t("p",[s._v("示例map（映射）:")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"./table.ejs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"./table-row.ejs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"./directory/another.ejs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("此 context module 还包含一些访问这个 map 对象的 runtime 逻辑。")]),s._v(" "),t("p",[s._v("这意味着 webpack 能够支持动态地 require，但会导致所有可能用到的模块都包含在 bundle 中。")]),s._v(" "),t("h3",{attrs:{id:"_2、require-context"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、require-context"}},[s._v("#")]),s._v(" 2、"),t("code",[s._v("require.context")])]),s._v(" "),t("p",[s._v("你还可以通过 "),t("code",[s._v("require.context()")]),s._v(" 函数来创建自己的 context。")]),s._v(" "),t("p",[s._v("可以给这个函数传入三个参数：一个要搜索的目录，一个标记表示是否还搜索其子目录， 以及一个匹配文件的正则表达式。")]),s._v(" "),t("p",[s._v("webpack 会在构建中解析代码中的 "),t("code",[s._v("require.context()")]),s._v(" 。")]),s._v(" "),t("p",[s._v("语法如下：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("directory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" useSubdirectories "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" regExp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("^\\.\\/.*$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sync'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./test'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.test\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//（创建出）一个 context，其中文件来自 test 目录，request 以 `.test.js` 结尾。")]),s._v("\nrequire"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.stories\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// （创建出）一个 context，其中所有文件都来自父文件夹及其所有子级文件夹，request 以 `.stories.js` 结尾。")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Warning\n传递给 "),t("code",[s._v("require.context")]),s._v(" 的参数必须是字面量(literal)！")])]),s._v(" "),t("h4",{attrs:{id:"_1-context-module-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-context-module-api"}},[s._v("#")]),s._v(" (1) context module API")]),s._v(" "),t("p",[s._v("一个 context module 会导出一个（require）函数，此函数可以接收一个参数：request。")]),s._v(" "),t("p",[s._v("此导出函数有三个属性："),t("code",[s._v("resolve")]),s._v(", "),t("code",[s._v("keys")]),s._v(", "),t("code",[s._v("id")]),s._v("。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("resolve")]),s._v(" 是一个函数，它返回 request 被解析后得到的模块 id。")]),s._v(" "),t("li",[t("code",[s._v("keys")]),s._v(" 也是一个函数，它返回一个数组，由所有可能被此 context module 处理的请求（参考下面第二段代码中的 key）组成。")])]),s._v(" "),t("p",[s._v("如果想引入一个文件夹下面的所有文件，或者引入能匹配一个正则表达式的所有文件，这个功能就会很有帮助，例如：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("importAll")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("r")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("keys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("importAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../components/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("importAll")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("r")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("keys")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("r")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("importAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../components/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在构建时(build-time)，所有被 require 的模块都会被填充到 cache 对象中。")]),s._v("\n")])])]),t("ul",[t("li",[t("code",[s._v("id")]),s._v(" 是 context module 的模块 id. 它可能在你使用 "),t("code",[s._v("module.hot.accept")]),s._v(" 时会用到。")])]),s._v(" "),t("h2",{attrs:{id:"十五、公共路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十五、公共路径"}},[s._v("#")]),s._v(" 十五、公共路径")]),s._v(" "),t("p",[t("code",[s._v("publicPath")]),s._v(" 配置选项在各种场景中都非常有用。你可以通过它来指定应用程序中所有资源的基础路径。")]),s._v(" "),t("h3",{attrs:{id:"_1、示例-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、示例-2"}},[s._v("#")]),s._v(" 1、示例")]),s._v(" "),t("p",[s._v("下面提供一些用于实际应用程序的示例，通过这些示例，此功能显得极其简单。实质上，发送到 "),t("code",[s._v("output.path")]),s._v(" 目录的每个文件，都将从 "),t("code",[s._v("output.publicPath")]),s._v(" 位置引用。这也包括（通过 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/code-splitting/",target:"_blank",rel:"noopener noreferrer"}},[s._v("代码分离"),t("OutboundLink")],1),s._v(" 创建的）子 chunk 和作为依赖图一部分的所有其他资源（例如 image, font 等）。")]),s._v(" "),t("h4",{attrs:{id:"_1-基于环境设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-基于环境设置"}},[s._v("#")]),s._v(" (1) 基于环境设置")]),s._v(" "),t("p",[s._v("在开发环境中，我们通常有一个 "),t("code",[s._v("assets/")]),s._v(" 文件夹，它与索引页面位于同一级别。这没太大问题，但是，如果我们将所有静态资源托管至 CDN，然后想在生产环境中使用呢？")]),s._v(" "),t("p",[s._v("想要解决这个问题，可以直接使用一个有着悠久历史的 environment variable(环境变量)。假设我们有一个变量 "),t("code",[s._v("ASSET_PATH")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" webpack "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 尝试使用环境变量，否则使用根路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASSET_PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASSET_PATH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    publicPath"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n  plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这可以帮助我们在代码中安全地使用环境变量")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DefinePlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'process.env.ASSET_PATH'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_2-在运行时设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在运行时设置"}},[s._v("#")]),s._v(" (2) 在运行时设置")]),s._v(" "),t("p",[s._v("另一个可能出现的情况是，需要在运行时设置 "),t("code",[s._v("publicPath")]),s._v("。webpack 暴露了一个名为 "),t("code",[s._v("__webpack_public_path__")]),s._v(" 的全局变量。所以在应用程序的 entry point 中，可以直接如下设置：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("__webpack_public_path__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ASSET_PATH")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("这些内容就是你所需要的。由于我们已经在配置中使用了 "),t("code",[s._v("DefinePlugin")]),s._v("， "),t("code",[s._v("process.env.ASSET_PATH")]),s._v(" 将始终都被定义， 因此我们可以安全地使用。")]),s._v(" "),t("blockquote",[t("p",[s._v("Warning\n注意，如果在 entry 文件中使用 ES2015 module import，则会在 import 之后进行 "),t("code",[s._v("__webpack_public_path__")]),s._v(" 赋值。在这种情况下，你必须将 public path 赋值移至一个专用模块中，然后将它的 import 语句放置到 entry.js 最上面：")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// entry.js")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./public-path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./app'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Tip\n当使用 "),t("code",[s._v("web")]),s._v(" 或者 "),t("code",[s._v("web-worker")]),s._v(" 时，"),t("code",[s._v("publicPath")]),s._v(" 默认为 "),t("code",[s._v("'auto'")]),s._v("，将会自动从 "),t("code",[s._v("import.meta.url")]),s._v("、"),t("code",[s._v("document.currentScript")]),s._v("、"),t("code",[s._v("<script />")]),s._v(" 或者 "),t("code",[s._v("self.location")]),s._v(" 中确定公共路径。")])]),s._v(" "),t("h2",{attrs:{id:"十六、shimming-预置依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十六、shimming-预置依赖"}},[s._v("#")]),s._v(" 十六、Shimming 预置依赖")]),s._v(" "),t("p",[t("code",[s._v("webpack")]),s._v(" 编译器(compiler)能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些第三方的库(library)可能会引用一些全局依赖（例如 "),t("code",[s._v("jQuery")]),s._v(" 中的 "),t("code",[s._v("$")]),s._v("）。这些库也可能创建一些需要被导出的全局变量。这些“不符合规范的模块”就是 "),t("em",[s._v("shimming")]),s._v(" 发挥作用的地方。")]),s._v(" "),t("blockquote",[t("p",[s._v("**我们不推荐使用全局的东西！**在 webpack 背后的整个概念是让前端开发更加模块化。也就是说，需要编写具有良好的封闭性(well contained)、彼此隔离的模块，以及不要依赖于那些隐含的依赖模块（例如，全局变量）。请只在必要的时候才使用本文所述的这些特性。")])]),s._v(" "),t("p",[t("em",[s._v("shimming")]),s._v(" 另外一个使用场景就是，当你希望 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Polyfill",target:"_blank",rel:"noopener noreferrer"}},[s._v("polyfill"),t("OutboundLink")],1),s._v(" 浏览器功能以支持更多用户时。在这种情况下，你可能只想要将这些 polyfills 提供给到需要修补(patch)的浏览器（也就是实现按需加载）。")]),s._v(" "),t("p",[s._v("下面的文章将向我们展示这两种用例。")]),s._v(" "),t("h3",{attrs:{id:"_1、shimming-全局变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、shimming-全局变量"}},[s._v("#")]),s._v(" 1、shimming 全局变量")]),s._v(" "),t("p",[s._v("让我们开始第一个 shimming 全局变量的用例。在此之前，我们先看看我们的项目：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),s._v("|- /node_modules\n")])])]),t("p",[s._v("还记得我们之前用过的 "),t("code",[s._v("lodash")]),s._v(" 吗？出于演示的目的，让我们把这个模块作为我们应用程序中的一个全局变量。要实现这些，我们需要使用 "),t("code",[s._v("ProvidePlugin")]),s._v(" 插件。")]),s._v(" "),t("p",[s._v("使用 "),t("a",{attrs:{href:"https://www.webpackjs.com/plugins/provide-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ProvidePlugin")]),t("OutboundLink")],1),s._v(" 后，能够在通过 webpack 编译的每个模块中，通过访问一个变量来获取到 package 包。如果 webpack 知道这个变量在某个模块中被使用了，那么 webpack 将在最终 bundle 中引入我们给定的 package。让我们先移除 "),t("code",[s._v("lodash")]),s._v(" 的 "),t("code",[s._v("import")]),s._v(" 语句，并通过插件提供它：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // Lodash, now imported by this script\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const webpack = require('webpack');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist')\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   }\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new webpack.ProvidePlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       _: 'lodash'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     })\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("本质上，我们所做的，就是告诉 webpack……")]),s._v(" "),t("blockquote",[t("p",[s._v("如果你遇到了至少一处用到 "),t("code",[s._v("lodash")]),s._v(" 变量的模块实例，那请你将 "),t("code",[s._v("lodash")]),s._v(" package 包引入进来，并将其提供给需要用到它的模块。")])]),s._v(" "),t("p",[s._v("如果我们 run build，将会看到同样的输出：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Hash: f450fa59fa951c68c416\nVersion: webpack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(".0\nTime: 343ms\n    Asset    Size  Chunks                    Chunk Names\nbundle.js  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("544")]),s._v(" kB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("big"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  main\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ./~/lodash/lodash.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("540")]),s._v(" kB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/buildin/global.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("509")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/buildin/module.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("517")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ./src/index.js "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("189")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("built"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("我们还可以使用 "),t("code",[s._v("ProvidePlugin")]),s._v(" 暴露某个模块中单个导出值，只需通过一个“数组路径”进行配置（例如 "),t("code",[s._v("[module, child, ...children?]")]),s._v("）。所以，让我们做如下设想，无论 "),t("code",[s._v("join")]),s._v(" 方法在何处调用，我们都只会得到的是 "),t("code",[s._v("lodash")]),s._v(" 中提供的 "),t("code",[s._v("join")]),s._v(" 方法。")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const webpack = require('webpack');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new webpack.ProvidePlugin({\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       _: 'lodash'\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       join: ['lodash', 'join']\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("这样就能很好的与 "),t("a",{attrs:{href:"https://www.webpackjs.com/guides/tree-shaking",target:"_blank",rel:"noopener noreferrer"}},[s._v("tree shaking"),t("OutboundLink")],1),s._v(" 配合，将 "),t("code",[s._v("lodash")]),s._v(" 库中的其他没用到的部分去除。")]),s._v(" "),t("h3",{attrs:{id:"_2、细粒度-shimming"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、细粒度-shimming"}},[s._v("#")]),s._v(" 2、细粒度 shimming")]),s._v(" "),t("p",[s._v("一些传统的模块依赖的 "),t("code",[s._v("this")]),s._v(" 指向的是 "),t("code",[s._v("window")]),s._v(" 对象。在接下来的用例中，调整我们的 "),t("code",[s._v("index.js")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = join(['Hello', 'webpack'], ' ');\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // Assume we are in the context of `window`\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   this.alert('Hmmm, this probably isn\\'t a great idea...')\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[s._v("当模块运行在 CommonJS 环境下这将会变成一个问题，也就是说此时的 "),t("code",[s._v("this")]),s._v(" 指向的是 "),t("code",[s._v("module.exports")]),s._v("。在这个例子中，你可以通过使用 "),t("a",{attrs:{href:"https://www.webpackjs.com/loaders/imports-loader/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("imports-loader")]),t("OutboundLink")],1),s._v(" 覆写 "),t("code",[s._v("this")]),s._v("：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const webpack = require('webpack');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: require.resolve('index.js'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'imports-loader?this=>window'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new webpack.ProvidePlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       join: ['lodash', 'join']\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("h3",{attrs:{id:"_3、全局-exports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、全局-exports"}},[s._v("#")]),s._v(" 3、全局 exports")]),s._v(" "),t("p",[s._v("让我们假设，某个库(library)创建出一个全局变量，它期望用户使用这个变量。为此，我们可以在项目配置中，添加一个小模块来演示说明：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- globals.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("src/globals.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'blah.txt'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" helpers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test something'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("parse")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'parse something'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("你可能从来没有在自己的源码中做过这些事情，但是你也许遇到过一个老旧的库(library)，和上面所展示的代码类似。在这个用例中，我们可以使用 "),t("a",{attrs:{href:"https://www.webpackjs.com/loaders/exports-loader/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("exports-loader")]),t("OutboundLink")],1),s._v("，将一个全局变量作为一个普通的模块来导出。例如，为了将 "),t("code",[s._v("file")]),s._v(" 导出为 "),t("code",[s._v("file")]),s._v(" 以及将 "),t("code",[s._v("helpers.parse")]),s._v(" 导出为 "),t("code",[s._v("parse")]),s._v("，做如下调整：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const webpack = require('webpack');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: require.resolve('index.js'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'imports-loader?this=>window'\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: require.resolve('globals.js'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'exports-loader?file,parse=helpers.parse'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new webpack.ProvidePlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       join: ['lodash', 'join']\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("现在从我们的 entry 入口文件中(即 "),t("code",[s._v("src/index.js")]),s._v(")，我们能 "),t("code",[s._v("import { file, parse } from './globals.js';")]),s._v(" ，然后一切将顺利进行。")]),s._v(" "),t("h3",{attrs:{id:"_4、加载-polyfills"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、加载-polyfills"}},[s._v("#")]),s._v(" 4、加载 polyfills")]),s._v(" "),t("p",[s._v("目前为止我们所讨论的所有内容都是处理那些遗留的 package 包，让我们进入到下一个话题："),t("strong",[s._v("polyfills")]),s._v("。")]),s._v(" "),t("p",[s._v("有很多方法来载入 polyfills。例如，要引入 "),t("a",{attrs:{href:"https://babeljs.io/docs/usage/polyfill/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("babel-polyfill")]),t("OutboundLink")],1),s._v(" 我们只需要如下操作：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save babel-polyfill\n")])])]),t("p",[s._v("然后使用 "),t("code",[s._v("import")]),s._v(" 将其添加到我们的主 bundle 文件：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import 'babel-polyfill';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("blockquote",[t("p",[s._v("请注意，我们没有将 "),t("code",[s._v("import")]),s._v(" 绑定到变量。这是因为只需在基础代码(code base)之外，再额外执行 polyfills，这样我们就可以假定代码中已经具有某些原生功能。")])]),s._v(" "),t("p",[s._v("polyfills 虽然是一种模块引入方式，但是"),t("strong",[s._v("并不推荐在主 bundle 中引入 polyfills")]),s._v("，因为这不利于具备这些模块功能的现代浏览器用户，会使他们下载体积很大、但却不需要的脚本文件。")]),s._v(" "),t("p",[s._v("让我们把 "),t("code",[s._v("import")]),s._v(" 放入一个新文件，并加入 "),t("a",{attrs:{href:"https://github.com/github/fetch",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("whatwg-fetch")]),t("OutboundLink")],1),s._v(" polyfill：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save whatwg-fetch\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import 'babel-polyfill';\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- globals.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- polyfills.js\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("src/polyfills.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'babel-polyfill'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'whatwg-fetch'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const webpack = require('webpack');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     polyfills: './src/polyfills.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     index: './src/index.js'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: '[name].bundle.js',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: require.resolve('index.js'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'imports-loader?this=>window'\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: require.resolve('globals.js'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'exports-loader?file,parse=helpers.parse'\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   plugins: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     new webpack.ProvidePlugin({\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       join: ['lodash', 'join']\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     })\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("如此之后，我们可以在代码中添加一些逻辑，根据条件去加载新的 "),t("code",[s._v("polyfills.bundle.js")]),s._v(" 文件。你该如何决定，依赖于那些需要支持的技术以及浏览器。我们将做一些简单的试验，来确定是否需要引入这些 polyfills：")]),s._v(" "),t("p",[t("strong",[s._v("dist/index.html")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" <!doctype html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" <html>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   <head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     <title>Getting Started</title>\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     <script>\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       var modernBrowser = (\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         'fetch' in window &&\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         'assign' in Object\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       );\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       if ( !modernBrowser ) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         var scriptElement = document.createElement('script');\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         scriptElement.async = false;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         scriptElement.src = '/polyfills.bundle.js';\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         document.head.appendChild(scriptElement);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     <\/script>\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   </head>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   <body>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     <script src="index.bundle.js"><\/script>\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   </body>\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" </html>\n")])])])])]),t("p",[s._v("现在，我们能在 entry 入口文件中，通过 "),t("code",[s._v("fetch")]),s._v(" 获取一些数据：")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" fetch('https://jsonplaceholder.typicode.com/users')\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   .then(response => response.json())\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   .then(json => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     console.log('We retrieved some data! AND we\\'re confident it will work on a variety of browser distributions.')\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     console.log(json)\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   })\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   .catch(error => console.error('Something went wrong when fetching this data: ', error))\n")])])])])]),t("p",[s._v("当我们开始执行构建时，"),t("code",[s._v("polyfills.bundle.js")]),s._v(" 文件将会被载入到浏览器中，然后所有代码将正确无误的在浏览器中执行。请注意，以上的这些设定可能还会有所改进，我们只是对于如何解决「将 polyfills 提供给那些需要引入它的用户」这个问题，向你提供一个很棒的想法。")]),s._v(" "),t("p",[s._v("##5、 babel7.4 中 @babel/preset-env 的使用")]),s._v(" "),t("p",[t("strong",[s._v("core-js介绍")])]),s._v(" "),t("p",[s._v("其实core-js是我们能够使用新的API的最重要的包，然而一般情况它隐藏在webpack编译后的代码中，我们一般不会去查看，所以容易被遗忘，我们在webpack生成环境下，查看编译后的代码，可以看到例如includes就是从core-js导出到我们的代码去的。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.ax1x.com/2019/10/07/uR9QE9.png",alt:"img"}})]),s._v(" "),t("p",[t("strong",[s._v("core-js是什么")])]),s._v(" "),t("ul",[t("li",[s._v("它是JavaScript标准库的polyfill")]),s._v(" "),t("li",[s._v("它尽可能的进行模块化，让你能选择你需要的功能")]),s._v(" "),t("li",[s._v("它可以不污染全局空间")]),s._v(" "),t("li",[s._v("它和babel高度集成，可以对core-js的引入进行最大程度的优化")])]),s._v(" "),t("p",[t("strong",[s._v("升级core-js@3动机")])]),s._v(" "),t("p",[s._v("目前我们使用的都默认是core-js@2，它在 2018年 之前就封锁了分支，至此之后的特性都只会添加到core-js@3，这里有一个生产例子，使用了core-js@2不支持的新特性，导致错误")]),s._v(" "),t("ul",[t("li",[s._v("core-js@2出现的问题")]),s._v(" "),t("li",[s._v("Vue-cli使用flat报错")]),s._v(" "),t("li",[s._v("vue-cli也会在V4升级core-js")]),s._v(" "),t("li",[s._v("Roadmap for Vue-cli4")]),s._v(" "),t("li",[s._v("core-js@3添加的特性")])]),s._v(" "),t("p",[t("strong",[s._v("core-js@3 特性概览")])]),s._v(" "),t("ul",[t("li",[s._v("支持ECMAScript稳定功能，引入core-js@3冻结期间的新功能，比如flat")]),s._v(" "),t("li",[s._v("加入到ES2016-ES2019中的提案，现在已经被标记为稳定功能")]),s._v(" "),t("li",[s._v("更新了提案的实现，增加了proposals配置项，由于提案阶段不稳定，需要谨慎使用")]),s._v(" "),t("li",[s._v("增加了对一些web标准的支持，比如URL 和 URLSearchParams")]),s._v(" "),t("li",[s._v("现在支持原型方法，同时不污染原型")]),s._v(" "),t("li",[s._v("删除了过时的特性")])]),s._v(" "),t("p",[t("strong",[s._v("core-js@3 与 babel")])]),s._v(" "),t("p",[s._v("以前我们实现API的时候，会引入整个polyfill,其实polyfill只是包括了以下两个包")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("core-js\nregenerator-runtime\n")])])]),t("p",[s._v("core-js@3 升级之后弃用了@babel/polyfill，以下是等价实现")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// babel.config.js")]),s._v("\npresets"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/preset-env"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    useBuiltIns"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"entry"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// or "usage"，见如下说明')]),s._v("\n    corejs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 如果 useBuiltIns: "entry" 需要在打包入口文件导入两个包：')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"core-js/stable"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"regenerator-runtime/runtime"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 如果 useBuiltIns: "usage"，不需要在入口文件里导入包了')]),s._v("\n")])])]),t("p",[s._v("##6、什么是Browserslist")]),s._v(" "),t("p",[s._v("关于"),t("strong",[s._v("preset-env")]),s._v("，我们还可以提供一个"),t("code",[s._v("targets")]),s._v("配置项指定运行环境，就是我们可以配置对应目标浏览器环境，那么"),t("strong",[s._v("babel")]),s._v("就会编译出对应目标浏览器环境可以运行的代码。相信有同学遇到过在低版本系统ios手机里自己的项目会白屏，其实是某些语法在ios低版本系统里不支持，这个时候我们可以直接配置ios 7浏览器环境都可以支持的代码：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("Copy"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* babel.config.js */")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  presets"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/preset-env"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'targets'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'browsers'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ie >= 8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'iOS 7'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 支持ie8，直接使用iOS浏览器版本7")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("当然"),t("strong",[s._v("babel")]),s._v("的"),t("strong",[s._v("Browserslist")]),s._v("集成还支持在"),t("strong",[s._v("package.json")]),s._v("文件里或者新建一个 "),t("strong",[s._v(".browserslistrc")]),s._v(" 文件来指定对应目标环境。")]),s._v(" "),t("p",[s._v("在开始WEB前端开发之前，开发者必须要明确目标环境。例如：")]),s._v(" "),t("ul",[t("li",[s._v("IE 9 +")]),s._v(" "),t("li",[s._v("Edge")]),s._v(" "),t("li",[s._v("Firefox 60 +")]),s._v(" "),t("li",[s._v("Chrome 60 +")])]),s._v(" "),t("h4",{attrs:{id:"_1-作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-作用"}},[s._v("#")]),s._v(" (1) 作用")]),s._v(" "),t("p",[s._v("Browserslist用于配置目标环境。")]),s._v(" "),t("h4",{attrs:{id:"_2-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[s._v("#")]),s._v(" "),t("strong",[s._v("(2) 安装")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install --save-dev browserslist\n")])])]),t("h4",{attrs:{id:"_3-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[s._v("#")]),s._v(" (3) 配置")]),s._v(" "),t("p",[s._v("Browserslist的配置可以直接写在"),t("code",[s._v("package.json")]),s._v("的"),t("code",[s._v("browserslist")]),s._v("字段里（推荐），也可以写成名为"),t("code",[s._v(".browserslistrc")]),s._v("的配置文件，但二者不能同时使用。")]),s._v(" "),t("p",[t("strong",[s._v("package.json")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> 1%", "last 2 versions"]\n}\n')])])]),t("p",[t("strong",[s._v(".browserslistrc")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("> 1%\nlast 2 versions\n")])])]),t("h4",{attrs:{id:"_4-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试"}},[s._v("#")]),s._v(" (4) 测试")]),s._v(" "),t("p",[s._v("在控制台执行下面的命令会输出当前的目标环境。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npx browserslist\n")])])]),t("h4",{attrs:{id:"_5-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-语法"}},[s._v("#")]),s._v(" (5) 语法")]),s._v(" "),t("p",[s._v("注意：大小写不敏感。")]),s._v(" "),t("p",[t("strong",[s._v("无配置")])]),s._v(" "),t("p",[s._v("当"),t("code",[s._v("package.json")]),s._v("中不存在"),t("code",[s._v("browserslist")]),s._v("字段且"),t("code",[s._v(".browserslistrc")]),s._v("也不存在时，相当于")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["defaults"]\n}\n')])])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("defaults\n")])])]),t("p",[t("strong",[s._v("有配置但为空")])]),s._v(" "),t("p",[s._v("空")]),s._v(" "),t("p",[t("strong",[s._v("浏览器名称 + 版本号")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["ie 10"]\n}\n')])])]),t("p",[t("strong",[s._v("浏览器名称 + 版本号范围")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["ie > 8"]\n}\n{\n  "browserslist": ["ie 10-11"]\n}\n')])])]),t("p",[t("strong",[s._v("浏览器版本的市场份额")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> 1%"]\n}\n')])])]),t("p",[t("strong",[s._v("浏览器版本的市场份额 + 地区")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> 1% in CN"]\n}\n')])])]),t("h4",{attrs:{id:"_6-逻辑运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-逻辑运算"}},[s._v("#")]),s._v(" (6) 逻辑运算")]),s._v(" "),t("p",[t("strong",[s._v("或运算")])]),s._v(" "),t("p",[t("code",[s._v(",")]),s._v("和"),t("code",[s._v("or")]),s._v("表示或运算（并集）")]),s._v(" "),t("p",[s._v("示例：“市场份额超过"),t("code",[s._v("1%")]),s._v("的浏览器版本”和“每种浏览器的最新"),t("code",[s._v("2")]),s._v("个版本”的并集。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> 1%, last 2 versions"]\n}\n{\n  "browserslist": ["> 1% or last 2 versions"]\n}\n{\n  "browserslist": ["> 1%", "last 2 versions"]\n}\n')])])]),t("p",[t("strong",[s._v("与运算")])]),s._v(" "),t("p",[t("code",[s._v("and")]),s._v("表示与运算（交集）")]),s._v(" "),t("p",[s._v("示例：“市场份额超过"),t("code",[s._v("1%")]),s._v("的浏览器版本”和“每种浏览器的最新"),t("code",[s._v("2")]),s._v("个版本”的交集。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> 1% and last 2 versions"]\n}\n')])])]),t("p",[t("strong",[s._v("非运算")])]),s._v(" "),t("p",[t("code",[s._v("not")]),s._v("表示非运算（补集）")]),s._v(" "),t("p",[s._v("注意："),t("code",[s._v("not")]),s._v("不能作为第一个条件。")]),s._v(" "),t("p",[s._v("示例：“市场份额超过"),t("code",[s._v("0.5%")]),s._v("的浏览器版本”和“每种浏览器的最新"),t("code",[s._v("2")]),s._v("个版本”的差集")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "browserslist": ["> .5% and not last 2 versions"]\n}\n{\n  "browserslist": ["> .5% or not last 2 versions"]\n}\n{\n  "browserslist": ["> .5%, not last 2 versions"]\n}\n{\n  "browserslist": ["> .5%", "not last 2 versions"]\n}\n')])])]),t("p",[t("a",{attrs:{href:"https://github.com/browserslist/browserslist#queries",target:"_blank",rel:"noopener noreferrer"}},[s._v("browserslist配置源"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"十七、资源模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十七、资源模块"}},[s._v("#")]),s._v(" 十七、资源模块")]),s._v(" "),t("p",[s._v("资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。")]),s._v(" "),t("p",[s._v("在 webpack 5 之前，通常使用：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://webpack.docschina.org/loaders/raw-loader/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("raw-loader")]),t("OutboundLink")],1),s._v(" 将文件导入为字符串")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://webpack.docschina.org/loaders/url-loader/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("url-loader")]),t("OutboundLink")],1),s._v(" 将文件作为 data URI 内联到 bundle 中")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://webpack.docschina.org/loaders/file-loader/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("file-loader")]),t("OutboundLink")],1),s._v(" 将文件发送到输出目录")])]),s._v(" "),t("p",[s._v("资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("asset/resource")]),s._v(" 发送一个单独的文件并导出 URL。之前通过使用 "),t("code",[s._v("file-loader")]),s._v(" 实现。")]),s._v(" "),t("li",[t("code",[s._v("asset/inline")]),s._v(" 导出一个资源的 data URI。之前通过使用 "),t("code",[s._v("url-loader")]),s._v(" 实现。")]),s._v(" "),t("li",[t("code",[s._v("asset/source")]),s._v(" 导出资源的源代码。之前通过使用 "),t("code",[s._v("raw-loader")]),s._v(" 实现。")]),s._v(" "),t("li",[t("code",[s._v("asset")]),s._v(" 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 "),t("code",[s._v("url-loader")]),s._v("，并且配置资源体积限制实现。")])]),s._v(" "),t("p",[s._v("当在 webpack 5 中使用旧的 assets loader（如 "),t("code",[s._v("file-loader")]),s._v("/"),t("code",[s._v("url-loader")]),s._v("/"),t("code",[s._v("raw-loader")]),s._v(" 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 "),t("code",[s._v("'javascript/auto'")]),s._v(" 来解决。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("module.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.(png|jpg|gif)$/i,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       use: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           loader: 'url-loader',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           options: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("             limit: 8192,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       ],\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'javascript/auto'\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("}\n")])])]),t("p",[s._v("如需从 asset loader 中排除来自新 URL 处理的 asset，请添加 "),t("code",[s._v("dependency: { not: ['url'] }")]),s._v(" 到 loader 配置中。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("module.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.(png|jpg|gif)$/i,\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       dependency: { not: ['url'] },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       use: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           loader: 'url-loader',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           options: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("             limit: 8192,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("}\n")])])]),t("h3",{attrs:{id:"_1、resource-资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、resource-资源"}},[s._v("#")]),s._v(" 1、Resource 资源")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.png/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" mainImage "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./images/main.png'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nimg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("src "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mainImage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// '/dist/151cfcfa1bd74779aadb.png'")]),s._v("\n")])])]),t("p",[s._v("所有 "),t("code",[s._v(".png")]),s._v(" 文件都将被发送到输出目录，并且其路径将被注入到 bundle 中。")]),s._v(" "),t("h4",{attrs:{id:"_1-自定义输出文件名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义输出文件名"}},[s._v("#")]),s._v(" (1) 自定义输出文件名")]),s._v(" "),t("p",[s._v("默认情况下，"),t("code",[s._v("asset/resource")]),s._v(" 模块以 "),t("code",[s._v("[hash][ext][query]")]),s._v(" 文件名发送到输出目录。")]),s._v(" "),t("p",[s._v("可以通过在 webpack 配置中设置 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputassetmodulefilename",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("output.assetModuleFilename")]),t("OutboundLink")],1),s._v(" 来修改此模板字符串：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   assetModuleFilename: 'images/[hash][ext][query]'\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.png/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource'\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("另一种自定义输出文件名的方式是，将某些资源发送到指定目录：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   assetModuleFilename: 'images/[hash][ext][query]'\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.png/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource'\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.html/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       generator: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         filename: 'static/[hash][ext][query]'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("使用此配置，所有 "),t("code",[s._v("html")]),s._v(" 文件都将被发送到输出目录中的 "),t("code",[s._v("static")]),s._v(" 目录中。")]),s._v(" "),t("p",[t("code",[s._v("Rule.generator.filename")]),s._v(" 与 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputassetmodulefilename",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("output.assetModuleFilename")]),t("OutboundLink")],1),s._v(" 相同，并且仅适用于 "),t("code",[s._v("asset")]),s._v(" 和 "),t("code",[s._v("asset/resource")]),s._v(" 模块类型。")]),s._v(" "),t("h3",{attrs:{id:"_2、inline-资源-inlining-asset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、inline-资源-inlining-asset"}},[s._v("#")]),s._v(" 2、inline 资源(inlining asset)")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist'),\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   assetModuleFilename: 'images/[hash][ext][query]'\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.png/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource'\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.svg/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/inline'\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.html/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/resource',\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       generator: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         filename: 'static/[hash][ext][query]'\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("};\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import mainImage from './images/main.png';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import metroMap from './images/metro.svg';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" img.src = mainImage; // '/dist/151cfcfa1bd74779aadb.png'\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" block.style.background = `url(${metroMap})`; // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)\n")])])])])]),t("p",[s._v("所有 "),t("code",[s._v(".svg")]),s._v(" 文件都将作为 data URI 注入到 bundle 中。")]),s._v(" "),t("h4",{attrs:{id:"_1-自定义-data-uri-生成器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义-data-uri-生成器"}},[s._v("#")]),s._v(" (1) 自定义 data URI 生成器")]),s._v(" "),t("p",[s._v("webpack 输出的 data URI，默认是呈现为使用 Base64 算法编码的文件内容。")]),s._v(" "),t("p",[s._v("如果要使用自定义编码算法，则可以指定一个自定义函数来编码文件内容：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n"),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const svgToMiniDataURI = require('mini-svg-data-uri');\n")])]),s._v("\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.svg/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/inline',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       generator: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         dataUrl: content => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           content = content.toString();\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           return svgToMiniDataURI(content);\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("现在，所有 "),t("code",[s._v(".svg")]),s._v(" 文件都将通过 "),t("code",[s._v("mini-svg-data-uri")]),s._v(" 包进行编码。")]),s._v(" "),t("h3",{attrs:{id:"_3、source-资源-source-asset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、source-资源-source-asset"}},[s._v("#")]),s._v(" 3、source 资源(source asset)")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const svgToMiniDataURI = require('mini-svg-data-uri');\n")])]),s._v("\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.svg/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/inline',\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       generator: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         dataUrl: content => {\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           content = content.toString();\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           return svgToMiniDataURI(content);\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         }\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.txt/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/source',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[t("strong",[s._v("src/example.txt")])]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Hello world\n")])])]),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import metroMap from './images/metro.svg';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import exampleText from './example.txt';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" block.style.background = `url(${metroMap}); // url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDo...vc3ZnPgo=)\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" block.textContent = exampleText; // 'Hello world'\n")])])])])]),t("p",[s._v("所有 "),t("code",[s._v(".txt")]),s._v(" 文件将原样注入到 bundle 中。")]),s._v(" "),t("h3",{attrs:{id:"_4、url-资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、url-资源"}},[s._v("#")]),s._v(" 4、URL 资源")]),s._v(" "),t("p",[s._v("当使用 "),t("code",[s._v("new URL('./path/to/asset', import.meta.url)")]),s._v("，webpack 也会创建资源模块。")]),s._v(" "),t("p",[t("strong",[s._v("src/index.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" logo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./logo.svg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("根据你配置中 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/target/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("target")]),t("OutboundLink")],1),s._v(" 的不同，webpack 会将上述代码编译成不同结果：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// target: web")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  __webpack_public_path__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logo.svg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baseURI "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// target: webworker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__webpack_public_path__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logo.svg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// target: node, node-webkit, nwjs, electron-main, electron-renderer, electron-preload, async-node")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  __webpack_public_path__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logo.svg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pathToFileUrl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"_5、通用资源类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、通用资源类型"}},[s._v("#")]),s._v(" 5、通用资源类型")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.txt/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("现在，webpack 将按照默认条件，自动地在 "),t("code",[s._v("resource")]),s._v(" 和 "),t("code",[s._v("inline")]),s._v(" 之间进行选择：小于 8kb 的文件，将会视为 "),t("code",[s._v("inline")]),s._v(" 模块类型，否则会被视为 "),t("code",[s._v("resource")]),s._v(" 模块类型。")]),s._v(" "),t("p",[s._v("可以通过在 webpack 配置的 module rule 层级中，设置 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Rule.parser.dataUrlCondition.maxSize")]),t("OutboundLink")],1),s._v(" 选项来修改此条件：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'main.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.txt/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       parser: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         dataUrlCondition: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("           maxSize: 4 * 1024 // 4kb\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         }\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])]),s._v("};\n")])])]),t("p",[s._v("还可以 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/module/#ruleparserdataurlcondition",target:"_blank",rel:"noopener noreferrer"}},[s._v("指定一个函数"),t("OutboundLink")],1),s._v(" 来决定是否 inline 模块。")]),s._v(" "),t("h3",{attrs:{id:"_6、变更内联-loader-的语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、变更内联-loader-的语法"}},[s._v("#")]),s._v(" 6、变更内联 loader 的语法")]),s._v(" "),t("p",[s._v("在 asset 模块和 webpack 5 之前，可以使用"),t("a",{attrs:{href:"https://webpack.docschina.org/concepts/loaders/#inline",target:"_blank",rel:"noopener noreferrer"}},[s._v("内联语法"),t("OutboundLink")],1),s._v("与上述传统的 loader 结合使用。")]),s._v(" "),t("p",[s._v("现在建议去掉所有的 loader 的语法，使用资源查询条件来魔法内联语法的功能。")]),s._v(" "),t("p",[s._v("示例，将 "),t("code",[s._v("raw-loader")]),s._v(" 替换为 "),t("code",[s._v("asset/source")]),s._v(" 类型：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import myModule from 'raw-loader!my-module';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import myModule from 'my-module?raw';\n")])])])])]),t("p",[s._v("webpack 相关配置：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("module: {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // ...\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       resouceQuery: /raw/\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/source'\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])])])])]),t("p",[s._v("如果你想把原始资源排除在其他 loader 的解析范围以外，请使用取反的符合：")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("module: {\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // ...\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       test: /\\.m?js$/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       resourceQuery: /^(?!raw$).*/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     },\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       resouceQuery: /raw/\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       type: 'asset/source'\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ]\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")])])])])]),t("h2",{attrs:{id:"十八、entry-高级用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十八、entry-高级用法"}},[s._v("#")]),s._v(" 十八、entry 高级用法")]),s._v(" "),t("h3",{attrs:{id:"_1、每个入口使用多种文件类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、每个入口使用多种文件类型"}},[s._v("#")]),s._v(" 1、每个入口使用多种文件类型")]),s._v(" "),t("p",[s._v("在不使用 "),t("code",[s._v("import")]),s._v(" 样式文件的应用程序中（预单页应用程序或其他原因），使用一个值数组结构的 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context/#entry",target:"_blank",rel:"noopener noreferrer"}},[s._v("entry"),t("OutboundLink")],1),s._v("，并且在其中传入不同类型的文件，可以实现将 CSS 和 JavaScript（和其他）文件分离在不同的 bundle。")]),s._v(" "),t("p",[s._v("举个例子。我们有一个具有两种页面类型的 PHP 应用程序：home(首页) 和 account(帐户)。home 与应用程序其余部分（account 页面）具有不同的布局和不可共享的 JavaScript。我们想要从应用程序文件中输出 home 页面的 "),t("code",[s._v("home.js")]),s._v(" 和 "),t("code",[s._v("home.css")]),s._v("，为 account 页面输出 "),t("code",[s._v("account.js")]),s._v(" 和 "),t("code",[s._v("account.css")]),s._v("。")]),s._v(" "),t("p",[t("strong",[s._v("home.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'home page type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("home.scss")])]),s._v(" "),t("div",{staticClass:"language-scss extra-class"},[t("pre",{pre:!0,attrs:{class:"language-scss"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// home page individual styles")]),s._v("\n")])])]),t("p",[t("strong",[s._v("account.js")])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'account page type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("account.scss")])]),s._v(" "),t("div",{staticClass:"language-scss extra-class"},[t("pre",{pre:!0,attrs:{class:"language-scss"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// account page individual styles")]),s._v("\n")])])]),t("p",[s._v("我们将在 "),t("code",[s._v("production(生产)")]),s._v(" 模式中使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/plugins/mini-css-extract-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("MiniCssExtractPlugin")]),t("OutboundLink")],1),s._v(" 作为 CSS 的一个最佳实践。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" MiniCssExtractPlugin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mini-css-extract-plugin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  mode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./home.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./home.scss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    account"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./account.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./account.scss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[name].js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.scss$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fallback to style-loader in development")]),s._v("\n          process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'style-loader'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" MiniCssExtractPlugin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'css-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sass-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MiniCssExtractPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[name].css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("由于我们未指定其他输出路径，因此使用以上配置运行 webpack 将输出到 "),t("code",[s._v("./dist")]),s._v("。"),t("code",[s._v("./dist")]),s._v(" 目录下现在包含四个文件：")]),s._v(" "),t("ul",[t("li",[s._v("home.js")]),s._v(" "),t("li",[s._v("home.css")]),s._v(" "),t("li",[s._v("account.js")]),s._v(" "),t("li",[s._v("account.css")])]),s._v(" "),t("p",[s._v("#十九、TypeScript")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.typescriptlang.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TypeScript"),t("OutboundLink")],1),s._v(" 是 JavaScript 的超集，为其增加了类型系统，可以编译为普通 JavaScript 代码。这篇指南里我们将会学习是如何将 webpack 和 TypeScript 进行集成。")]),s._v(" "),t("h3",{attrs:{id:"_1、基础配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、基础配置"}},[s._v("#")]),s._v(" 1、基础配置")]),s._v(" "),t("p",[s._v("首先，执行以下命令安装 TypeScript compiler 和 loader：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev typescript ts-loader\n")])])]),t("p",[s._v("现在，我们将修改目录结构和配置文件：")]),s._v(" "),t("p",[t("strong",[s._v("project")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" webpack-demo\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- package.json\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- tsconfig.json\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- webpack.config.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /dist\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- bundle.js\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.html\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /src\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.js\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   |- index.ts\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- /node_modules\n")])])])])]),t("p",[t("strong",[s._v("tsconfig.json")])]),s._v(" "),t("p",[s._v("这里我们设置一个基本的配置，来支持 JSX，并将 TypeScript 编译到 ES5……")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"compilerOptions"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"outDir"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./dist/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"noImplicitAny"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"module"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es6"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"target"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"jsx"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"react"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowJs"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("查看 "),t("a",{attrs:{href:"https://www.typescriptlang.org/docs/handbook/tsconfig-json.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("TypeScript 官方文档"),t("OutboundLink")],1),s._v(" 了解更多关于 "),t("code",[s._v("tsconfig.json")]),s._v(" 的配置选项。")]),s._v(" "),t("p",[s._v("想要了解 webpack 配置的更多信息，请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/concepts/configuration/",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置"),t("OutboundLink")],1),s._v(" 概念。")]),s._v(" "),t("p",[s._v("现在，配置 webpack 处理 TypeScript：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.ts'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.tsx?$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ts-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("node_modules")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  resolve"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    extensions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.tsx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.ts'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bundle.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("这会让 webpack 直接从 "),t("code",[s._v("./index.ts")]),s._v(" "),t("em",[s._v("进入")]),s._v("，然后通过 "),t("code",[s._v("ts-loader")]),s._v(" _加载_所有的 "),t("code",[s._v(".ts")]),s._v(" 和 "),t("code",[s._v(".tsx")]),s._v(" 文件，并且在当前目录_输出_一个 "),t("code",[s._v("bundle.js")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("现在让我们改变 "),t("code",[s._v("lodash")]),s._v(" 在 "),t("code",[s._v("./index.ts")]),s._v(" 文件中的引入， 因为在 "),t("code",[s._v("lodash")]),s._v(" 的定义中没有默认(default)的导出。")]),s._v(" "),t("p",[t("strong",[s._v("./index.ts")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import * as _ from 'lodash';\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   const element = document.createElement('div');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])])]),t("blockquote",[t("p",[s._v("Tip\n如果想在 TypeScript 中保留如"),t("code",[s._v("import _ from 'lodash';")]),s._v("的语法被让它作为一种默认的导入方式，需要在文件 "),t("strong",[s._v("tsconfig.json")]),s._v(" 中设置 "),t("code",[s._v('"allowSyntheticDefaultImports" : true')]),s._v(" 和 "),t("code",[s._v('"esModuleInterop" : true')]),s._v(" 。这个是与 TypeScript 相关的配置，在本文档中提及仅供参考。")])]),s._v(" "),t("h3",{attrs:{id:"_2、loader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、loader"}},[s._v("#")]),s._v(" 2、Loader")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/TypeStrong/ts-loader",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ts-loader")]),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("在本指南中，我们使用 "),t("code",[s._v("ts-loader")]),s._v("，因为它能够很方便地启用额外的 webpack 功能，例如将其他 web 资源导入到项目中。")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Warning")]),s._v(" "),t("code",[s._v("ts-loader")]),s._v("使用"),t("code",[s._v("tsc")]),s._v("TypeScript编译器，并取决于您的"),t("code",[s._v("tsconfig.json")]),s._v("配置。确保避免设置"),t("a",{attrs:{href:"https://www.typescriptlang.org/tsconfig#module",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("module")]),t("OutboundLink")],1),s._v("为“ CommonJS”，否则webpack将无法"),t("a",{attrs:{href:"https://webpack.docschina.org/guides/tree-shaking",target:"_blank",rel:"noopener noreferrer"}},[s._v("摇晃您的代码"),t("OutboundLink")],1),s._v("。")])]),s._v(" "),t("p",[s._v("请注意，如果您已经在使用"),t("a",{attrs:{href:"https://github.com/babel/babel-loader",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("babel-loader")]),t("OutboundLink")],1),s._v("代码转译，则可以使用"),t("a",{attrs:{href:"https://babeljs.io/docs/en/babel-preset-typescript",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("@babel/preset-typescript")]),t("OutboundLink")],1),s._v("Babel并让其处理JavaScript和TypeScript文件，而无需使用其他加载器。请记住，与相反"),t("code",[s._v("ts-loader")]),s._v("，底层"),t("a",{attrs:{href:"https://babeljs.io/docs/en/babel-plugin-transform-typescript",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("@babel/plugin-transform-typescript")]),t("OutboundLink")],1),s._v("插件不执行任何类型检查。")]),s._v(" "),t("h3",{attrs:{id:"_3、source-maps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、source-maps"}},[s._v("#")]),s._v(" 3、Source Maps")]),s._v(" "),t("p",[s._v("想要了解 source map 的更多信息，请查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/development",target:"_blank",rel:"noopener noreferrer"}},[s._v("开发"),t("OutboundLink")],1),s._v(" 指南。")]),s._v(" "),t("p",[s._v("想要启用 source map，我们必须配置 TypeScript，以将内联的 source map 输出到编译后的 JavaScript 文件中。必须在 TypeScript 配置中添加下面这行：")]),s._v(" "),t("p",[t("strong",[s._v("tsconfig.json")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('   "compilerOptions": {\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "outDir": "./dist/",\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "sourceMap": true,\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "noImplicitAny": true,\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "module": "commonjs",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "target": "es5",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "jsx": "react",\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v('     "allowJs": true\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   }\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])])])])]),t("p",[s._v("现在，我们需要告诉 webpack 提取这些 source map，并内联到最终的 bundle 中。")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" const path = require('path');\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" module.exports = {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   entry: './src/index.ts',\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   devtool: 'inline-source-map',\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   module: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     rules: [\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         test: /\\.tsx?$/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         use: 'ts-loader',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("         exclude: /node_modules/,\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("       },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   resolve: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     extensions: [ '.tsx', '.ts', '.js' ],\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   output: {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     filename: 'bundle.js',\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("     path: path.resolve(__dirname, 'dist'),\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("   },\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v(" };\n")])])])])]),t("p",[s._v("查看 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/devtool/",target:"_blank",rel:"noopener noreferrer"}},[s._v("devtool"),t("OutboundLink")],1),s._v(" 文档以了解更多信息。")]),s._v(" "),t("h3",{attrs:{id:"_4、使用第三方类库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用第三方类库"}},[s._v("#")]),s._v(" 4、使用第三方类库")]),s._v(" "),t("p",[s._v("在从 npm 安装 third party library(第三方库) 时，一定要记得同时安装此 library 的类型声明文件(typing definition)。你可以从 "),t("a",{attrs:{href:"https://microsoft.github.io/TypeSearch/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TypeSearch"),t("OutboundLink")],1),s._v(" 中找到并安装这些第三方库的类型声明文件。")]),s._v(" "),t("p",[s._v("举个例子，如果想安装 lodash 类型声明文件，我们可以运行下面的命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save-dev @types/lodash\n")])])]),t("p",[s._v("想了解更多，可以查看 "),t("a",{attrs:{href:"https://blogs.msdn.microsoft.com/typescript/2016/06/15/the-future-of-declaration-files/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇文章"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_5、导入其他资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、导入其他资源"}},[s._v("#")]),s._v(" 5、导入其他资源")]),s._v(" "),t("p",[s._v("想要在 TypeScript 中使用非代码资源(non-code asset)，我们需要告诉 TypeScript 推断导入资源的类型。在项目里创建一个 "),t("code",[s._v("custom.d.ts")]),s._v(" 文件，这个文件用来表示项目中 TypeScript 的自定义类型声明。我们为 "),t("code",[s._v(".svg")]),s._v(" 文件设置一个声明：")]),s._v(" "),t("p",[t("strong",[s._v("custom.d.ts")])]),s._v(" "),t("div",{staticClass:"language-typescript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("module")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.svg'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("H这里，我们通过指定任何以 "),t("code",[s._v(".svg")]),s._v(" 结尾的导入(import)，将 SVG 声明(declare) 为一个新的模块(module)，并将模块的 "),t("code",[s._v("content")]),s._v(" 定义为 "),t("code",[s._v("any")]),s._v("。我们可以通过将类型定义为字符串，来更加显式地将它声明为一个 url。同样的概念适用于其他资源，包括 CSS, SCSS, JSON 等。")]),s._v(" "),t("h3",{attrs:{id:"_6、构建性能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、构建性能"}},[s._v("#")]),s._v(" 6、构建性能")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Warning")]),s._v("\n这可能会降低构建性能。")])]),s._v(" "),t("h2",{attrs:{id:"二十、构建性能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二十、构建性能"}},[s._v("#")]),s._v(" 二十、构建性能")]),s._v(" "),t("h3",{attrs:{id:"_1、通用环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、通用环境"}},[s._v("#")]),s._v(" 1、通用环境")]),s._v(" "),t("p",[s._v("无论你是在 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/development",target:"_blank",rel:"noopener noreferrer"}},[s._v("开发环境"),t("OutboundLink")],1),s._v(" 还是在 "),t("a",{attrs:{href:"https://webpack.docschina.org/guides/production",target:"_blank",rel:"noopener noreferrer"}},[s._v("生产环境"),t("OutboundLink")],1),s._v(" 下运行构建脚本，以下最佳实践都会有所帮助。")]),s._v(" "),t("h4",{attrs:{id:"_1-更新到最新版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-更新到最新版本"}},[s._v("#")]),s._v(" (1) 更新到最新版本")]),s._v(" "),t("p",[s._v("使用最新的 webpack 版本。我们会经常进行性能优化。webpack 的最新稳定版本是：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/webpack/webpack/releases",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://img.shields.io/github/package-json/v/webpack/webpack.svg?label=webpack&style=flat-square&maxAge=3600",alt:"latest webpack version"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("将 "),t("strong",[s._v("Node.js")]),s._v(" 更新到最新版本，也有助于提高性能。除此之外，将你的 package 管理工具（例如 "),t("code",[s._v("npm")]),s._v(" 或者 "),t("code",[s._v("yarn")]),s._v("）更新到最新版本，也有助于提高性能。较新的版本能够建立更高效的模块树以及提高解析速度。")]),s._v(" "),t("h4",{attrs:{id:"_2-loader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-loader"}},[s._v("#")]),s._v(" (2) loader")]),s._v(" "),t("p",[s._v("将 loader 应用于最少数量的必要模块。而非如下:")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        loader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'babel-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("通过使用 "),t("code",[s._v("include")]),s._v(" 字段，仅将 loader 应用在实际需要将其转换的模块：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        include"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'src'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        loader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'babel-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_3-引导-bootstrap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-引导-bootstrap"}},[s._v("#")]),s._v(" (3) 引导(bootstrap)")]),s._v(" "),t("p",[s._v("每个额外的 loader/plugin 都有其启动时间。尽量少地使用工具。")]),s._v(" "),t("h4",{attrs:{id:"_4-解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-解析"}},[s._v("#")]),s._v(" (4) 解析")]),s._v(" "),t("p",[s._v("以下步骤可以提高解析速度：")]),s._v(" "),t("ul",[t("li",[s._v("减少 "),t("code",[s._v("resolve.modules")]),s._v(", "),t("code",[s._v("resolve.extensions")]),s._v(", "),t("code",[s._v("resolve.mainFiles")]),s._v(", "),t("code",[s._v("resolve.descriptionFiles")]),s._v(" 中条目数量，因为他们会增加文件系统调用的次数。")]),s._v(" "),t("li",[s._v("如果你不使用 symlinks（例如 "),t("code",[s._v("npm link")]),s._v(" 或者 "),t("code",[s._v("yarn link")]),s._v("），可以设置 "),t("code",[s._v("resolve.symlinks: false")]),s._v("。")]),s._v(" "),t("li",[s._v("如果你使用自定义 resolve plugin 规则，并且没有指定 context 上下文，可以设置 "),t("code",[s._v("resolve.cacheWithContext: false")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_5-dll"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-dll"}},[s._v("#")]),s._v(" (5) dll")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("DllPlugin")]),s._v(" 为更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。")]),s._v(" "),t("h4",{attrs:{id:"_6-小即是快-smaller-faster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-小即是快-smaller-faster"}},[s._v("#")]),s._v(" (6) 小即是快(smaller = faster)")]),s._v(" "),t("p",[s._v("减少编译结果的整体大小，以提高构建性能。尽量保持 chunk 体积小。")]),s._v(" "),t("ul",[t("li",[s._v("使用数量更少/体积更小的 library。")]),s._v(" "),t("li",[s._v("在多页面应用程序中使用 "),t("code",[s._v("SplitChunksPlugin")]),s._v("。")]),s._v(" "),t("li",[s._v("在多页面应用程序中使用 "),t("code",[s._v("SplitChunksPlugin")]),s._v("，并开启 "),t("code",[s._v("async")]),s._v(" 模式。")]),s._v(" "),t("li",[s._v("移除未引用代码。")]),s._v(" "),t("li",[s._v("只编译你当前正在开发的那些代码。")])]),s._v(" "),t("h4",{attrs:{id:"_7-worker-池-worker-pool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-worker-池-worker-pool"}},[s._v("#")]),s._v(" (7) worker 池(worker pool)")]),s._v(" "),t("p",[t("code",[s._v("thread-loader")]),s._v(" 可以将非常消耗资源的 loader 分流给一个 worker pool。")]),s._v(" "),t("h4",{attrs:{id:"_8-持久化缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-持久化缓存"}},[s._v("#")]),s._v(" (8) 持久化缓存")]),s._v(" "),t("p",[s._v("在 webpack 配置中使用 "),t("a",{attrs:{href:"https://webpack.docschina.org/configuration/other-options/#cache",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("cache")]),t("OutboundLink")],1),s._v(" 选项。使用 "),t("code",[s._v("package.json")]),s._v(" 中的 "),t("code",[s._v('"postinstall"')]),s._v(" 清除缓存目录。")]),s._v(" "),t("h4",{attrs:{id:"_9-自定义-plugin-loader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-自定义-plugin-loader"}},[s._v("#")]),s._v(" (9) 自定义 plugin/loader")]),s._v(" "),t("p",[s._v("对它们进行概要分析，以免在此处引入性能问题。")]),s._v(" "),t("h4",{attrs:{id:"_10-progress-plugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-progress-plugin"}},[s._v("#")]),s._v(" (10 )Progress plugin")]),s._v(" "),t("p",[s._v("将 "),t("code",[s._v("ProgressPlugin")]),s._v(" 从 webpack 中删除，可以缩短构建时间。请注意，"),t("code",[s._v("ProgressPlugin")]),s._v(" 可能不会为快速构建提供太多价值，因此，请权衡利弊再使用。")]),s._v(" "),t("h3",{attrs:{id:"_2、开发环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、开发环境"}},[s._v("#")]),s._v(" 2、开发环境")]),s._v(" "),t("p",[s._v("以下步骤对于_开发环境_特别有帮助。")]),s._v(" "),t("h4",{attrs:{id:"_1-增量编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-增量编译"}},[s._v("#")]),s._v(" (1) 增量编译")]),s._v(" "),t("p",[s._v("使用 webpack 的 watch mode(监听模式)。而不使用其他工具来 watch 文件和调用 webpack 。内置的 watch mode 会记录时间戳并将此信息传递给 compilation 以使缓存失效。")]),s._v(" "),t("p",[s._v("在某些配置环境中，watch mode 会回退到 poll mode(轮询模式)。监听许多文件会导致 CPU 大量负载。在这些情况下，可以使用 "),t("code",[s._v("watchOptions.poll")]),s._v(" 来增加轮询的间隔时间。")]),s._v(" "),t("h4",{attrs:{id:"_2-在内存中编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在内存中编译"}},[s._v("#")]),s._v(" (2) 在内存中编译")]),s._v(" "),t("p",[s._v("下面几个工具通过在内存中（而不是写入磁盘）编译和 serve 资源来提高性能：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("webpack-dev-server")])]),s._v(" "),t("li",[t("code",[s._v("webpack-hot-middleware")])]),s._v(" "),t("li",[t("code",[s._v("webpack-dev-middleware")])])]),s._v(" "),t("h4",{attrs:{id:"_3-stats-tojson-加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-stats-tojson-加速"}},[s._v("#")]),s._v(" (3) stats.toJson 加速")]),s._v(" "),t("p",[s._v("webpack 4 默认使用 "),t("code",[s._v("stats.toJson()")]),s._v(" 输出大量数据。除非在增量步骤中做必要的统计，否则请避免获取 "),t("code",[s._v("stats")]),s._v(" 对象的部分内容。"),t("code",[s._v("webpack-dev-server")]),s._v(" 在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中，从 "),t("code",[s._v("stats")]),s._v(" 对象获取的数据量。")]),s._v(" "),t("h4",{attrs:{id:"_4-devtool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-devtool"}},[s._v("#")]),s._v(" (4) Devtool")]),s._v(" "),t("p",[s._v("需要注意的是不同的 "),t("code",[s._v("devtool")]),s._v(" 设置，会导致性能差异。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v('"eval"')]),s._v(" 具有最好的性能，但并不能帮助你转译代码。")]),s._v(" "),t("li",[s._v("如果你能接受稍差一些的 map 质量，可以使用 "),t("code",[s._v("cheap-source-map")]),s._v(" 变体配置来提高性能")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("eval-source-map")]),s._v(" 变体配置进行增量编译。")])]),s._v(" "),t("blockquote",[t("p",[s._v("Tip\n在大多数情况下，最佳选择是 "),t("code",[s._v("eval-cheap-module-source-map")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_5-避免在生产环境下才会用到的工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-避免在生产环境下才会用到的工具"}},[s._v("#")]),s._v(" (5) 避免在生产环境下才会用到的工具")]),s._v(" "),t("p",[s._v("某些 utility, plugin 和 loader 都只用于生产环境。例如，在开发环境下使用 "),t("code",[s._v("TerserPlugin")]),s._v(" 来 minify(压缩) 和 mangle(混淆破坏) 代码是没有意义的。通常在开发环境下，应该排除以下这些工具：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("TerserPlugin")])]),s._v(" "),t("li",[t("code",[s._v("[fullhash]")]),s._v("/"),t("code",[s._v("[chunkhash]")]),s._v("/"),t("code",[s._v("[contenthash]")])]),s._v(" "),t("li",[t("code",[s._v("AggressiveSplittingPlugin")])]),s._v(" "),t("li",[t("code",[s._v("AggressiveMergingPlugin")])]),s._v(" "),t("li",[t("code",[s._v("ModuleConcatenationPlugin")])])]),s._v(" "),t("h4",{attrs:{id:"_6-最小化-entry-chunk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-最小化-entry-chunk"}},[s._v("#")]),s._v(" (6) 最小化 entry chunk")]),s._v(" "),t("p",[s._v("webpack 只会在文件系统中输出已经更新的 chunk。某些配置选项（HMR, "),t("code",[s._v("output.chunkFilename")]),s._v(" 的 "),t("code",[s._v("[name]")]),s._v("/"),t("code",[s._v("[chunkhash]/[contenthash]")]),s._v("，"),t("code",[s._v("[fullhash]")]),s._v("）来说，除了对已经更新的 chunk 无效之外，对于 entry chunk 也不会生效。")]),s._v(" "),t("p",[s._v("确保在生成 entry chunk 时，尽量减少其体积以提高性能。下面的配置为运行时代码创建了一个额外的 chunk，所以它的生成代价较低：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  optimization"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    runtimeChunk"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_7-避免额外的优化步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-避免额外的优化步骤"}},[s._v("#")]),s._v(" (7) 避免额外的优化步骤")]),s._v(" "),t("p",[s._v("webpack 通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  optimization"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    removeAvailableModules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    removeEmptyChunks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    splitChunks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_8-输出结果不携带路径信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-输出结果不携带路径信息"}},[s._v("#")]),s._v(" (8) 输出结果不携带路径信息")]),s._v(" "),t("p",[s._v("webpack 会在输出的 bundle 中生成路径信息。然而，在打包数千个模块的项目中，这会导致造成垃圾回收性能压力。在 "),t("code",[s._v("options.output.pathinfo")]),s._v(" 设置中关闭：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    pathinfo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_9-node-js-版本-8-9-10-9-11-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-node-js-版本-8-9-10-9-11-1"}},[s._v("#")]),s._v(" (9) Node.js 版本 8.9.10-9.11.1")]),s._v(" "),t("p",[s._v("Node.js v8.9.10 - v9.11.1 中的 ES2015 "),t("code",[s._v("Map")]),s._v(" 和 "),t("code",[s._v("Set")]),s._v(" 实现，存在 "),t("a",{attrs:{href:"https://github.com/nodejs/node/issues/19769",target:"_blank",rel:"noopener noreferrer"}},[s._v("性能回退"),t("OutboundLink")],1),s._v("。webpack 大量地使用这些数据结构，因此这次回退也会影响编译时间。")]),s._v(" "),t("p",[s._v("之前和之后的 Node.js 版本不受影响。")]),s._v(" "),t("h4",{attrs:{id:"_10-typescript-loader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-typescript-loader"}},[s._v("#")]),s._v(" (10) TypeScript loader")]),s._v(" "),t("p",[s._v("你可以为 loader 传入 "),t("code",[s._v("transpileOnly")]),s._v(" 选项，以缩短使用 "),t("code",[s._v("ts-loader")]),s._v(" 时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，请使用 "),t("a",{attrs:{href:"https://www.npmjs.com/package/fork-ts-checker-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ForkTsCheckerWebpackPlugin")]),t("OutboundLink")],1),s._v("。使用此插件会将检查过程移至单独的进程，可以加快 TypeScript 的类型检查和 ESLint 插入的速度。")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.tsx?$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  use"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      loader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ts-loader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      options"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        transpileOnly"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("Tip\n这是一个关于 "),t("code",[s._v("ts-loader")]),s._v(" "),t("a",{attrs:{href:"https://github.com/TypeStrong/ts-loader/tree/master/examples/fork-ts-checker-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("完整示例"),t("OutboundLink")],1),s._v("的 Github 仓库。")])]),s._v(" "),t("h3",{attrs:{id:"_3、生产环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、生产环境"}},[s._v("#")]),s._v(" 3、生产环境")]),s._v(" "),t("p",[s._v("以下步骤对于_生产环境_特别有帮助。")]),s._v(" "),t("blockquote",[t("p",[s._v("Warning\n不要为了很小的性能收益，牺牲应用程序的质量！注意，在大多数情况下，优化代码质量比构建性能更重要。")])]),s._v(" "),t("h4",{attrs:{id:"_1-多个-compilation-对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-多个-compilation-对象"}},[s._v("#")]),s._v(" (1) 多个 compilation 对象")]),s._v(" "),t("p",[s._v("在创建多个 compilation 时，以下工具可以帮助到你：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/trivago/parallel-webpack",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("parallel-webpack")]),t("OutboundLink")],1),s._v("：它允许在一个 worker 池中运行 compilation。")]),s._v(" "),t("li",[t("code",[s._v("cache-loader")]),s._v("：可以在多个 compilation 之间共享缓存。")])]),s._v(" "),t("h4",{attrs:{id:"_2-source-maps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-source-maps"}},[s._v("#")]),s._v(" (2) Source Maps")]),s._v(" "),t("p",[s._v("source map 相当消耗资源。你真的需要它们？")]),s._v(" "),t("h3",{attrs:{id:"_4、工具相关问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、工具相关问题"}},[s._v("#")]),s._v(" 4、工具相关问题")]),s._v(" "),t("p",[s._v("下列工具存在某些可能会降低构建性能的问题：")]),s._v(" "),t("h4",{attrs:{id:"_1-babel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-babel"}},[s._v("#")]),s._v(" (1) Babel")]),s._v(" "),t("ul",[t("li",[s._v("最小化项目中的 preset/plugin 数量。")])]),s._v(" "),t("h4",{attrs:{id:"_2-typescript"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-typescript"}},[s._v("#")]),s._v(" (2) TypeScript")]),s._v(" "),t("ul",[t("li",[s._v("在单独的进程中使用 "),t("code",[s._v("fork-ts-checker-webpack-plugin")]),s._v(" 进行类型检查。")]),s._v(" "),t("li",[s._v("配置 loader 跳过类型检查。")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("ts-loader")]),s._v(" 时，设置 "),t("code",[s._v("happyPackMode: true")]),s._v(" / "),t("code",[s._v("transpileOnly: true")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_3-sass"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-sass"}},[s._v("#")]),s._v(" (3) Sass")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("node-sass")]),s._v(" 中有个来自 Node.js 线程池的阻塞线程的 bug。 当使用 "),t("code",[s._v("thread-loader")]),s._v(" 时，需要设置 "),t("code",[s._v("workerParallelJobs: 2")]),s._v("。")])]),s._v(" "),t("h2",{attrs:{id:"廿一、内容安全策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿一、内容安全策略"}},[s._v("#")]),s._v(" 廿一、内容安全策略")]),s._v(" "),t("p",[s._v("webpack 能够为其加载的所有脚本添加 "),t("code",[s._v("nonce")]),s._v("。要启用此功能，需要在引入的入口脚本中设置一个 "),t("code",[s._v("__webpack_nonce__")]),s._v(" 变量。应该为每个唯一的页面视图生成和提供一个唯一的基于 hash 的 nonce，这就是为什么 "),t("code",[s._v("__webpack_nonce__")]),s._v(" 要在入口文件中指定，而不是在配置中指定的原因。注意，"),t("code",[s._v("nonce")]),s._v(" 应该是一个 base64 编码的字符串。")]),s._v(" "),t("h3",{attrs:{id:"_1、示例-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、示例-3"}},[s._v("#")]),s._v(" 1、示例")]),s._v(" "),t("p",[s._v("在 entry 文件中：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n__webpack_nonce__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c29tZSBjb29sIHN0cmluZyB3aWxsIHBvcCB1cCAxMjM='")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2、启用-csp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、启用-csp"}},[s._v("#")]),s._v(" 2、启用 CSP")]),s._v(" "),t("p",[s._v("注意，默认情况下不启用 CSP。需要与文档(document)一起发送相应的 "),t("code",[s._v("CSP")]),s._v(" header 或 meta 标签 "),t("code",[s._v('<meta http-equiv="Content-Security-Policy" ...>')]),s._v("，以告知浏览器启用 CSP。以下是一个包含 CDN 白名单 URL 的 CSP header 的示例：")]),s._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[s._v("Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com;\n")])])]),t("p",[s._v("更多CSP知识，请移步"),t("a",{attrs:{href:"https://www.cnblogs.com/both-eyes/p/10841875.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("内容安全策略（CSP）详解"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("#廿二、编写一个Loader")]),s._v(" "),t("p",[t("code",[s._v("loader")]),s._v("是一个 "),t("code",[s._v("node")]),s._v(" 模块。当应用 "),t("code",[s._v("loader")]),s._v(" 转换资源时，将调用此函数。给定的函数将使用提供给它的上下文访问"),t("a",{attrs:{href:"https://webpack.docschina.org/api/loaders/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Loader API"),t("OutboundLink")],1),t("code",[s._v("this")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_1、基本配置-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本配置-2"}},[s._v("#")]),s._v(" 1、基本配置")]),s._v(" "),t("p",[s._v("在深入研究不同类型的"),t("code",[s._v("loader")]),s._v("，及它们的用法和示例之前，让我们看一下可以在本地开发和测试加载器的三种方式。")]),s._v(" "),t("p",[s._v("为了测试单个装载程序，你可以简单地在配置文件中，使用"),t("code",[s._v("path")]),s._v(" 来解析一个本地文件：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            loader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path/to/loader.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            options"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* ... */")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("要测试多个，您可以利用"),t("code",[s._v("resolveLoader.modules")]),s._v("配置来更新webpack在何处搜索 "),t("code",[s._v("loader")]),s._v("。例如，如果你的项目中有一个本地"),t("code",[s._v("/loaders")]),s._v("目录：")]),s._v(" "),t("p",[t("strong",[s._v("webpack.config.js")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n  resolveLoader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    modules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_modules'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'loaders'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("#廿三、编写一个Plugin")]),s._v(" "),t("p",[s._v("#廿四、脚手架")]),s._v(" "),t("h2",{attrs:{id:"廿五、渐进式网络应用程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿五、渐进式网络应用程序"}},[s._v("#")]),s._v(" 廿五、渐进式网络应用程序")]),s._v(" "),t("h2",{attrs:{id:"廿六、ecmascript-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿六、ecmascript-modules"}},[s._v("#")]),s._v(" 廿六、ECMAScript Modules")]),s._v(" "),t("h2",{attrs:{id:"廿七、package-exports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿七、package-exports"}},[s._v("#")]),s._v(" 廿七、Package exports")]),s._v(" "),t("h2",{attrs:{id:"廿八、web-workers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿八、web-workers"}},[s._v("#")]),s._v(" 廿八、Web Workers")]),s._v(" "),t("h2",{attrs:{id:"廿九、集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#廿九、集成"}},[s._v("#")]),s._v(" 廿九、集成")]),s._v(" "),t("h2",{attrs:{id:"三十、开发-vagrant"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三十、开发-vagrant"}},[s._v("#")]),s._v(" 三十、开发 - Vagrant")])])}),[],!1,null,null,null);e.default=a.exports}}]);